<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Minecraft Mod 设计模式 | 遗世の私语</title><meta name="keywords" content="Java,Minecraft"><meta name="author" content="遗世雨"><meta name="copyright" content="遗世雨"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Minecraft Mod 设计模式0. 概述源代码:MinecraftByExample机制分析:MinecraftModding 本文主要是把各种特定的目标的特定模式(套路)总结下来(针对 1.15.x,1.16.x 应该也 ok,但是更早的版本就不可以了) 1. 项目模式1.1 mods.toml首先 toml 是一种文档格式:toml 文档格式然后 mods.toml 位于resource">
<meta property="og:type" content="article">
<meta property="og:title" content="Minecraft Mod 设计模式">
<meta property="og:url" content="http://yishiyu.world/2021/03/14/Minecraft%20Mod%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html">
<meta property="og:site_name" content="遗世の私语">
<meta property="og:description" content="Minecraft Mod 设计模式0. 概述源代码:MinecraftByExample机制分析:MinecraftModding 本文主要是把各种特定的目标的特定模式(套路)总结下来(针对 1.15.x,1.16.x 应该也 ok,但是更早的版本就不可以了) 1. 项目模式1.1 mods.toml首先 toml 是一种文档格式:toml 文档格式然后 mods.toml 位于resource">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.yishiyu.world/blogs/cover/post/20210224/008.jpg">
<meta property="article:published_time" content="2021-03-14T02:00:06.000Z">
<meta property="article:modified_time" content="2021-10-17T03:36:18.667Z">
<meta property="article:author" content="遗世雨">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Minecraft">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.yishiyu.world/blogs/cover/post/20210224/008.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yishiyu.world/2021/03/14/Minecraft%20Mod%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 遗世雨","link":"链接: ","source":"来源: 遗世の私语","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2021-10-17 11:36:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/Hiki.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">37</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">20</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('http://img.yishiyu.world/blogs/cover/post/20210224/008.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">遗世の私语</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Minecraft Mod 设计模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-03-14T02:00:06.000Z" title="发表于 2021-03-14 10:00:06">2021-03-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-10-17T03:36:18.667Z" title="更新于 2021-10-17 11:36:18">2021-10-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>71分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Minecraft-Mod-设计模式"><a href="#Minecraft-Mod-设计模式" class="headerlink" title="Minecraft Mod 设计模式"></a>Minecraft Mod 设计模式</h1><h2 id="0-概述"><a href="#0-概述" class="headerlink" title="0. 概述"></a>0. 概述</h2><p>源代码:<a target="_blank" rel="noopener" href="https://github.com/TheGreyGhost/MinecraftByExample">MinecraftByExample</a><br>机制分析:<a target="_blank" rel="noopener" href="https://greyminecraftcoder.blogspot.com/p/list-of-topics-1144.html">MinecraftModding</a></p>
<p>本文主要是把各种特定的目标的特定模式(套路)总结下来(针对 1.15.x,1.16.x 应该也 ok,但是更早的版本就不可以了)</p>
<h2 id="1-项目模式"><a href="#1-项目模式" class="headerlink" title="1. 项目模式"></a>1. 项目模式</h2><h3 id="1-1-mods-toml"><a href="#1-1-mods-toml" class="headerlink" title="1.1 mods.toml"></a>1.1 mods.toml</h3><p>首先 toml 是一种文档格式:<a target="_blank" rel="noopener" href="https://toml.io/cn/v1.0.0-rc.1">toml 文档格式</a><br>然后 mods.toml 位于<code>resources/META-INF/mods.toml</code>中,用于描述 mod 的一些配置<br>forge 的 mods.toml 格式:<a target="_blank" rel="noopener" href="https://mcforge.readthedocs.io/en/latest/gettingstarted/structuring/">mods.toml 格式</a></p>
<figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 必填项</span></span><br><span class="line"><span class="comment"># mod loader的类型,对于FML,通常是javafml</span></span><br><span class="line"><span class="attr">modLoader</span>=<span class="string">&quot;javafml&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 必填项</span></span><br><span class="line"><span class="comment"># 匹配的mod loader的版本,对于FML应该写forge的版本</span></span><br><span class="line"><span class="attr">loaderVersion</span>=<span class="string">&quot;[28,)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选填项</span></span><br><span class="line"><span class="comment"># mod出问题后的反馈网址,可以填Github的issues区网址</span></span><br><span class="line"><span class="attr">issueTrackerURL</span>=<span class="string">&quot;https://github.com/TheGreyGhost/MinecraftByExample/issues&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 必填项</span></span><br><span class="line"><span class="comment"># mod相关信息</span></span><br><span class="line"><span class="section">[[mods]]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># mod的id,需要与主类中的一致</span></span><br><span class="line">    <span class="attr">modId</span>=<span class="string">&quot;minecraftbyexample&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 必填项</span></span><br><span class="line">    <span class="comment"># mod的版本,可以用一些特殊变量:$&#123;global.mcVersion&#125;, $&#123;global.forgeVersion&#125;, &#123;$file.jarVersion&#125;</span></span><br><span class="line">    <span class="comment"># 特殊变量会自动从build.gradle中获取</span></span><br><span class="line">    <span class="attr">version</span>=<span class="string">&quot;$&#123;file.jarVersion&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 必填项</span></span><br><span class="line">    <span class="comment"># mod的显示名</span></span><br><span class="line">    <span class="attr">displayName</span>=<span class="string">&quot;Minecraft By Example&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 选填项</span></span><br><span class="line">    <span class="comment"># 更新查询URL</span></span><br><span class="line">    <span class="attr">updateJSONURL</span>=<span class="string">&quot;http://myurl.me/&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 选填项</span></span><br><span class="line">    <span class="comment"># 在游戏中显示的mod主页</span></span><br><span class="line">    <span class="attr">displayURL</span>=<span class="string">&quot;https://github.com/TheGreyGhost/MinecraftByExample&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 选填项</span></span><br><span class="line">    <span class="comment"># 位于mod jar包根目录的文件名,在游戏中展示的logo</span></span><br><span class="line">    <span class="attr">logoFile</span>=<span class="string">&quot;thegreyghostproudlypresents.png&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 选填项</span></span><br><span class="line">    <span class="comment"># 致谢文字</span></span><br><span class="line">    <span class="attr">credits</span>=<span class="string">&quot;The Forge, MCP, and FML guys, for making it possible&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 选填项</span></span><br><span class="line">    <span class="comment"># 作者</span></span><br><span class="line">    <span class="attr">authors</span>=<span class="string">&quot;TGG and others&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 必填项</span></span><br><span class="line">    <span class="comment"># mod的描述文字(多行)</span></span><br><span class="line">    <span class="attr">description</span>=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Minecraft By Example - a collection of simple working examples of the important concepts in Minecraft and Forge.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选填项</span></span><br><span class="line"><span class="comment"># 用于描述mod间的依赖关系,可以有多个</span></span><br><span class="line"><span class="section">[[dependencies.examplemod]]</span></span><br><span class="line">    <span class="comment"># 被依赖的 mod 的id(必填项)</span></span><br><span class="line">    <span class="attr">modId</span>=<span class="string">&quot;forge&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 被依赖的mod是否必须存在(必填项)</span></span><br><span class="line">    <span class="comment"># 如果是false,则后面的 ordering 项必须填</span></span><br><span class="line">    <span class="attr">mandatory</span>=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 被依赖mod的版本(必填项)</span></span><br><span class="line">    <span class="attr">versionRange</span>=<span class="string">&quot;[28,)&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 是否必填与前面的 mandatory 设置有关</span></span><br><span class="line">    <span class="comment"># 与被依赖包的关系,BEFORE/AFTER</span></span><br><span class="line">    <span class="comment"># (说实话没太明白...)</span></span><br><span class="line">    <span class="attr">ordering</span>=<span class="string">&quot;NONE&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 描述mod运行的位置,BOTH/CLIENT/SERVER(必填项)</span></span><br><span class="line">    <span class="attr">side</span>=<span class="string">&quot;BOTH&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="section">[[dependencies.examplemod]]</span></span><br><span class="line">    <span class="attr">modId</span>=<span class="string">&quot;minecraft&quot;</span></span><br><span class="line">    <span class="attr">mandatory</span>=<span class="literal">true</span></span><br><span class="line">    <span class="attr">versionRange</span>=<span class="string">&quot;[1.14.4]&quot;</span></span><br><span class="line">    <span class="attr">ordering</span>=<span class="string">&quot;NONE&quot;</span></span><br><span class="line">    <span class="attr">side</span>=<span class="string">&quot;BOTH&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="1-2-build-gradle"><a href="#1-2-build-gradle" class="headerlink" title="1.2 build.gradle"></a>1.2 build.gradle</h3><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// places in this file that you should customise:</span></span><br><span class="line"><span class="comment">// add your mod info to version, group, archivesBaseName</span></span><br><span class="line"><span class="comment">// add your mod&#x27;s root source folder to minecraft.runs.client.mod, minecraft.runs.server.mod, minecraft.runs.data.mod</span></span><br><span class="line"><span class="comment">// add your mod&#x27;s info to jar.manifest.attributes (optional)</span></span><br><span class="line"><span class="comment">// if you&#x27;re updating the forge version:</span></span><br><span class="line"><span class="comment">//  Easiest way is to download the new forge mdk, decompress it, then look in the build.gradle file to copy the settings for</span></span><br><span class="line"><span class="comment">//  minecraft mappings channel, and dependencies.minecraft</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">buildscript</span> &#123;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        maven &#123; url = <span class="string">&#x27;https://files.minecraftforge.net/maven&#x27;</span> &#125;</span><br><span class="line">        jcenter()</span><br><span class="line">        mavenCentral()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">dependencies</span> &#123;</span><br><span class="line">        <span class="keyword">classpath</span> <span class="keyword">group</span>: <span class="string">&#x27;net.minecraftforge.gradle&#x27;</span>, name: <span class="string">&#x27;ForgeGradle&#x27;</span>, version: <span class="string">&#x27;3.+&#x27;</span>, changing: <span class="keyword">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">apply plugin: <span class="string">&#x27;net.minecraftforge.gradle&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以上部分是添加forge支持必要的部分</span></span><br><span class="line"><span class="comment">// ============================== 分割线 ==============================</span></span><br><span class="line"><span class="comment">// 以下部分是可以修改的部分</span></span><br><span class="line"></span><br><span class="line">apply plugin: <span class="string">&#x27;eclipse&#x27;</span></span><br><span class="line">apply plugin: <span class="string">&#x27;maven-publish&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 在这里添加mod的信息</span></span><br><span class="line"><span class="comment">// 版本信息</span></span><br><span class="line"><span class="comment">// 作者所有项目的通用顶级包名</span></span><br><span class="line"><span class="comment">// 归档名,项目名全小写</span></span><br><span class="line">version = <span class="string">&quot;1.15.2b&quot;</span></span><br><span class="line"><span class="keyword">group</span>= <span class="string">&quot;thegreyghost&quot;</span><span class="comment">// http://maven.apache.org/guides/mini/guide-naming-conventions.html</span></span><br><span class="line">archivesBaseName = <span class="string">&quot;minecraftbyexample&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Need this here so eclipse task generates correctly.</span></span><br><span class="line"><span class="keyword">sourceCompatibility</span> = <span class="keyword">targetCompatibility</span> = compileJava.<span class="keyword">sourceCompatibility</span> = compileJava.<span class="keyword">targetCompatibility</span> = <span class="string">&#x27;1.8&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">minecraft &#123;</span><br><span class="line">    <span class="comment">// The mappings can be changed at any time, and must be in the following format.</span></span><br><span class="line">    <span class="comment">// snapshot_YYYYMMDD   Snapshot are built nightly.</span></span><br><span class="line">    <span class="comment">// stable_#            Stables are built at the discretion of the MCP team.</span></span><br><span class="line">    <span class="comment">// Use non-default mappings at your own risk. they may not always work.</span></span><br><span class="line">    <span class="comment">// Simply re-run your setup task after changing the mappings to update your workspace.</span></span><br><span class="line">    mappings channel: <span class="string">&#x27;snapshot&#x27;</span>, version: <span class="string">&#x27;20200514-1.15.1&#x27;</span></span><br><span class="line">    <span class="comment">// makeObfSourceJar = false // an Srg named sources jar is made by default. uncomment this to disable.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// accessTransformer = file(&#x27;src/main/resources/META-INF/accesstransformer.cfg&#x27;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Default run configurations.</span></span><br><span class="line">        <span class="comment">// 可以调整的部分,对应IDE中genIdeaRuns后产生的不同运行设置</span></span><br><span class="line">        runs &#123;</span><br><span class="line">            client &#123;</span><br><span class="line">                workingDirectory <span class="keyword">project</span>.<span class="keyword">file</span>(<span class="string">&#x27;run&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Recommended logging data for a userdev environment</span></span><br><span class="line">                property <span class="string">&#x27;forge.logging.markers&#x27;</span>, <span class="string">&#x27;SCAN,REGISTRIES,REGISTRYDUMP&#x27;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Recommended logging level for the console</span></span><br><span class="line">                property <span class="string">&#x27;forge.logging.console.level&#x27;</span>, <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">                mods &#123;</span><br><span class="line">                    minecraftbyexample &#123;</span><br><span class="line">                        <span class="keyword">source</span> <span class="keyword">sourceSets</span>.main</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            clientfewerconsolemessages &#123;</span><br><span class="line">                workingDirectory <span class="keyword">project</span>.<span class="keyword">file</span>(<span class="string">&#x27;run&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Recommended logging data for a userdev environment</span></span><br><span class="line">                property <span class="string">&#x27;forge.logging.markers&#x27;</span>, <span class="string">&#x27;SCAN,REGISTRIES,REGISTRYDUMP&#x27;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Recommended logging level for the console</span></span><br><span class="line">                property <span class="string">&#x27;forge.logging.console.level&#x27;</span>, <span class="string">&#x27;warn&#x27;</span></span><br><span class="line"></span><br><span class="line">                mods &#123;</span><br><span class="line">                    minecraftbyexample &#123;</span><br><span class="line">                        <span class="keyword">source</span> <span class="keyword">sourceSets</span>.main</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            server &#123;</span><br><span class="line">                workingDirectory <span class="keyword">project</span>.<span class="keyword">file</span>(<span class="string">&#x27;run&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Recommended logging data for a userdev environment</span></span><br><span class="line">                property <span class="string">&#x27;forge.logging.markers&#x27;</span>, <span class="string">&#x27;SCAN,REGISTRIES,REGISTRYDUMP&#x27;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// Recommended logging level for the console</span></span><br><span class="line">                property <span class="string">&#x27;forge.logging.console.level&#x27;</span>, <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">                mods &#123;</span><br><span class="line">                    minecraftbyexample &#123;</span><br><span class="line">                        <span class="keyword">source</span> <span class="keyword">sourceSets</span>.main</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data &#123;</span><br><span class="line">            workingDirectory <span class="keyword">project</span>.<span class="keyword">file</span>(<span class="string">&#x27;run&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Recommended logging data for a userdev environment</span></span><br><span class="line">            property <span class="string">&#x27;forge.logging.markers&#x27;</span>, <span class="string">&#x27;SCAN,REGISTRIES,REGISTRYDUMP&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// Recommended logging level for the console</span></span><br><span class="line">            property <span class="string">&#x27;forge.logging.console.level&#x27;</span>, <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">            args <span class="string">&#x27;--mod&#x27;</span>, <span class="string">&#x27;minecraftbyexample&#x27;</span>, <span class="string">&#x27;--all&#x27;</span>, <span class="string">&#x27;--output&#x27;</span>, <span class="keyword">file</span>(<span class="string">&#x27;src/generated/resources/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            mods &#123;</span><br><span class="line">                minecraftbyexample &#123;</span><br><span class="line">                    <span class="keyword">source</span> <span class="keyword">sourceSets</span>.main</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="comment">// Specify the version of Minecraft to use, If this is any group other then &#x27;net.minecraft&#x27; it is assumed</span></span><br><span class="line">    <span class="comment">// that the dep is a ForgeGradle &#x27;patcher&#x27; dependency. And its patches will be applied.</span></span><br><span class="line">    <span class="comment">// The userdev artifact is a special name and will get all sorts of transformations applied to it.</span></span><br><span class="line">    minecraft <span class="string">&#x27;net.minecraftforge:forge:1.15.2-31.2.0&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// You may put jars on which you depend on in ./libs or you may define them like so..</span></span><br><span class="line">    <span class="comment">// compile &quot;some.group:artifact:version:classifier&quot;</span></span><br><span class="line">    <span class="comment">// compile &quot;some.group:artifact:version&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Real examples</span></span><br><span class="line">    <span class="comment">// compile &#x27;com.mod-buildcraft:buildcraft:6.0.8:dev&#x27;  // adds buildcraft to the dev env</span></span><br><span class="line">    <span class="comment">// compile &#x27;com.googlecode.efficient-java-matrix-library:ejml:0.24&#x27; // adds ejml to the dev env</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// The &#x27;provided&#x27; configuration is for optional dependencies that exist at compile-time but might not at runtime.</span></span><br><span class="line">    <span class="comment">// provided &#x27;com.mod-buildcraft:buildcraft:6.0.8:dev&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// These dependencies get remapped to your current MCP mappings</span></span><br><span class="line">    <span class="comment">// deobf &#x27;com.mod-buildcraft:buildcraft:6.0.8:dev&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// For more info...</span></span><br><span class="line">    <span class="comment">// http://www.gradle.org/docs/current/userguide/artifact_dependencies_tutorial.html</span></span><br><span class="line">    <span class="comment">// http://www.gradle.org/docs/current/userguide/dependency_management.html</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example for how to get properties into the manifest for reading by the runtime..</span></span><br><span class="line">jar &#123;</span><br><span class="line">    manifest &#123;</span><br><span class="line">        attributes([</span><br><span class="line">            <span class="string">&quot;Specification-Title&quot;</span>: <span class="string">&quot;minecraftbyexample&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Specification-Vendor&quot;</span>: <span class="string">&quot;thegreyghost&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Specification-Version&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="comment">// The version number of the specification, not the version of the mod</span></span><br><span class="line">            <span class="string">&quot;Implementation-Title&quot;</span>: <span class="keyword">project</span>.name,</span><br><span class="line">            <span class="string">&quot;Implementation-Version&quot;</span>: <span class="string">&quot;$&#123;version&#125;&quot;</span>,  <span class="comment">// the version number of the mod.  copy the version from earlier in this file</span></span><br><span class="line">            <span class="string">&quot;Implementation-Vendor&quot;</span> :<span class="string">&quot;thegreyghost&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Implementation-Timestamp&quot;</span>: <span class="keyword">new</span> Date().format(<span class="string">&quot;yyyy-MM-dd&#x27;T&#x27;HH:mm:ssZ&quot;</span>)</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Example configuration to allow publishing using the maven-publish task</span></span><br><span class="line"><span class="comment">// we define a custom artifact that is sourced from the reobfJar output task</span></span><br><span class="line"><span class="comment">// and then declare that to be published</span></span><br><span class="line"><span class="comment">// Note you&#x27;ll need to add a repository here</span></span><br><span class="line"><span class="keyword">def</span> reobfFile = <span class="keyword">file</span>(<span class="string">&quot;$buildDir/reobfJar/output.jar&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> reobfArtifact = <span class="keyword">artifacts</span>.add(<span class="string">&#x27;default&#x27;</span>, reobfFile) &#123;</span><br><span class="line">    type <span class="string">&#x27;jar&#x27;</span></span><br><span class="line">    builtBy <span class="string">&#x27;reobfJar&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">publishing &#123;</span><br><span class="line">    publications &#123;</span><br><span class="line">        mavenJava(MavenPublication) &#123;</span><br><span class="line">            artifact reobfArtifact</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">repositories</span> &#123;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url <span class="string">&quot;file:///$&#123;project.projectDir&#125;/mcmodsrepo&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-代码模式"><a href="#2-代码模式" class="headerlink" title="2. 代码模式"></a>2. 代码模式</h2><h3 id="2-1-Mod-主类"><a href="#2-1-Mod-主类" class="headerlink" title="2.1 Mod 主类"></a>2.1 Mod 主类</h3><p>注册时总线触发事件的顺序:</p>
<ul>
<li>Registry Events<ul>
<li>onBlocksRegistration</li>
<li>onItemsRegistration</li>
</ul>
</li>
<li>Data Generation</li>
<li>Common Setup</li>
<li>Sided Setup<ul>
<li>FMLClientSetupEvent</li>
<li>FMLDedicatedServerSetupEvent</li>
</ul>
</li>
<li>InterModComms<ul>
<li>InterModEnqueueEvent</li>
<li>InterModProcessEvent</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mod(MinecraftByExample.MODID)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinecraftByExample</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 首先是一个 MODID,唯一标识 Mod,同时一般会设置为 Mod 空间的前缀</span></span><br><span class="line">    <span class="comment">// 这个 MODID 需要与 build.gradle file 中的匹配</span></span><br><span class="line">    <span class="comment">// 同时需要在 resources/META-INF/mods.toml 中声明</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MODID = <span class="string">&quot;minecraftbyexample&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 因为要注册很多监听器,用一个静态变量把事件总线存起来</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> IEventBus MOD_EVENT_BUS;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MinecraftByExample</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 设置一些 Log 工具</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> HIDE_CONSOLE_NOISE = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (HIDE_CONSOLE_NOISE) &#123;</span><br><span class="line">            ForgeLoggerTweaker.setMinimumLevel(Level.WARN);</span><br><span class="line">            ForgeLoggerTweaker.applyLoggerFilter();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化事件总线</span></span><br><span class="line">        MOD_EVENT_BUS = FMLJavaModLoadingContext.get().getModEventBus();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 注册共用的事件处理</span></span><br><span class="line">        registerCommonEvents();</span><br><span class="line">        <span class="comment">// 注册客户端特有的事件处理</span></span><br><span class="line">        DistExecutor.runWhenOn(Dist.CLIENT, () -&gt; MinecraftByExample::registerClientOnlyEvents);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerCommonEvents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 把不同部分需要注册监听的函数抽象成类,直接注册整个类</span></span><br><span class="line">        MOD_EVENT_BUS.register(minecraftbyexample.mbe01_block_simple.StartupCommon.class);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerClientOnlyEvents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MOD_EVENT_BUS.register(minecraftbyexample.mbe01_block_simple.StartupClientOnly.class);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-2-方块"><a href="#2-2-方块" class="headerlink" title="2.2 方块"></a>2.2 方块</h3><h4 id="2-2-1-简单方块"><a href="#2-2-1-简单方块" class="headerlink" title="2.2.1 简单方块"></a>2.2.1 简单方块</h4><h5 id="2-2-1-1-SimpleBlock-java"><a href="#2-2-1-1-SimpleBlock-java" class="headerlink" title="2.2.1.1 SimpleBlock.java"></a>2.2.1.1 SimpleBlock.java</h5><p>定义一个类,继承 Block 类,重载 getRenderType 函数,返回一个渲染方法<br>不同渲染方法介绍:<a target="_blank" rel="noopener" href="https://greyminecraftcoder.blogspot.com/2020/04/block-rendering-1144.html">渲染方法</a></p>
<h5 id="2-2-1-2-StartUpClientOnly-java"><a href="#2-2-1-2-StartUpClientOnly-java" class="headerlink" title="2.2.1.2 StartUpClientOnly.java"></a>2.2.1.2 StartUpClientOnly.java</h5><p>提供仅在客户端完成的初始化(同时需要在主类中添加这个类的监听)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartupClientOnly</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SubscribeEvent</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onClientSetupEvent</span><span class="params">(FMLClientSetupEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 在客户端独有部分设置 渲染部分</span></span><br><span class="line">        RenderTypeLookup.setRenderLayer(StartupCommon.blockSimple, RenderType.getSolid());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-1-3-StartUpCommon-java"><a href="#2-2-1-3-StartUpCommon-java" class="headerlink" title="2.2.1.3 StartUpCommon.java"></a>2.2.1.3 StartUpCommon.java</h5><p>提供客户端和服务器都需要完成的设置(同时需要在主类中添加这个类的监听)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartupCommon</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 之所以选择把实例放在 StartUpCommon 而不是 StartupClientOnly</span></span><br><span class="line">    <span class="comment">// 是因为 StartUpCommon 在服务器执行的时候绝对不能访问任何只在客户端运行的类</span></span><br><span class="line">    <span class="comment">// 一种方块只维护一个实例对象,然后需要一个与之对应的 item 对象</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BlockSimple blockSimple;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BlockItem itemBlockSimple;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SubscribeEvent</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onBlocksRegistration</span><span class="params">(<span class="keyword">final</span> RegistryEvent.Register&lt;Block&gt; blockRegisterEvent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 实例化对象,设置方块域名(设置成主类.MODID更好)和方块本身名字</span></span><br><span class="line">        <span class="comment">// 然后注册之</span></span><br><span class="line">        blockSimple = (BlockSimple)(<span class="keyword">new</span> BlockSimple().setRegistryName(<span class="string">&quot;minecraftbyexample&quot;</span>, <span class="string">&quot;mbe01_block_simple_registry_name&quot;</span>));</span><br><span class="line">        blockRegisterEvent.getRegistry().register(blockSimple);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SubscribeEvent</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onItemsRegistration</span><span class="params">(<span class="keyword">final</span> RegistryEvent.Register&lt;Item&gt; itemRegisterEvent)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_STACK_SIZE = <span class="number">20</span>;</span><br><span class="line">        <span class="comment">// 设置一些属性,如最大堆叠量,创造模式下的物品分组</span></span><br><span class="line">        Item.Properties itemSimpleProperties = <span class="keyword">new</span> Item.Properties()</span><br><span class="line">                                                       .maxStackSize(MAXIMUM_STACK_SIZE)</span><br><span class="line">                                                       .group(ItemGroup.BUILDING_BLOCKS);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 实例化对象并注册之</span></span><br><span class="line">        itemBlockSimple = <span class="keyword">new</span> BlockItem(blockSimple, itemSimpleProperties);</span><br><span class="line">        itemBlockSimple.setRegistryName(blockSimple.getRegistryName());</span><br><span class="line">        itemRegisterEvent.getRegistry().register(itemBlockSimple);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SubscribeEvent</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onCommonSetupEvent</span><span class="params">(FMLCommonSetupEvent event)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 一些其他设置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="2-2-1-4-国际化与区域化-人话-设置翻译文件"><a href="#2-2-1-4-国际化与区域化-人话-设置翻译文件" class="headerlink" title="2.2.1.4 国际化与区域化(人话:设置翻译文件)"></a>2.2.1.4 国际化与区域化(人话:设置翻译文件)</h5><p>在<code>assets.examplemod.lang</code>目录下添加语言文件:<code>en_us.json</code>,<code>zh_cn.json</code>等<br>更早的文件格式是<code>.lang</code>格式(参考早期的 forge 文档:<a target="_blank" rel="noopener" href="https://mcforge.readthedocs.io/en/1.12.x/concepts/internationalization/">1.12.x_forge 文档</a>)</p>
<p>其中添加材料在代码中的名命与对应的翻译</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;block.examplemod.simpleblock: &quot;简单方块&quot;,</span><br><span class="line">    &quot;...&quot;:&quot;...&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-1-5-模型相关的文件结构"><a href="#2-2-1-5-模型相关的文件结构" class="headerlink" title="2.2.1.5 模型相关的文件结构"></a>2.2.1.5 模型相关的文件结构</h5><p>在定义完方块的类之后,是没有给方块指定模型和纹理的<br>Forge 通过额外的配置文件来定义这些内容(而不是用 Java 代码进行注册)<br>下面的三个文件具体结构可以参考:<a target="_blank" rel="noopener" href="https://minecraft-zh.gamepedia.com/%E6%A8%A1%E5%9E%8B">模型相关文件结构</a></p>
<h6 id="simple-block-registry-json"><a href="#simple-block-registry-json" class="headerlink" title="simple_block_registry.json"></a>simple_block_registry.json</h6><p>在<code>assets.examplemod.blockstates</code>文件夹中定义特定的文件,来把定义的 Block 类和指定的模型,纹理连接起来</p>
<p>还有更复杂的条件语句,详细可以参考<a target="_blank" rel="noopener" href="https://minecraft-zh.gamepedia.com/%E6%A8%A1%E5%9E%8B">模型相关文件结构</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// variants(变体)中存放这个方块所有可能的变体的数据</span></span><br><span class="line">  <span class="attr">&quot;variants&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 如果只有一个变体,其名字用 &quot;&quot; 表示</span></span><br><span class="line">    <span class="attr">&quot;&quot;</span>: &#123;</span><br><span class="line">      <span class="comment">// 存放模型文件的路径</span></span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:block/mbe01_block_simple_model&quot;</span>,</span><br><span class="line">      <span class="comment">// 模型在xy轴上以90度的增量旋转</span></span><br><span class="line">      <span class="attr">&quot;x&quot;</span>: <span class="string">&quot;90&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;y&quot;</span>: <span class="string">&quot;90&quot;</span>,</span><br><span class="line">      <span class="comment">// 是否锁定旋转,如果锁定旋转,则当方块旋转时纹理不跟着旋转</span></span><br><span class="line">      <span class="attr">&quot;uvlock&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 需要注意,如果有多个变种,则第一个变种不可以取空名字</span></span><br><span class="line">    <span class="attr">&quot;variants-2&quot;</span>: [</span><br><span class="line">      <span class="comment">// 一个变种可以有多个可能的模型,实例化时会从中随机选择</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:block/mbe01_block_simple_model&quot;</span>,</span><br><span class="line">        <span class="comment">// 指定随机选择的权重(整数,默认为1)</span></span><br><span class="line">        <span class="attr">&quot;weight&quot;</span>: <span class="string">&quot;2&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:block/mbe01_block_simple_model&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;weight&quot;</span>: <span class="string">&quot;2&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:block/mbe01_block_simple_model&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;weight&quot;</span>: <span class="string">&quot;7&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="simple-block-model-json"><a href="#simple-block-model-json" class="headerlink" title="simple_block_model.json"></a>simple_block_model.json</h6><p>在<code>assets.examplemod.models.block</code>中定义模型文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 继承父类模型,子类的 elements 标签可以覆盖父类的</span></span><br><span class="line">  <span class="comment">// 还能设置为 &quot;builtin/generated&quot; ,使用从指定图标创建的模型</span></span><br><span class="line">  <span class="attr">&quot;parent&quot;</span>: <span class="string">&quot;block/cube&quot;</span>,</span><br><span class="line">  <span class="comment">// 是否启用环境光遮蔽</span></span><br><span class="line">  <span class="attr">&quot;ambientocclusion&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">  <span class="comment">// 纹理,对应不同的面</span></span><br><span class="line">  <span class="attr">&quot;textures&quot;</span>: &#123;</span><br><span class="line">    <span class="comment">// 方块对应的粒子特效</span></span><br><span class="line">    <span class="attr">&quot;particle&quot;</span>: <span class="string">&quot;block/simple_block&quot;</span>,</span><br><span class="line">    <span class="comment">// &quot;all&quot;:&quot;minecraftbyexample:block/simple_block&quot;,</span></span><br><span class="line">    <span class="attr">&quot;down&quot;</span>: <span class="string">&quot;minecraftbyexample:block/simple_block&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;up&quot;</span>: <span class="string">&quot;minecraftbyexample:block/simple_block&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;north&quot;</span>: <span class="string">&quot;minecraftbyexample:block/simple_block&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;east&quot;</span>: <span class="string">&quot;minecraftbyexample:block/simple_block&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;south&quot;</span>: <span class="string">&quot;minecraftbyexample:block/simple_block&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;west&quot;</span>: <span class="string">&quot;minecraftbyexample:block/simple_block&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 模型中的所有元素,可以有多个</span></span><br><span class="line">  <span class="attr">&quot;elements&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 起始点/终止点,数值在-16到32之间</span></span><br><span class="line">      <span class="attr">&quot;from&quot;</span>: [<span class="number">7</span>, <span class="number">0</span>, <span class="number">7</span>],</span><br><span class="line">      <span class="attr">&quot;to&quot;</span>: [<span class="number">9</span>, <span class="number">10</span>, <span class="number">9</span>],</span><br><span class="line">      <span class="comment">// 是否渲染阴影,默认为true</span></span><br><span class="line">      <span class="attr">&quot;shade&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">// 单个元素的所有面,如果没有定义该面则不渲染</span></span><br><span class="line">      <span class="comment">// down, up, north, south, west, east</span></span><br><span class="line">      <span class="attr">&quot;faces&quot;</span>: &#123;</span><br><span class="line">        <span class="comment">// uv:纹理贴图中的坐标范围,数值在0到16之间,默认为元素的位置</span></span><br><span class="line">        <span class="comment">// texture:贴图,变量前需要加上#</span></span><br><span class="line">        <span class="comment">// cullface:当这个方块与指定反向的方块连接时,是否需要渲染</span></span><br><span class="line">        <span class="attr">&quot;down&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">7</span>, <span class="number">13</span>, <span class="number">9</span>, <span class="number">15</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#torch&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;cullface&quot;</span>: <span class="string">&quot;south&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;up&quot;</span>: &#123; <span class="attr">&quot;uv&quot;</span>: [<span class="number">7</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>], <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#torch&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;from&quot;</span>: [<span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">      <span class="attr">&quot;to&quot;</span>: [<span class="number">9</span>, <span class="number">16</span>, <span class="number">16</span>],</span><br><span class="line">      <span class="attr">&quot;shade&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">&quot;faces&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;west&quot;</span>: &#123; <span class="attr">&quot;uv&quot;</span>: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>], <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#torch&quot;</span> &#125;,</span><br><span class="line">        <span class="attr">&quot;east&quot;</span>: &#123; <span class="attr">&quot;uv&quot;</span>: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">16</span>], <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#torch&quot;</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="simple-item-model-json"><a href="#simple-item-model-json" class="headerlink" title="simple_item_model.json"></a>simple_item_model.json</h6><p>在<code>assets.examplemod.models.item</code>中定义物品模型文件<br>其文件结构与方块模型文件结构基本一致,详细可以参考<a target="_blank" rel="noopener" href="https://minecraft-zh.gamepedia.com/%E6%A8%A1%E5%9E%8B">模型相关文件结构</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 可以直接继承方块的模型</span></span><br><span class="line">  <span class="attr">&quot;parent&quot;</span>: <span class="string">&quot;minecraftbyexample:block/mbe02_block_partial_model&quot;</span>,</span><br><span class="line">  <span class="comment">// 不同形态下的调整</span></span><br><span class="line">  <span class="attr">&quot;display&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;thirdperson_righthand&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;rotation&quot;</span>: [ <span class="number">66</span>, <span class="number">2</span>, <span class="number">0</span> ],</span><br><span class="line">      <span class="attr">&quot;translation&quot;</span>: [ <span class="number">0.00</span>, <span class="number">5.50</span>, <span class="number">3.25</span> ],</span><br><span class="line">      <span class="attr">&quot;scale&quot;</span>: [ <span class="number">0.60</span>, <span class="number">0.60</span>, <span class="number">0.60</span> ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;thirdperson_lefthand&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;rotation&quot;</span>: [ <span class="number">66</span>, <span class="number">2</span>, <span class="number">0</span> ],</span><br><span class="line">      <span class="attr">&quot;translation&quot;</span>: [ <span class="number">0.00</span>, <span class="number">5.50</span>, <span class="number">3.25</span> ],</span><br><span class="line">      <span class="attr">&quot;scale&quot;</span>: [ <span class="number">0.60</span>, <span class="number">0.60</span>, <span class="number">0.60</span> ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="simple-block-loot-table-json"><a href="#simple-block-loot-table-json" class="headerlink" title="simple_block_loot_table.json"></a>simple_block_loot_table.json</h6><p>在<code>data.examplemod.loot_tables.blocks</code>中定义方块被破坏后的<code>loot_table</code>(战利品表)文件<br>详细可以参考:<a target="_blank" rel="noopener" href="https://minecraft-zh.gamepedia.com/%E6%88%98%E5%88%A9%E5%93%81%E8%A1%A8">战利品表</a></p>
<p>简单方块的示例</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 战利品类型</span></span><br><span class="line">  <span class="comment">// minecraft:empty(不产生掉落物),minecraft:entity(实体掉落物),minecraft:block(方块 掉落物)</span></span><br><span class="line">  <span class="comment">// 详见参考网址</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;minecraft:block&quot;</span>,</span><br><span class="line">  <span class="comment">// 掉落物随机池</span></span><br><span class="line">  <span class="attr">&quot;pools&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 从当前随机池抽取的次数</span></span><br><span class="line">      <span class="comment">// 还可以为范围和二项分布(略)</span></span><br><span class="line">      <span class="comment">// &quot;rolls&quot;:&#123;</span></span><br><span class="line">      <span class="comment">//   &quot;min&quot;:&quot;1&quot;,</span></span><br><span class="line">      <span class="comment">//   &quot;max&quot;:&quot;4&quot;</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="attr">&quot;rolls&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="comment">// 当前随机池能产生的物品列表</span></span><br><span class="line">      <span class="attr">&quot;entries&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;minecraft:item&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;minecraftbyexample:mbe01_block_simple_registry_name&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 使用这个随机池的条件</span></span><br><span class="line">      <span class="attr">&quot;conditions&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;condition&quot;</span>: <span class="string">&quot;minecraft:survives_explosion&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-2-非完整方块"><a href="#2-2-2-非完整方块" class="headerlink" title="2.2.2 非完整方块"></a>2.2.2 非完整方块</h4><p>在搭建简单方块的基础上,可以搭建一些非完整的(占满 1 格空间的)方块</p>
<p>保持<code>StartUpClientOnly.java</code>和<code>StartUpCommon.java</code>基本一致<br>主要改动在模型文件和方块类本身</p>
<h5 id="2-2-2-1-BlockPartial-java"><a href="#2-2-2-1-BlockPartial-java" class="headerlink" title="2.2.2.1 BlockPartial.java"></a>2.2.2.1 BlockPartial.java</h5><p>与普通方块最大的不同在于两点:设置可以通过和修改渲染模型</p>
<p>可以通过重载不同的方法,来修改不同的模型,不同的模型作用及制作方法介绍:<a target="_blank" rel="noopener" href="https://greyminecraftcoder.blogspot.com/2020/02/block-shapes-voxelshapes-1144.html">模型作用及制作</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockPartial</span> <span class="keyword">extends</span> <span class="title">Block</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 声明一些模型的重要点坐标</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Vec3d BASE_MIN_CORNER = <span class="keyword">new</span> Vec3d(<span class="number">2.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Vec3d BASE_MAX_CORNER = <span class="keyword">new</span> Vec3d(<span class="number">14.0</span>, <span class="number">1.0</span>, <span class="number">16.0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Vec3d PILLAR_MIN_CORNER = <span class="keyword">new</span> Vec3d(<span class="number">7.0</span>, <span class="number">1.0</span>, <span class="number">6.0</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Vec3d PILLAR_MAX_CORNER = <span class="keyword">new</span> Vec3d(<span class="number">9.0</span>, <span class="number">8.0</span>, <span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 声明两个基本形状</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> VoxelShape BASE = Block.makeCuboidShape(</span><br><span class="line">    BASE_MIN_CORNER.getX(), BASE_MIN_CORNER.getY(), BASE_MIN_CORNER.getZ(),</span><br><span class="line">    BASE_MAX_CORNER.getX(), BASE_MAX_CORNER.getY(), BASE_MAX_CORNER.getZ());</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> VoxelShape PILLAR = Block.makeCuboidShape(</span><br><span class="line">    PILLAR_MIN_CORNER.getX(), PILLAR_MIN_CORNER.getY(), PILLAR_MIN_CORNER.getZ(),</span><br><span class="line">    PILLAR_MAX_CORNER.getX(), PILLAR_MAX_CORNER.getY(), PILLAR_MAX_CORNER.getZ());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把两个基本形状组合</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> VoxelShape COMBINED_SHAPE = VoxelShapes.or(BASE, PILLAR);  <span class="comment">// use this method to add two shapes together</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从第一个形状上剪切出形状</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> VoxelShape EMPTY_SPACE = VoxelShapes.combineAndSimplify(VoxelShapes.fullCube(), COMBINED_SHAPE, IBooleanFunction.ONLY_FIRST);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BlockPartial</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 设置方块可以通过</span></span><br><span class="line">    <span class="keyword">super</span>(Block.Properties.create(Material.WOOD).doesNotBlockMovement());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修改方块的渲染模型</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> VoxelShape <span class="title">getShape</span><span class="params">(BlockState state, IBlockReader worldIn, BlockPos pos, ISelectionContext context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> COMBINED_SHAPE;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-2-2-partial-block-model-json"><a href="#2-2-2-2-partial-block-model-json" class="headerlink" title="2.2.2.2 partial_block_model.json"></a>2.2.2.2 partial_block_model.json</h5><p>然后是需要模型文件与主类文件中声明的模型对应起来(也可以不对应起来,就像告示牌一样)</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;ambientocclusion&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;textures&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;particle&quot;</span>: <span class="string">&quot;block/lapis_block&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;base&quot;</span>: <span class="string">&quot;block/lapis_block&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;pole&quot;</span>: <span class="string">&quot;block/stone&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;elements&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;from&quot;</span>: [<span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">      <span class="attr">&quot;to&quot;</span>: [<span class="number">14</span>, <span class="number">1</span>, <span class="number">16</span>],</span><br><span class="line">      <span class="attr">&quot;shade&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">&quot;faces&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;down&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">2</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">16</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#base&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;up&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">2</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">16</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#base&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;east&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">16</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#base&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;west&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">16</span>, <span class="number">1</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#base&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;north&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">14</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#base&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;south&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">2</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">1</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#base&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;from&quot;</span>: [<span class="number">7</span>, <span class="number">1</span>, <span class="number">6</span>],</span><br><span class="line">      <span class="attr">&quot;to&quot;</span>: [<span class="number">9</span>, <span class="number">8</span>, <span class="number">10</span>],</span><br><span class="line">      <span class="attr">&quot;shade&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">&quot;faces&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;up&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">7</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#pole&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;east&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">6</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">8</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#pole&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;west&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">6</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">8</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#pole&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;north&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">7</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">8</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#pole&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;south&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;uv&quot;</span>: [<span class="number">7</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">8</span>],</span><br><span class="line">          <span class="attr">&quot;texture&quot;</span>: <span class="string">&quot;#pole&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-3-方块变体"><a href="#2-2-3-方块变体" class="headerlink" title="2.2.3 方块变体"></a>2.2.3 方块变体</h4><p>方块变体总体有两种思路:</p>
<ol>
<li>每个变体建一个模型,不同的变体选择不同的模型<br>采用这种方法的方块有各种材料的楼梯,每个不同的反向都是采用不同模型的变体</li>
<li>把所有变体抽象出一个核心,然后再向不同的方向进行扩展<br>采用这种方法的方块有栅栏,其核心是一根棍子,不同方向扩展的模型是横栏</li>
</ol>
<p>第一种方法在变种较少时比较简单,但是如果变种太多时会非常繁琐(如栅栏的六个方向)</p>
<h5 id="2-2-3-1-多模型方法"><a href="#2-2-3-1-多模型方法" class="headerlink" title="2.2.3.1 多模型方法"></a>2.2.3.1 多模型方法</h5><p>首先一点,想要使用不同的模型只需要在调用<code>getShape</code>方法时返回不同的模型即可<br>其他的一些扩展(如颜色)可以直接通过实例化多个对象,然后赋值不同的颜色即可</p>
<h6 id="2-2-3-1-1-不同的颜色"><a href="#2-2-3-1-1-不同的颜色" class="headerlink" title="2.2.3.1.1 不同的颜色"></a>2.2.3.1.1 不同的颜色</h6><p>在内部维护一个颜色变量(EnumColour)用来表示不同的方块颜色<br>然后在<code>StartUpCommon.java</code>中实例化多个不同颜色的方块并实例化即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 实现一个内部颜色枚举,用于表示方块的不同颜色</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">EnumColour</span> <span class="keyword">implements</span> <span class="title">IStringSerializable</span></span>&#123;</span><br><span class="line">    BLUE(<span class="string">&quot;blue&quot;</span>),</span><br><span class="line">    RED(<span class="string">&quot;red&quot;</span>),</span><br><span class="line">    GREEN(<span class="string">&quot;green&quot;</span>),</span><br><span class="line">    YELLOW(<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">EnumColour</span><span class="params">(String i_name)</span></span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = i_name;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="2-2-3-1-2-不同的模型"><a href="#2-2-3-1-2-不同的模型" class="headerlink" title="2.2.3.1.2 不同的模型"></a>2.2.3.1.2 不同的模型</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 维护一个方向变量</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> DirectionProperty FACING = HorizontalBlock.HORIZONTAL_FACING;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重载 fillStateContainer 方法,并在其中把上面的变量添加进去</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">fillStateContainer</span><span class="params">(StateContainer.Builder&lt;Block, BlockState&gt; builder)</span> </span>&#123;</span><br><span class="line">    builder.add(FACING);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在构造函数中可以设置默认状态</span></span><br><span class="line">  &#123;</span><br><span class="line">    BlockState defaultBlockState = <span class="keyword">this</span>.stateContainer.getBaseState()</span><br><span class="line">                                                      .with(FACING, Direction.NORTH);</span><br><span class="line">    <span class="keyword">this</span>.setDefaultState(defaultBlockState);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重载 getStateForPlacement,以在方块放下的时候设置方块的状态</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> BlockState <span class="title">getStateForPlacement</span><span class="params">(BlockItemUseContext blockItemUseContext)</span> </span>&#123;</span><br><span class="line">    World world = blockItemUseContext.getWorld();</span><br><span class="line">    BlockPos blockPos = blockItemUseContext.getPos();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 水平朝向</span></span><br><span class="line">    Direction direction = blockItemUseContext.getPlacementHorizontalFacing();</span><br><span class="line">    <span class="comment">// 可以根据俯仰角再设置一些其他属性</span></span><br><span class="line">    <span class="keyword">float</span> playerFacingDirectionAngle = blockItemUseContext.getPlacementYaw();</span><br><span class="line"></span><br><span class="line">    BlockState blockState = getDefaultState().with(FACING, direction);</span><br><span class="line">    <span class="keyword">return</span> blockState;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//维护一个方向到模型的映射(不可修改的Map)</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Direction, VoxelShape&gt; POST_SHAPES =</span><br><span class="line">        ImmutableMap.of(Direction.NORTH,POST_SHAPE_N,</span><br><span class="line">                        Direction.EAST,POST_SHAPE_E,</span><br><span class="line">                        Direction.SOUTH,POST_SHAPE_S,</span><br><span class="line">                        Direction.WEST,POST_SHAPE_W);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 最后一步,重载 getShape 方法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> VoxelShape <span class="title">getShape</span><span class="params">(BlockState state, IBlockReader worldIn, BlockPos pos, ISelectionContext context)</span> </span>&#123;</span><br><span class="line">    Direction direction = state.get(FACING);</span><br><span class="line">    VoxelShape voxelShape = POST_SHAPES.get(direction);</span><br><span class="line">    <span class="comment">// 保护性写法</span></span><br><span class="line">    <span class="keyword">return</span> voxelShape != <span class="keyword">null</span> ? voxelShape : VoxelShapes.fullCube();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-3-2-核心-扩展方法"><a href="#2-2-3-2-核心-扩展方法" class="headerlink" title="2.2.3.2 核心-扩展方法"></a>2.2.3.2 核心-扩展方法</h5><p>四个方向,如果用第一种方法,一共需要 16 种模型,可以使用核心-扩展的方法简化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 给每个方向都设置一个属性,并注册进 BlockState 中</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BooleanProperty UP = BlockStateProperties.UP;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BooleanProperty DOWN = BlockStateProperties.DOWN;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BooleanProperty WEST = BlockStateProperties.WEST;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BooleanProperty EAST = BlockStateProperties.EAST;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BooleanProperty NORTH = BlockStateProperties.NORTH;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BooleanProperty SOUTH = BlockStateProperties.SOUTH;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">fillStateContainer</span><span class="params">(StateContainer.Builder&lt;Block, BlockState&gt; builder)</span> </span>&#123;</span><br><span class="line">    builder.add(UP, DOWN, WEST, EAST, NORTH, SOUTH, WATERLOGGED);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在放下此方块时设置其状态</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> BlockState <span class="title">getStateForPlacement</span><span class="params">(BlockItemUseContext blockItemUseContext)</span> </span>&#123;</span><br><span class="line">    World world = blockItemUseContext.getWorld();</span><br><span class="line">    BlockPos blockPos = blockItemUseContext.getPos();</span><br><span class="line"></span><br><span class="line">    BlockState blockState = getDefaultState();</span><br><span class="line">    <span class="comment">// 设置其与其他方块是否连接(是否渲染扩展部分)</span></span><br><span class="line">    blockState = setConnections(world, blockPos, blockState);</span><br><span class="line">    <span class="keyword">return</span> blockState;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 放下当前方块后马上检测周围方块是否可以连接,并设置自身状态</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> BlockState <span class="title">setConnections</span><span class="params">(IBlockReader iBlockReader, BlockPos blockPos, BlockState blockState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blockState</span><br><span class="line">            .with(UP, canWebAttachToNeighbourInThisDirection(iBlockReader, blockPos, Direction.UP))</span><br><span class="line">            .with(DOWN, canWebAttachToNeighbourInThisDirection(iBlockReader, blockPos, Direction.DOWN))</span><br><span class="line">            .with(WEST, canWebAttachToNeighbourInThisDirection(iBlockReader, blockPos, Direction.WEST))</span><br><span class="line">            .with(EAST, canWebAttachToNeighbourInThisDirection(iBlockReader, blockPos, Direction.EAST))</span><br><span class="line">            .with(NORTH, canWebAttachToNeighbourInThisDirection(iBlockReader, blockPos, Direction.NORTH))</span><br><span class="line">            .with(SOUTH, canWebAttachToNeighbourInThisDirection(iBlockReader, blockPos, Direction.SOUTH));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在其周围放下方块后,更新当前方块的状态</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> BlockState <span class="title">updatePostPlacement</span><span class="params">(BlockState thisBlockState, Direction directionFromThisToNeighbor,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        BlockState neighborState,IWorld world, BlockPos thisBlockPos,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        BlockPos neighborBlockPos)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (directionFromThisToNeighbor) &#123;</span><br><span class="line">      <span class="keyword">case</span> UP:</span><br><span class="line">        thisBlockState = thisBlockState.with(UP, canWebAttachToNeighbourInThisDirection(world, thisBlockPos, directionFromThisToNeighbor));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> DOWN:</span><br><span class="line">        thisBlockState = thisBlockState.with(DOWN, canWebAttachToNeighbourInThisDirection(world, thisBlockPos, directionFromThisToNeighbor));</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// 其余方向略</span></span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        LOGGER.error(<span class="string">&quot;Unexpected facing:&quot;</span> + directionFromThisToNeighbor);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> thisBlockState;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 准备核心部分和各个扩展部分的模型</span></span><br><span class="line">  <span class="comment">// 首先准备一个哈希表</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;BlockState, VoxelShape&gt; voxelShapeCache = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用一个函数负责初始化模型哈希表</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialiseShapeCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 可以通过这种方法快速得到所有属性的所有组合方式</span></span><br><span class="line">    <span class="keyword">for</span> (BlockState blockState : stateContainer.getValidStates()) &#123;</span><br><span class="line">      <span class="comment">// 根据不同属性的各种组合方式,组合核心和扩展部分,得到一大堆的模型,最后存到哈希表中</span></span><br><span class="line">      VoxelShape combinedShape = CORE_SHAPE;</span><br><span class="line">      <span class="keyword">if</span> (blockState.get(UP).booleanValue()) &#123;</span><br><span class="line">        combinedShape = VoxelShapes.or(combinedShape, LINK_UP_SHAPE);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (blockState.get(DOWN).booleanValue()) &#123;</span><br><span class="line">        combinedShape = VoxelShapes.or(combinedShape, LINK_DOWN_SHAPE);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (blockState.get(WEST).booleanValue()) &#123;</span><br><span class="line">        combinedShape = VoxelShapes.or(combinedShape, LINK_WEST_SHAPE);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (blockState.get(EAST).booleanValue()) &#123;</span><br><span class="line">        combinedShape = VoxelShapes.or(combinedShape, LINK_EAST_SHAPE);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (blockState.get(NORTH).booleanValue()) &#123;</span><br><span class="line">        combinedShape = VoxelShapes.or(combinedShape, LINK_NORTH_SHAPE);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (blockState.get(SOUTH).booleanValue()) &#123;</span><br><span class="line">        combinedShape = VoxelShapes.or(combinedShape, LINK_SOUTH_SHAPE);</span><br><span class="line">      &#125;</span><br><span class="line">      voxelShapeCache.put(blockState, combinedShape);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重载 getShape ,在不同情况下显示不同的模型</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> VoxelShape <span class="title">getShape</span><span class="params">(BlockState state, IBlockReader worldIn, BlockPos pos, ISelectionContext context)</span> </span>&#123;</span><br><span class="line">    VoxelShape voxelShape = voxelShapeCache.get(state);</span><br><span class="line">    <span class="comment">// 保护性写法</span></span><br><span class="line">    <span class="keyword">return</span> voxelShape != <span class="keyword">null</span> ? voxelShape : VoxelShapes.fullCube();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-2-4-方块动态模型-不常用"><a href="#2-2-4-方块动态模型-不常用" class="headerlink" title="2.2.4 方块动态模型(不常用)"></a>2.2.4 方块动态模型(不常用)</h4><p>需要渲染动态模型的例子:一个总是模仿周围方块的变色龙方块,指南针方块</p>
<p>首先,Forge 在初始化的时候,会读取模型文件,并构造一个<code>IBakedModel</code>对象来代表方块的模型<br>构造的对象会连同<code>ModelResourceLocation</code>对象一起存到一个哈希表中</p>
<p>我们要做的就是自己实现一个<code>IBakedModel</code>子类,构造一个对象,并替换掉 Forge 自己哈希表中<code>ModelResourceLocation</code>对象对应的<code>IBakedModel</code>对象</p>
<p>这个方面比较繁琐,同时用的比较少,以后用到了再看<br>具体细节可以参照 MBE 项目的第 4 个项目</p>
<h4 id="2-2-5-多层模型-不常用"><a href="#2-2-5-多层模型-不常用" class="headerlink" title="2.2.5 多层模型(不常用)"></a>2.2.5 多层模型(不常用)</h4><p>比如一个灯,外面时透明材质,里面是动画效果,则不能用一个单一的模型/材质渲染出来,可以考虑用多层模型来做<br>用的比较少,用到了再看,对应 MBE 中的第五个项目</p>
<h4 id="2-2-6-红石相关-非常不常用"><a href="#2-2-6-红石相关-非常不常用" class="headerlink" title="2.2.6 红石相关(非常不常用)"></a>2.2.6 红石相关(非常不常用)</h4><p>主要用于处理红石相关的特性,对应 MBE 中的第六个项目<br>先留个坑,以后用到了再填</p>
<h4 id="2-2-7-创造模式标签页"><a href="#2-2-7-创造模式标签页" class="headerlink" title="2.2.7 创造模式标签页"></a>2.2.7 创造模式标签页</h4><p>我们想要把我们的方块放到创造模式下的标签页中,同时能用搜索功能搜索到</p>
<h5 id="2-2-7-1-构造标签页"><a href="#2-2-7-1-构造标签页" class="headerlink" title="2.2.7.1 构造标签页"></a>2.2.7.1 构造标签页</h5><p>物品标签页通过实现一个抽象类的具体方法实现(createIcon,用于创建标签栏的图标)<br>可以直接通过匿名类实现,也可以写一个这个类的子类来实现<br>这个步骤在<code>StartUpCommon.java</code>中实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    customItemGroup = <span class="keyword">new</span> ItemGroup(<span class="string">&quot;mbe08_item_group&quot;</span>) &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> ItemStack <span class="title">createIcon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ItemStack(Items.GOLD_NUGGET);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-2-7-2-把物品添加到标签页"><a href="#2-2-7-2-把物品添加到标签页" class="headerlink" title="2.2.7.2 把物品添加到标签页"></a>2.2.7.2 把物品添加到标签页</h5><p>一共两种方法(两种方法选一即可):</p>
<p>在注册物品的时候,直接设置物品所在的标签页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    Item.Properties properties = <span class="keyword">new</span> Item.Properties()</span><br><span class="line">            .maxStackSize(MAXIMUM_STACK_SIZE_TESTBLOCK)</span><br><span class="line">            .group(customItemGroup);<span class="comment">// 在这里设置物品栏</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册物品</span></span><br><span class="line">    testItemBlock = <span class="keyword">new</span> BlockItem(testBlock, properties);</span><br><span class="line">    testItemBlock.setRegistryName(testBlock.getRegistryName());</span><br><span class="line">    itemRegisterEvent.getRegistry().register(testItemBlock);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有一种是,通过覆盖标签页抽象类的一个方法,一次性从所有物品中筛选出目标物品</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fill</span><span class="params">(NonNullList&lt;ItemStack&gt; itemsToShowOnTab)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 遍历所有物品,从中筛选目标</span></span><br><span class="line">    <span class="keyword">for</span> (Item item : ForgeRegistries.ITEMS) &#123;</span><br><span class="line">      <span class="keyword">if</span> (item != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.getRegistryName().getNamespace().equals(<span class="string">&quot;minecraftbyexample&quot;</span>)) &#123;</span><br><span class="line">          <span class="comment">// 为目标物品设置标签页为当前类对象</span></span><br><span class="line">          item.fillItemGroup(ItemGroup.SEARCH, itemsToShowOnTab);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-物品"><a href="#2-3-物品" class="headerlink" title="2.3 物品"></a>2.3 物品</h3><h4 id="2-3-1-简单物品"><a href="#2-3-1-简单物品" class="headerlink" title="2.3.1 简单物品"></a>2.3.1 简单物品</h4><p>首先创建一个物品类,继承自<code>Item</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemSimple</span> <span class="keyword">extends</span> <span class="title">Item</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_NUMBER = <span class="number">6</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ItemSimple</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="keyword">new</span> Item.Properties()</span><br><span class="line">                  .maxStackSize(MAXIMUM_NUMBER)</span><br><span class="line">                  .group(ItemGroup.MISC)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再<code>StartUpCommon.java</code>中注册物品(物品不需要渲染,故<code>StartUpClient.java</code>中什么都不用写)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &#123;</span><br><span class="line">    itemSimple = <span class="keyword">new</span> ItemSimple();</span><br><span class="line">    itemSimple.setRegistryName(<span class="string">&quot;mbe10_item_simple_registry_name&quot;</span>);</span><br><span class="line">    itemRegisterEvent.getRegistry().register(itemSimple);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-2-物品变体"><a href="#2-3-2-物品变体" class="headerlink" title="2.3.2 物品变体"></a>2.3.2 物品变体</h4><p>物品变体例子:一个瓶子,其中可以装各种果汁,不同果汁颜色和功能不同,同时瓶子中的液体有多个容量状态</p>
<h5 id="2-3-2-1-颜色类"><a href="#2-3-2-1-颜色类" class="headerlink" title="2.3.2.1 颜色类"></a>2.3.2.1 颜色类</h5><p>我们自己的颜色类需要实现<code>IItemColor</code>接口,其中只有一个需要实现的函数:<code>getColor</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LiquidColour</span> <span class="keyword">implements</span> <span class="title">IItemColor</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 其中的tintIndex指的是item模型文件中纹理的层数</span></span><br><span class="line">  <span class="comment">// &quot;textures&quot;: &#123;</span></span><br><span class="line">  <span class="comment">//    &quot;layer0&quot;: &quot;item/potion_overlay&quot;,</span></span><br><span class="line">  <span class="comment">//    &quot;layer1&quot;: &quot;item/potion_bottle_drinkable&quot;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// 其中layer0纹理的tintIndex即0,layer1的为1</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getColor</span><span class="params">(ItemStack stack, <span class="keyword">int</span> tintIndex)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 在获取指定层颜色的时候,从物品的NBT标签中获取数据</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">switch</span> (tintIndex) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>: <span class="keyword">return</span> Color.WHITE.getRGB();</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">          ItemVariants.EnumBottleFlavour enumBottleFlavour = ItemVariants.getFlavour(stack);</span><br><span class="line">          <span class="keyword">return</span> enumBottleFlavour.getRenderColour().getRGB();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">default</span>: &#123;</span><br><span class="line">          <span class="comment">// 永远不会到达这里</span></span><br><span class="line">          <span class="keyword">return</span> Color.BLACK.getRGB();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-2-物品模型"><a href="#2-3-2-2-物品模型" class="headerlink" title="2.3.2.2 物品模型"></a>2.3.2.2 物品模型</h5><p>对于果汁瓶子来说,每个满度都需要一个模型(其中仅仅是瓶中液体的贴图不同)<br>然后再用一个总的模型,通过不同条件选择不同满度的模型</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 零满度的物品模型</span></span><br><span class="line">  <span class="attr">&quot;parent&quot;</span>: <span class="string">&quot;builtin/generated&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;textures&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;layer0&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_layer0&quot;</span>,</span><br><span class="line">    <span class="comment">// 采用的贴图为0满度贴图</span></span><br><span class="line">    <span class="attr">&quot;layer1&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_layer1_0pc&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;display&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;thirdperson_righthand&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;rotation&quot;</span>: [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">      <span class="attr">&quot;translation&quot;</span>: [<span class="number">0.0</span>, <span class="number">2.5</span>, <span class="number">1.0</span>],</span><br><span class="line">      <span class="attr">&quot;scale&quot;</span>: [<span class="number">0.45</span>, <span class="number">0.45</span>, <span class="number">0.45</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 主模型文件</span></span><br><span class="line">  <span class="attr">&quot;parent&quot;</span>: <span class="string">&quot;builtin/generated&quot;</span>,</span><br><span class="line">  <span class="comment">// 默认纹理</span></span><br><span class="line">  <span class="attr">&quot;textures&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;layer0&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_layer0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;layer1&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_layer1_0pc&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 根据不同的标签使用不同模型覆盖默认模型</span></span><br><span class="line">  <span class="attr">&quot;overrides&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;fullness&quot;</span>: <span class="number">0</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_0pc&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;fullness&quot;</span>: <span class="number">1</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_25pc&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;fullness&quot;</span>: <span class="number">2</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_50pc&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;fullness&quot;</span>: <span class="number">3</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_75pc&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;fullness&quot;</span>: <span class="number">4</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe11_item_variants_100pc&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-3-物品类"><a href="#2-3-2-3-物品类" class="headerlink" title="2.3.2.3 物品类"></a>2.3.2.3 物品类</h5><p>对于果汁瓶子,其功能和渲染效果受两个影响:果汁品种和满度<br>果汁品种主要影响颜色(如果也影响其他功能的话,照着满度再搞一遍就行了),我们用<code>2.3.2.1</code>中的颜色类实现<br>然后是瓶子的满度,我们为物品类添加一个特性(property)</p>
<p>为了维护颜色和满度两个特性,物品类内部维护两个内部枚举作为工具</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemVariants</span> <span class="keyword">extends</span> <span class="title">Item</span></span>&#123;</span><br><span class="line">  <span class="comment">// 满度内部枚举</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">EnumBottleFullness</span> <span class="keyword">implements</span> <span class="title">IStringSerializable</span></span>&#123;</span><br><span class="line">    <span class="comment">// 枚举值,其中的值对应构造函数的参数:NBT_ID,名字,描述</span></span><br><span class="line">    EMPTY(<span class="number">0</span>, <span class="string">&quot;0pc&quot;</span>, <span class="string">&quot;empty&quot;</span>),</span><br><span class="line">    ONE_QUARTER(<span class="number">1</span>, <span class="string">&quot;25pc&quot;</span>, <span class="string">&quot;nearly empty&quot;</span>),</span><br><span class="line">    ONE_HALF(<span class="number">2</span>, <span class="string">&quot;50pc&quot;</span>, <span class="string">&quot;half full&quot;</span>),</span><br><span class="line">    THREE_QUARTERS(<span class="number">3</span>, <span class="string">&quot;75pc&quot;</span>, <span class="string">&quot;mostly full&quot;</span>),</span><br><span class="line">    FULL(<span class="number">4</span>, <span class="string">&quot;100pc&quot;</span>, <span class="string">&quot;full&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 特性值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">byte</span> nbtID;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构造函数</span></span><br><span class="line">    EnumBottleFullness(<span class="keyword">int</span> i_NBT_ID, String i_name, String i_description)&#123;</span><br><span class="line">      <span class="keyword">this</span>.nbtID = (<span class="keyword">byte</span>)i_NBT_ID;</span><br><span class="line">      <span class="keyword">this</span>.name = i_name;</span><br><span class="line">      <span class="keyword">this</span>.description = i_description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一些getter和setter就省略了</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 奇奇怪怪的名字...</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getPropertyOverrideValue</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> nbtID;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 减少满度的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EnumBottleFullness <span class="title">decreaseFullnessByOneStep</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (nbtID ==<span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">      <span class="comment">// 遍历各个枚举值,试图减少容量</span></span><br><span class="line">      <span class="keyword">for</span> (EnumBottleFullness fullness : EnumBottleFullness.values()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fullness.nbtID == nbtID - <span class="number">1</span>) <span class="keyword">return</span> fullness;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从NBT标签的数据得到对应的满度枚举对象</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Optional&lt;EnumBottleFullness&gt; <span class="title">getFullnessFromID</span><span class="params">(<span class="keyword">byte</span> ID)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (EnumBottleFullness fullness : EnumBottleFullness.values()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (fullness.nbtID == ID) <span class="keyword">return</span> Optional.of(fullness);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从NBT标签构获取满度枚举</span></span><br><span class="line">    <span class="comment">// 参数为混到一块儿的NBT标签,目标标签名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EnumBottleFullness <span class="title">fromNBT</span><span class="params">(CompoundNBT compoundNBT, String tagname)</span></span>&#123;</span><br><span class="line">      <span class="keyword">byte</span> fullnessID = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">// 试图从NBT中找到要找的数据</span></span><br><span class="line">      <span class="keyword">if</span> (compoundNBT != <span class="keyword">null</span> &amp;&amp; compoundNBT.contains(tagname)) &#123;</span><br><span class="line">        fullnessID = compoundNBT.getByte(tagname);</span><br><span class="line">      &#125;</span><br><span class="line">      Optional&lt;EnumBottleFullness&gt; fullness = getFullnessFromID(fullnessID);</span><br><span class="line">      <span class="comment">// 保护性写法,如果fullness为空则使用FULL枚举</span></span><br><span class="line">      <span class="keyword">return</span> fullness.orElse(FULL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把当前枚举对象写入指定NBT标签</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putIntoNBT</span><span class="params">(CompoundNBT compoundNBT, String tagname)</span></span>&#123;</span><br><span class="line">      compoundNBT.putByte(tagname, nbtID);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 果汁类型枚举,与满度枚举类似,不再展开</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">EnumBottleFlavour</span> <span class="keyword">implements</span> <span class="title">IStringSerializable</span></span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 尝龟的常数设置以及尝龟的NBT键值名</span></span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_NUMBER_OF_BOTTLES = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NBT_TAG_NAME_FLAVOUR = <span class="string">&quot;colour&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NBT_TAG_NAME_FULLNESS = <span class="string">&quot;fullness&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 尝龟的构造函数</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ItemVariants</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="keyword">new</span> Item.Properties().maxStackSize(MAXIMUM_NUMBER_OF_BOTTLES).group(ItemGroup.BREWING));</span><br><span class="line">    <span class="keyword">this</span>.addPropertyOverride(<span class="keyword">new</span> ResourceLocation(<span class="string">&quot;fullness&quot;</span>), ItemVariants::getFullnessPropertyOverride);</span><br><span class="line">            <span class="comment">// use lambda function to link the NBT fullness value to a suitable property override value</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从物品中得到饮料类别信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EnumBottleFlavour <span class="title">getFlavour</span><span class="params">(ItemStack stack)</span></span>&#123;</span><br><span class="line">    CompoundNBT compoundNBT = stack.getOrCreateTag();</span><br><span class="line">    <span class="keyword">return</span> EnumBottleFlavour.fromNBT(compoundNBT, NBT_TAG_NAME_FLAVOUR);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从物品中得到满度信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EnumBottleFullness <span class="title">getFullness</span><span class="params">(ItemStack stack)</span></span>&#123;</span><br><span class="line">    CompoundNBT compoundNBT = stack.getOrCreateTag();</span><br><span class="line">    <span class="keyword">return</span> EnumBottleFullness.fromNBT(compoundNBT, NBT_TAG_NAME_FULLNESS);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这个方法会被模型调用,获得满度信息,进而使用不同的具体模型,详见上一节</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">float</span> <span class="title">getFullnessPropertyOverride</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    ItemStack itemStack,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> World world,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="meta">@Nullable</span> LivingEntity livingEntity)</span></span>&#123;</span><br><span class="line">    EnumBottleFullness enumBottleFullness = getFullness(itemStack);</span><br><span class="line">    <span class="keyword">return</span> enumBottleFullness.getPropertyOverrideValue();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 两个尝龟setter,写入的时候直接写入物品的NBT中</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setFlavour</span><span class="params">(ItemStack stack, EnumBottleFlavour enumBottleFlavour)</span></span>&#123;</span><br><span class="line">    CompoundNBT compoundNBT = stack.getOrCreateTag();</span><br><span class="line">    enumBottleFlavour.putIntoNBT(compoundNBT, NBT_TAG_NAME_FLAVOUR);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setFullness</span><span class="params">(ItemStack stack, EnumBottleFullness enumBottleFullness)</span></span>&#123;</span><br><span class="line">    CompoundNBT compoundNBT = stack.getOrCreateTag();</span><br><span class="line">    enumBottleFullness.putIntoNBT(compoundNBT, NBT_TAG_NAME_FULLNESS);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把当前物品派生出的所有物品都加到标签页中(2.2.7.2的方法喜加一)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fillItemGroup</span><span class="params">(ItemGroup tab, NonNullList&lt;ItemStack&gt; subItems)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 这一步是找到当前物品本来所在的标签页</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isInGroup(tab)) &#123;</span><br><span class="line">      <span class="comment">// 然后在该标签页中添加派生物品</span></span><br><span class="line">      <span class="keyword">for</span> (EnumBottleFlavour flavour : EnumBottleFlavour.values()) &#123;</span><br><span class="line">        ItemStack subItemStack = <span class="keyword">new</span> ItemStack(<span class="keyword">this</span>, <span class="number">1</span>);</span><br><span class="line">        setFlavour(subItemStack, flavour);</span><br><span class="line">        setFullness(subItemStack, EnumBottleFullness.FULL);</span><br><span class="line">        subItems.add(subItemStack);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 物品使用时的触发动作</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> UseAction <span class="title">getUseAction</span><span class="params">(ItemStack stack)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> UseAction.DRINK;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 物品使用时动画时长</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUseDuration</span><span class="params">(ItemStack stack)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> TICKS_PER_SECOND = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> DRINK_DURATION_SECONDS = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> DRINK_DURATION_SECONDS * TICKS_PER_SECOND;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 物品是否成功使用(如果喝完了就不能喝了)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ActionResult&lt;ItemStack&gt; <span class="title">onItemRightClick</span><span class="params">(World worldIn, PlayerEntity playerIn, Hand hand)</span></span>&#123;</span><br><span class="line">    ItemStack itemStackHeld = playerIn.getHeldItem(hand);</span><br><span class="line">    EnumBottleFullness fullness = getFullness(itemStackHeld);</span><br><span class="line">    <span class="keyword">if</span> (fullness == EnumBottleFullness.EMPTY)</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ActionResult(ActionResultType.FAIL, itemStackHeld);</span><br><span class="line"></span><br><span class="line">    playerIn.setActiveHand(hand);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ActionResult(ActionResultType.PASS, itemStackHeld);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 物品成功使用后的效果</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ItemStack <span class="title">onItemUseFinish</span><span class="params">(ItemStack stack, World worldIn, LivingEntity entityLiving)</span></span>&#123;</span><br><span class="line">    EnumBottleFullness fullness = getFullness(stack);</span><br><span class="line">    fullness = fullness.decreaseFullnessByOneStep();</span><br><span class="line">    fullness.putIntoNBT(stack.getTag(), NBT_TAG_NAME_FULLNESS);</span><br><span class="line">    <span class="keyword">return</span> stack;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 由于物品有很多派生物品,用同一个名字会搞混</span></span><br><span class="line">  <span class="comment">// 重载这个方法为每个种类的派生物都指定一个名字</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getTranslationKey</span><span class="params">(ItemStack stack)</span></span>&#123;</span><br><span class="line">    EnumBottleFlavour flavour = getFlavour(stack);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.getTranslationKey(stack) + <span class="string">&quot;.&quot;</span> + flavour.getName();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据不同的满度修改显示名字(物品类名还是不变的)</span></span><br><span class="line">  <span class="comment">// 需要翻译文件进行配合(派生物名:派生物显示名):</span></span><br><span class="line">  <span class="comment">// &#123;</span></span><br><span class="line">  <span class="comment">//  // %s 的位置会被这个函数影响</span></span><br><span class="line">  <span class="comment">// &quot;item.modname.item_variants_registry_name.orange&quot;: &quot;MBE11 Item Variants orange (%s)&quot;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ITextComponent <span class="title">getDisplayName</span><span class="params">(ItemStack stack)</span></span>&#123;</span><br><span class="line">    String fullnessText= getFullness(stack).getDescription();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> TranslationTextComponent(<span class="keyword">this</span>.getTranslationKey(stack), fullnessText);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-2-4-注册"><a href="#2-3-2-4-注册" class="headerlink" title="2.3.2.4 注册"></a>2.3.2.4 注册</h5><p>物品的注册还是在<code>StartUpCommon.java</code>中进行,只需要注册物品即可,没有对应的方块<br>但是由于颜色是自定义的颜色类,需要对其进行注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartupClientOnly</span></span>&#123;</span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onColorHandlerEvent</span><span class="params">(ColorHandlerEvent.Item event)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 为我们的物品注册特定的颜色处理类</span></span><br><span class="line">    event.getItemColors().register(<span class="keyword">new</span> LiquidColour(), StartupCommon.itemVariants);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-3-3-NBT-动画"><a href="#2-3-3-NBT-动画" class="headerlink" title="2.3.3 NBT 动画"></a>2.3.3 NBT 动画</h4><p>具体效果就是使用一个物品时利用 NBT 触发一些特效</p>
<h5 id="2-3-3-1-模型文件"><a href="#2-3-3-1-模型文件" class="headerlink" title="2.3.3.1 模型文件"></a>2.3.3.1 模型文件</h5><p>首先是和 2.3.2 章类似的模型文件结构,根据一些值设定不同的物品模型</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;parent&quot;</span>: <span class="string">&quot;builtin/generated&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;textures&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;layer0&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe12_item_nbt_animate_0&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;overrides&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;chargefraction&quot;</span>: <span class="number">0.0</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe12_item_nbt_animate_0&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;chargefraction&quot;</span>: <span class="number">0.001</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe12_item_nbt_animate_1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;chargefraction&quot;</span>: <span class="number">0.2</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe12_item_nbt_animate_2&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;chargefraction&quot;</span>: <span class="number">0.4</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe12_item_nbt_animate_3&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;chargefraction&quot;</span>: <span class="number">0.6</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe12_item_nbt_animate_4&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;predicate&quot;</span>: &#123; <span class="attr">&quot;chargefraction&quot;</span>: <span class="number">0.8</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;model&quot;</span>: <span class="string">&quot;minecraftbyexample:item/mbe12_item_nbt_animate_5&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-3-2-ItemNBTanimationTimer-java"><a href="#2-3-3-2-ItemNBTanimationTimer-java" class="headerlink" title="2.3.3.2 ItemNBTanimationTimer.java"></a>2.3.3.2 ItemNBTanimationTimer.java</h5><p>需要一个类来控制触发效果的控制,首先要了解一下 MC 渲染物品时的行为</p>
<blockquote>
<p>MC 要对物品进行渲染,然后发现模型中需要根据一些变量采用不同的模型<br>MC 找到与物品这个属性对应的<code>IItemPropertyGetter</code>对象(需要实现一个 call 函数)<br>调用<code>IItemPropertyGetter</code>对象的 call 函数,得到变量的值<br>找到对应的模型并渲染</p>
</blockquote>
<p>我们要做的就是实现自定义的<code>IItemPropertyGetter</code>类,并注册给物品</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemNBTanimationTimer</span> <span class="keyword">implements</span> <span class="title">IItemPropertyGetter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 特效开始的tick数量,是否开始特效</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">long</span> startingTick = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> animationHasStarted = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// worldIn: 当被一个GUI渲染的时候为null(如物品栏,快捷栏,展示框)</span></span><br><span class="line">  <span class="comment">// entityIn: 当直接在世界中渲染的时候为null(如扔到地面上)</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">call</span><span class="params">(ItemStack stack, <span class="meta">@Nullable</span> World worldIn, <span class="meta">@Nullable</span> LivingEntity entityIn)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 默认帧下标,完全激活帧下标</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> IDLE_FRAME_INDEX = <span class="number">0.0F</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> FULLY_CHARGED_INDEX = <span class="number">1.0F</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (worldIn == <span class="keyword">null</span> &amp;&amp; entityIn != <span class="keyword">null</span>) &#123;</span><br><span class="line">        worldIn = entityIn.world;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (entityIn == <span class="keyword">null</span> || worldIn == <span class="keyword">null</span>) <span class="keyword">return</span> IDLE_FRAME_INDEX;</span><br><span class="line">    <span class="comment">// 玩家没有右键激活物品</span></span><br><span class="line">    <span class="keyword">if</span> (!entityIn.isHandActive()) &#123;</span><br><span class="line">        animationHasStarted = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">return</span> IDLE_FRAME_INDEX;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刚刚激活,开始计时</span></span><br><span class="line">    <span class="keyword">long</span> worldTicks = worldIn.getGameTime();</span><br><span class="line">    <span class="keyword">if</span> (!animationHasStarted) &#123;</span><br><span class="line">        startingTick = worldTicks;</span><br><span class="line">        animationHasStarted = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取激活时间,设置一个停顿间隔(防止误触?)</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> ticksInUse = worldTicks - startingTick;</span><br><span class="line">    <span class="keyword">if</span> (ticksInUse &lt;= ItemNBTAnimate.CHARGE_UP_INITIAL_PAUSE_TICKS) &#123;</span><br><span class="line">        <span class="keyword">return</span> IDLE_FRAME_INDEX;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 已经过了停顿时间,开始激活动画</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> chargeTicksSoFar = ticksInUse - ItemNBTAnimate.CHARGE_UP_INITIAL_PAUSE_TICKS;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">double</span> fractionCharged = chargeTicksSoFar / (<span class="keyword">double</span>) ItemNBTAnimate.CHARGE_UP_DURATION_TICKS;</span><br><span class="line">    <span class="keyword">if</span> (fractionCharged &lt; <span class="number">0.0</span>) <span class="keyword">return</span> IDLE_FRAME_INDEX;</span><br><span class="line">    <span class="keyword">if</span> (fractionCharged &gt; FULLY_CHARGED_INDEX) <span class="keyword">return</span> FULLY_CHARGED_INDEX;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">float</span>) fractionCharged * FULLY_CHARGED_INDEX;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2-3-4-物品视角设置-不常用"><a href="#2-3-4-物品视角设置-不常用" class="headerlink" title="2.3.4 物品视角设置(不常用)"></a>2.3.4 物品视角设置(不常用)</h4><p>主要是在<code>item_model.json</code>中设置<code>display</code>节点<br>MBE 作者推荐的两个工具:<br><a target="_blank" rel="noopener" href="https://blockbench.net/">软件工具 | BlockBench</a><br><a target="_blank" rel="noopener" href="https://github.com/TheGreyGhost/ItemTransformHelper">Mod 工具 | ItemTransformHelper</a></p>
<h4 id="2-3-5-动态物品模型-不常用"><a href="#2-3-5-动态物品模型-不常用" class="headerlink" title="2.3.5 动态物品模型(不常用)"></a>2.3.5 动态物品模型(不常用)</h4><p>对应 MBE 项目中的 MBE15 部分,以后用到了再看</p>
<h3 id="2-4-TileEntity"><a href="#2-4-TileEntity" class="headerlink" title="2.4 TileEntity"></a>2.4 TileEntity</h3><p>TileEntity 如其名,瓦片实体,不单独存在,需要与其他实体联合使用(二者坐标完全相同)<br>普通实体本身负责渲染,提供方块属性等<br>与普通方块连接的 TileEntity 负责进行各种功能,GUI 显示,存储数据等(如箱子,熔炉等)</p>
<p>TileEntity 和 NBT 结合紧密,MBE 作者推荐了一个查看 NBT 结构的工具(TileEntityData.java 的注释中):<a target="_blank" rel="noopener" href="https://github.com/jaquadro/NBTExplorer">NBTexplorer</a></p>
<h4 id="2-4-1-存储数据与触发动作"><a href="#2-4-1-存储数据与触发动作" class="headerlink" title="2.4.1 存储数据与触发动作"></a>2.4.1 存储数据与触发动作</h4><h5 id="2-4-1-1-方块主类"><a href="#2-4-1-1-方块主类" class="headerlink" title="2.4.1.1 方块主类"></a>2.4.1.1 方块主类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlockTileEntityData</span> <span class="keyword">extends</span> <span class="title">Block</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">BlockTileEntityData</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(Block.Properties.create(Material.ROCK));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> TIMER_COUNTDOWN_TICKS = <span class="number">20</span> * <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 指明方块有一个TileEntity</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasTileEntity</span><span class="params">(BlockState state)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方块被放置,或者客户端加载了这个新的方块</span></span><br><span class="line">  <span class="comment">// 返回一个与这个方块配合的TileEntity对象实例</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> TileEntity <span class="title">createTileEntity</span><span class="params">(BlockState state, IBlockReader world)</span> </span>&#123;<span class="keyword">return</span> <span class="keyword">new</span> TileEntityData();&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方块被放下时触发</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBlockPlacedBy</span><span class="params">(World worldIn, BlockPos pos, BlockState state, LivingEntity placer, ItemStack stack)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onBlockPlacedBy(worldIn, pos, state, placer, stack);</span><br><span class="line">    <span class="comment">// 从与这个方块同位置的地方获取TileEntity</span></span><br><span class="line">    TileEntity tileentity = worldIn.getTileEntity(pos);</span><br><span class="line">    <span class="comment">// 保护性写法,防止为null或者TileEntity类型不匹配</span></span><br><span class="line">    <span class="keyword">if</span> (tileentity <span class="keyword">instanceof</span> TileEntityData) &#123;</span><br><span class="line">      TileEntityData tileEntityData = (TileEntityData)tileentity;</span><br><span class="line">      tileEntityData.setTicksLeftTillDisappear(TIMER_COUNTDOWN_TICKS);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-1-2-TileEntity-类"><a href="#2-4-1-2-TileEntity-类" class="headerlink" title="2.4.1.2 TileEntity 类"></a>2.4.1.2 TileEntity 类</h5><p>实现方块的特殊功能,在这个例子里,方块在放下 10 秒后会随机变成其他东西</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TileEntityData</span> <span class="keyword">extends</span> <span class="title">TileEntity</span> <span class="keyword">implements</span> <span class="title">ITickableTileEntity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 仅仅是后面的例子里用的一些变量</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> [] testIntArray = &#123;<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>&#125;;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> [] testDoubleArray = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>&#125;;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Double [] testDoubleArrayWithNulls = &#123;<span class="number">61.1</span>, <span class="number">62.2</span>, <span class="keyword">null</span>, <span class="number">64.4</span>, <span class="number">65.5</span>&#125;;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ItemStack testItemStack = <span class="keyword">new</span> ItemStack(Items.COOKED_CHICKEN, <span class="number">23</span>);</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String testString = <span class="string">&quot;supermouse&quot;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> BlockPos testBlockPos = <span class="keyword">new</span> BlockPos(<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TileEntityData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(StartupCommon.tileEntityDataTypeMBE20);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 消失时间倒计时</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> INVALID_VALUE = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> ticksLeftTillDisappear = INVALID_VALUE;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTicksLeftTillDisappear</span><span class="params">(<span class="keyword">int</span> ticks)</span></span>&#123;</span><br><span class="line">    ticksLeftTillDisappear = ticks;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把要保存的数据写入NBT中</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> CompoundNBT <span class="title">write</span><span class="params">(CompoundNBT parentNBTTagCompound)</span></span>&#123;</span><br><span class="line">     <span class="comment">// The super call is required to save the tile&#x27;s location</span></span><br><span class="line">     <span class="comment">// 父类调用会写入这个TileEntity的位置信息,所以必须写上</span></span><br><span class="line">    <span class="keyword">super</span>.write(parentNBTTagCompound);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入基本类型的数据</span></span><br><span class="line">    parentNBTTagCompound.putInt(<span class="string">&quot;ticksLeft&quot;</span>, ticksLeftTillDisappear);</span><br><span class="line">    parentNBTTagCompound.putString(<span class="string">&quot;testString&quot;</span>, testString);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入子节点</span></span><br><span class="line">    CompoundNBT blockPosNBT = <span class="keyword">new</span> CompoundNBT();</span><br><span class="line">    blockPosNBT.putInt(<span class="string">&quot;x&quot;</span>, testBlockPos.getX());</span><br><span class="line">    blockPosNBT.putInt(<span class="string">&quot;y&quot;</span>, testBlockPos.getY());</span><br><span class="line">    blockPosNBT.putInt(<span class="string">&quot;z&quot;</span>, testBlockPos.getZ());</span><br><span class="line">    parentNBTTagCompound.put(<span class="string">&quot;testBlockPos&quot;</span>, blockPosNBT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入物品</span></span><br><span class="line">    CompoundNBT itemStackNBT = <span class="keyword">new</span> CompoundNBT();</span><br><span class="line">    testItemStack.write(itemStackNBT);</span><br><span class="line">    parentNBTTagCompound.put(<span class="string">&quot;testItemStack&quot;</span>, itemStackNBT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入数组</span></span><br><span class="line">    parentNBTTagCompound.putIntArray(<span class="string">&quot;testIntArray&quot;</span>, testIntArray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写入列表</span></span><br><span class="line">    ListNBT doubleArrayNBT = <span class="keyword">new</span> ListNBT();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">double</span> value : testDoubleArray) &#123;</span><br><span class="line">      doubleArrayNBT.add(DoubleNBT.valueOf(value));</span><br><span class="line">    &#125;</span><br><span class="line">    parentNBTTagCompound.put(<span class="string">&quot;testDoubleArray&quot;</span>, doubleArrayNBT);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 键值对列表</span></span><br><span class="line">    ListNBT doubleArrayWithNullsNBT = <span class="keyword">new</span> ListNBT();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; testDoubleArrayWithNulls.length; ++i) &#123;</span><br><span class="line">      Double value = testDoubleArrayWithNulls[i];</span><br><span class="line">      <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</span><br><span class="line">        CompoundNBT dataForThisSlot = <span class="keyword">new</span> CompoundNBT();</span><br><span class="line">        <span class="comment">// 读取的默认值时是0,所以写入的时候尽量避开0</span></span><br><span class="line">        dataForThisSlot.putInt(<span class="string">&quot;i&quot;</span>, i + <span class="number">1</span>);</span><br><span class="line">        dataForThisSlot.putDouble(<span class="string">&quot;v&quot;</span>, value);</span><br><span class="line">        doubleArrayWithNullsNBT.add(dataForThisSlot);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    parentNBTTagCompound.put(<span class="string">&quot;testDoubleArrayWithNulls&quot;</span>, doubleArrayWithNullsNBT);</span><br><span class="line">    <span class="keyword">return</span> parentNBTTagCompound;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 恢复数据会自动调用</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(CompoundNBT parentNBTTagCompound)</span></span>&#123;</span><br><span class="line">    <span class="comment">// The super call is required to load the tiles location</span></span><br><span class="line">    <span class="comment">// 父类调用会读取TileEntity的位置信息</span></span><br><span class="line">    <span class="keyword">super</span>.read(parentNBTTagCompound);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// important rule: never trust the data you read from NBT, make sure it can&#x27;t cause a crash</span></span><br><span class="line">    <span class="comment">// 永远不要轻信从NBT中读取到的信息,要验证一下!!!</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// int类型</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> NBT_INT_ID = NBTtypesMBE.INT_NBT_ID;</span><br><span class="line">    <span class="keyword">int</span> readTicks = INVALID_VALUE;</span><br><span class="line">    <span class="comment">// 如果没有这个标签,则会读取到默认值0</span></span><br><span class="line">    <span class="keyword">if</span> (parentNBTTagCompound.contains(<span class="string">&quot;ticksLeft&quot;</span>, NBT_INT_ID)) &#123;</span><br><span class="line">      readTicks = parentNBTTagCompound.getInt(<span class="string">&quot;ticksLeft&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (readTicks &lt; <span class="number">0</span>) readTicks = INVALID_VALUE;</span><br><span class="line">    &#125;</span><br><span class="line">    ticksLeftTillDisappear = readTicks;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// string类型</span></span><br><span class="line">    String readTestString = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> NBT_STRING_ID = NBTtypesMBE.STRING_NBT_ID;</span><br><span class="line">    <span class="keyword">if</span> (parentNBTTagCompound.contains(<span class="string">&quot;testString&quot;</span>, NBT_STRING_ID)) &#123;</span><br><span class="line">      readTestString = parentNBTTagCompound.getString(<span class="string">&quot;testString&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!testString.equals(readTestString)) &#123;</span><br><span class="line">      System.err.println(<span class="string">&quot;testString mismatch:&quot;</span> + readTestString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从子节点中读取坐标信息</span></span><br><span class="line">    CompoundNBT blockPosNBT = parentNBTTagCompound.getCompound(<span class="string">&quot;testBlockPos&quot;</span>);</span><br><span class="line">    BlockPos readBlockPos = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (blockPosNBT.contains(<span class="string">&quot;x&quot;</span>, NBT_INT_ID) &amp;&amp; blockPosNBT.contains(<span class="string">&quot;y&quot;</span>, NBT_INT_ID) &amp;&amp; blockPosNBT.contains(<span class="string">&quot;z&quot;</span>, NBT_INT_ID) ) &#123;</span><br><span class="line">      readBlockPos = <span class="keyword">new</span> BlockPos(blockPosNBT.getInt(<span class="string">&quot;x&quot;</span>), blockPosNBT.getInt(<span class="string">&quot;y&quot;</span>), blockPosNBT.getInt(<span class="string">&quot;z&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (readBlockPos == <span class="keyword">null</span> || !testBlockPos.equals(readBlockPos)) &#123;</span><br><span class="line">      System.err.println(<span class="string">&quot;testBlockPos mismatch:&quot;</span> + readBlockPos);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取物品信息</span></span><br><span class="line">    CompoundNBT itemStackNBT = parentNBTTagCompound.getCompound(<span class="string">&quot;testItemStack&quot;</span>);</span><br><span class="line">    ItemStack readItemStack = ItemStack.read(itemStackNBT);</span><br><span class="line">    <span class="keyword">if</span> (!ItemStack.areItemStacksEqual(testItemStack, readItemStack)) &#123;</span><br><span class="line">      System.err.println(<span class="string">&quot;testItemStack mismatch:&quot;</span> + readItemStack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取数组</span></span><br><span class="line">    <span class="keyword">int</span> [] readIntArray = parentNBTTagCompound.getIntArray(<span class="string">&quot;testIntArray&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!Arrays.equals(testIntArray, readIntArray)) &#123;</span><br><span class="line">      System.err.println(<span class="string">&quot;testIntArray mismatch:&quot;</span> + readIntArray);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 列表</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> NBT_DOUBLE_ID = NBTtypesMBE.DOUBLE_NBT_ID;</span><br><span class="line">    ListNBT doubleArrayNBT = parentNBTTagCompound.getList(<span class="string">&quot;testDoubleArray&quot;</span>, NBT_DOUBLE_ID);</span><br><span class="line">    <span class="keyword">int</span> numberOfEntries = Math.min(doubleArrayNBT.size(), testDoubleArray.length);</span><br><span class="line">    <span class="keyword">double</span> [] readDoubleArray = <span class="keyword">new</span> <span class="keyword">double</span>[numberOfEntries];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfEntries; ++i) &#123;</span><br><span class="line">       readDoubleArray[i] = doubleArrayNBT.getDouble(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (doubleArrayNBT.size() != numberOfEntries || !Arrays.equals(readDoubleArray, testDoubleArray)) &#123;</span><br><span class="line">      System.err.println(<span class="string">&quot;testDoubleArray mismatch:&quot;</span> + readDoubleArray);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 键值对列表</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> NBT_COMPOUND_ID = NBTtypesMBE.COMPOUND_NBT_ID;</span><br><span class="line">    ListNBT doubleNullArrayNBT = parentNBTTagCompound.getList(<span class="string">&quot;testDoubleArrayWithNulls&quot;</span>, NBT_COMPOUND_ID);</span><br><span class="line">    numberOfEntries = Math.min(doubleArrayNBT.size(), testDoubleArrayWithNulls.length);</span><br><span class="line">    Double [] readDoubleNullArray = <span class="keyword">new</span> Double[numberOfEntries];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; doubleNullArrayNBT.size(); ++i)  &#123;</span><br><span class="line">      CompoundNBT nbtEntry = doubleNullArrayNBT.getCompound(i);</span><br><span class="line">      <span class="keyword">int</span> idx = nbtEntry.getInt(<span class="string">&quot;i&quot;</span>) - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> (nbtEntry.contains(<span class="string">&quot;v&quot;</span>, NBT_DOUBLE_ID) &amp;&amp; idx &gt;= <span class="number">0</span> &amp;&amp; idx &lt; numberOfEntries) &#123;</span><br><span class="line">        readDoubleNullArray[idx] = nbtEntry.getDouble(<span class="string">&quot;v&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!Arrays.equals(testDoubleArrayWithNulls, readDoubleNullArray)) &#123;</span><br><span class="line">      System.err.println(<span class="string">&quot;testDoubleArrayWithNulls mismatch:&quot;</span> + readDoubleNullArray);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 被加载后,服务器需要把TileEntity的数据发送给客户端</span></span><br><span class="line">  <span class="comment">// 方法一共有两对:</span></span><br><span class="line">  <span class="comment">//    更新单个TileEntity: getUpdatePacket()--onDataPacket()</span></span><br><span class="line">  <span class="comment">//    更新一整个chunk中的所有tTileEntity:getUpdateTag()--handleUpdateTag()</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@Nullable</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SUpdateTileEntityPacket <span class="title">getUpdatePacket</span><span class="params">()</span></span>&#123;</span><br><span class="line">    CompoundNBT nbtTagCompound = <span class="keyword">new</span> CompoundNBT();</span><br><span class="line">    write(nbtTagCompound);</span><br><span class="line">    <span class="comment">// arbitrary number; only used for vanilla TileEntities.  You can use it, or not, as you want.</span></span><br><span class="line">    <span class="comment">// 任意数字,仅用于原生TileEntity,可以用也可以不用,随你开心</span></span><br><span class="line">    <span class="keyword">int</span> tileEntityType = <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SUpdateTileEntityPacket(<span class="keyword">this</span>.pos, tileEntityType, nbtTagCompound);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDataPacket</span><span class="params">(NetworkManager net, SUpdateTileEntityPacket pkt)</span> </span>&#123;</span><br><span class="line">    read(pkt.getNbtCompound());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> CompoundNBT <span class="title">getUpdateTag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    CompoundNBT nbtTagCompound = <span class="keyword">new</span> CompoundNBT();</span><br><span class="line">    write(nbtTagCompound);</span><br><span class="line">    <span class="keyword">return</span> nbtTagCompound;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleUpdateTag</span><span class="params">(CompoundNBT tag)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.read(tag);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 每个tick被调用一次</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tick</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 一些防止崩溃的保护性写法</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.hasWorld()) <span class="keyword">return</span>;</span><br><span class="line">    World world = <span class="keyword">this</span>.getWorld();</span><br><span class="line">    <span class="comment">// 逻辑的运行是在逻辑服务端进行的,客户端什么都不用做</span></span><br><span class="line">    <span class="keyword">if</span> (world.isRemote) <span class="keyword">return</span>;</span><br><span class="line">    ServerWorld serverWorld = (ServerWorld)world;</span><br><span class="line">    <span class="comment">// 时间不正常直接退出</span></span><br><span class="line">    <span class="keyword">if</span> (ticksLeftTillDisappear == INVALID_VALUE) <span class="keyword">return</span>;</span><br><span class="line">    --ticksLeftTillDisappear;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在服务端的一些更改需要重新发送给客户端</span></span><br><span class="line">    <span class="comment">// 但是在这个例子中不用,因为这个计时本身没有任何作用,只需要把最后方块的结果发送过去即可</span></span><br><span class="line">    <span class="comment">// this.markDirty();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ticksLeftTillDisappear &gt; <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 完成方块转换</span></span><br><span class="line">    Block [] blockChoices = &#123;Blocks.DIAMOND_BLOCK, Blocks.OBSIDIAN, Blocks.AIR, Blocks.TNT, Blocks.CORNFLOWER, Blocks.OAK_SAPLING, Blocks.WATER&#125;;</span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    Block chosenBlock = blockChoices[random.nextInt(blockChoices.length)];</span><br><span class="line">    world.setBlockState(<span class="keyword">this</span>.pos, chosenBlock.getDefaultState());</span><br><span class="line">    <span class="keyword">if</span> (chosenBlock == Blocks.TNT) &#123;</span><br><span class="line">      Blocks.TNT.catchFire(Blocks.TNT.getDefaultState().with(TNTBlock.UNSTABLE, <span class="keyword">true</span>), world, pos, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">      world.removeBlock(pos, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (chosenBlock == Blocks.OAK_SAPLING) &#123;</span><br><span class="line">      SaplingBlock blockSapling = (SaplingBlock)Blocks.OAK_SAPLING;</span><br><span class="line">      <span class="comment">// blockSapling.generateTree(world, this.pos, blockSapling.getDefaultState(),random);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-4-1-3-注册"><a href="#2-4-1-3-注册" class="headerlink" title="2.4.1.3 注册"></a>2.4.1.3 注册</h5><p>注册带有 TileEntity 的方块时,需要额外加上一个对 TileEntity 的注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 被注册的方块实例</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> BlockTileEntityData blockTileEntityData;</span><br><span class="line">  <span class="comment">// 被注册的TileEntity的实例</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> TileEntityType&lt;TileEntityData&gt; tileEntityDataTypeMBE20;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onTileEntityTypeRegistration</span><span class="params">(<span class="keyword">final</span> RegistryEvent.Register&lt;TileEntityType&lt;?&gt;&gt; event)</span> </span>&#123;</span><br><span class="line">    tileEntityDataTypeMBE20 =</span><br><span class="line">            TileEntityType.Builder.create(TileEntityData::<span class="keyword">new</span>, blockTileEntityData).build(<span class="keyword">null</span>);</span><br><span class="line">    tileEntityDataTypeMBE20.setRegistryName(<span class="string">&quot;minecraftbyexample:mbe20_tile_entity_type_registry_name&quot;</span>);</span><br><span class="line">    event.getRegistry().register(tileEntityDataTypeMBE20);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-4-2-渲染-TODO"><a href="#2-4-2-渲染-TODO" class="headerlink" title="2.4.2 渲染(TODO)"></a>2.4.2 渲染(TODO)</h4><p>啊…太多内容了…<br>以后用到了再看<br>对应于 MBE 项目的 mbe_21</p>
<h3 id="2-5-存储方块-inventory-TODO"><a href="#2-5-存储方块-inventory-TODO" class="headerlink" title="2.5 存储方块(inventory)(TODO)"></a>2.5 存储方块(inventory)(TODO)</h3><h4 id="2-5-4-合成表"><a href="#2-5-4-合成表" class="headerlink" title="2.5.4 合成表"></a>2.5.4 合成表</h4><p>合成表配方比较简单,只需要在<code>data.examplemod.recipes.block_name.json</code>添加 json 格式的配方文件即可</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 配方类型:有序合成,无需合成,熔炉配方,高炉配方,营火配方,锻造台配方...</span></span><br><span class="line">  <span class="comment">// 详细可以参照:https://minecraft-zh.gamepedia.com/配方</span></span><br><span class="line">  <span class="comment">// 当然这里所有的节点都可以在上面找到</span></span><br><span class="line">  <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;minecraft:crafting_shaped&quot;</span>,</span><br><span class="line">  <span class="comment">// 配方栏及其解释</span></span><br><span class="line">  <span class="attr">&quot;pattern&quot;</span>: [<span class="string">&quot;xxa&quot;</span>, <span class="string">&quot;x x&quot;</span>, <span class="string">&quot;xxx&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;key&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;x&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;forge:gems/diamond&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;a&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;item&quot;</span>: <span class="string">&quot;mymod:myfirstitem&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 产出结果</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;item&quot;</span>: <span class="string">&quot;mymod:myitem&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;count&quot;</span>: <span class="number">9</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-6-命令-TODO"><a href="#2-6-命令-TODO" class="headerlink" title="2.6 命令(TODO)"></a>2.6 命令(TODO)</h3><h4 id="2-6-1-注册命令"><a href="#2-6-1-注册命令" class="headerlink" title="2.6.1 注册命令"></a>2.6.1 注册命令</h4><p>首先在<code>StartupCommon.java</code>中对<code>ServerLifecycleEvents</code>进行注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onCommonSetupEvent</span><span class="params">(FMLCommonSetupEvent event)</span> </span>&#123;</span><br><span class="line">    MinecraftForge.EVENT_BUS.register(ServerLifecycleEvents.class);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 ServerLifecycleEvents 中对命令进行注册</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerLifecycleEvents</span></span>&#123;</span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onServerStartingEvent</span><span class="params">(FMLServerStartingEvent event)</span> </span>&#123;</span><br><span class="line">    CommandDispatcher&lt;CommandSource&gt; commandDispatcher = event.getCommandDispatcher();</span><br><span class="line">    MBEsayCommand.register(commandDispatcher);</span><br><span class="line">    MBEquoteCommand.register(commandDispatcher);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-6-2-构造命令"><a href="#2-6-2-构造命令" class="headerlink" title="2.6.2 构造命令"></a>2.6.2 构造命令</h4><p>然后是在在 ServerLifecycleEvents 中注册的命令类中构造命令<br>其中操作的基本结构基本一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MBEsayCommand</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(CommandDispatcher&lt;CommandSource&gt; dispatcher)</span> </span>&#123;</span><br><span class="line">    LiteralArgumentBuilder&lt;CommandSource&gt; mbesayCommand</span><br><span class="line">            = Commands.literal(<span class="string">&quot;mbesay&quot;</span>)</span><br><span class="line">                 .<span class="keyword">requires</span>((commandSource) -&gt; commandSource.hasPermissionLevel(<span class="number">2</span>))</span><br><span class="line">                 .then(Commands.argument(<span class="string">&quot;message&quot;</span>, MessageArgument.message())</span><br><span class="line">                         .executes(MBEsayCommand::sendPigLatinMessage)</span><br><span class="line">                      );</span><br><span class="line"></span><br><span class="line">    dispatcher.register(mbesayCommand);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中的基规则;</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">literal</td>
<td style="text-align:left">匹配一个命令 token</td>
</tr>
<tr>
<td style="text-align:left">argument</td>
<td style="text-align:left">匹配一个参数 token</td>
</tr>
<tr>
<td style="text-align:left">then</td>
<td style="text-align:left">匹配下一个 token</td>
</tr>
<tr>
<td style="text-align:left">requires</td>
<td style="text-align:left">匹配一些权限要求</td>
</tr>
<tr>
<td style="text-align:left">executes</td>
<td style="text-align:left">执行一个命令</td>
</tr>
<tr>
<td style="text-align:left">redirect</td>
<td style="text-align:left">重定向命令</td>
</tr>
<tr>
<td style="text-align:left">suggests</td>
<td style="text-align:left">提供自动补全</td>
</tr>
<tr>
<td style="text-align:left">fork</td>
<td style="text-align:left">执行其他命令</td>
</tr>
</tbody>
</table>
</div>
<h3 id="2-7-粒子效果-TODO"><a href="#2-7-粒子效果-TODO" class="headerlink" title="2.7 粒子效果(TODO)"></a>2.7 粒子效果(TODO)</h3><h3 id="2-8-网络通信"><a href="#2-8-网络通信" class="headerlink" title="2.8 网络通信"></a>2.8 网络通信</h3><p>这一部分会构造一个法杖物品,使用后引发一场空袭(随机召唤一些实体)</p>
<ol>
<li>客户端使用法杖,构造一个包含位置和召唤物种类的信息,发送给服务器</li>
<li>服务器处理信息,发送一个包含位置的特效信息给所有同一维度的玩家</li>
<li>服务器在指定位置生成召唤物(自动同步给玩家)</li>
<li>服务器在指定位置生成雷声(自动同步给玩家)</li>
</ol>
<h4 id="2-8-1-MessageHandlerOnClient-java"><a href="#2-8-1-MessageHandlerOnClient-java" class="headerlink" title="2.8.1 MessageHandlerOnClient.java"></a>2.8.1 MessageHandlerOnClient.java</h4><p>用于客户端处理接收到的数据<br>需要注意的是,这个类是运行在一个单独的线程中,故不能随意调用 Forge 和 MC 的对象<br>在需要调用一些其他函数的时候,通过在任务列表中添加任务代替直接调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageHandlerOnClient</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onMessageReceived</span><span class="params">(<span class="keyword">final</span> TargetEffectMessageToClient message, Supplier&lt;NetworkEvent.Context&gt; ctxSupplier)</span> </span>&#123;</span><br><span class="line">    NetworkEvent.Context ctx = ctxSupplier.get();</span><br><span class="line">    LogicalSide sideReceived = ctx.getDirection().getReceptionSide();</span><br><span class="line">    ctx.setPacketHandled(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一些安全性检查</span></span><br><span class="line">    <span class="keyword">if</span> (sideReceived != LogicalSide.CLIENT) &#123;</span><br><span class="line">      LOGGER.warn(<span class="string">&quot;TargetEffectMessageToClient received on wrong side:&quot;</span> + ctx.getDirection().getReceptionSide());</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!message.isMessageValid()) &#123;</span><br><span class="line">      LOGGER.warn(<span class="string">&quot;TargetEffectMessageToClient was invalid&quot;</span> + message.toString());</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 我们知道我们的这个代码是运行在客户端的,所以直接获取客户端世界</span></span><br><span class="line">    <span class="comment">// 并进行安全性检查</span></span><br><span class="line">    Optional&lt;ClientWorld&gt; clientWorld = LogicalSidedProvider.CLIENTWORLD.get(sideReceived);</span><br><span class="line">    <span class="keyword">if</span> (!clientWorld.isPresent()) &#123;</span><br><span class="line">      LOGGER.warn(<span class="string">&quot;TargetEffectMessageToClient context could not provide a ClientWorld.&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个任务,这个任务将在下一个tick执行</span></span><br><span class="line">    ctx.enqueueWork(() -&gt; processMessage(clientWorld.get(), message));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这个函数通过任务的形式执行,在目标位置附近生成特效粒子</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">processMessage</span><span class="params">(ClientWorld worldClient, TargetEffectMessageToClient message)</span></span>&#123;</span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> NUMBER_OF_PARTICLES = <span class="number">100</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">double</span> HORIZONTAL_SPREAD = <span class="number">1.5</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; NUMBER_OF_PARTICLES; ++i) &#123;</span><br><span class="line">      Vec3d targetCoordinates = message.getTargetCoordinates();</span><br><span class="line">      <span class="keyword">double</span> spawnXpos = targetCoordinates.x + (<span class="number">2</span>*random.nextDouble() - <span class="number">1</span>) * HORIZONTAL_SPREAD;</span><br><span class="line">      <span class="keyword">double</span> spawnYpos = targetCoordinates.y;</span><br><span class="line">      <span class="keyword">double</span> spawnZpos = targetCoordinates.z + (<span class="number">2</span>*random.nextDouble() - <span class="number">1</span>) * HORIZONTAL_SPREAD;</span><br><span class="line">      worldClient.addParticle(ParticleTypes.INSTANT_EFFECT, spawnXpos, spawnYpos, spawnZpos, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 协议版本号检查</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isThisProtocolAcceptedByClient</span><span class="params">(String protocolVersion)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> StartupCommon.MESSAGE_PROTOCOL_VERSION.equals(protocolVersion);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LogManager.getLogger();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-8-2-MessageHandlerOnServer-java"><a href="#2-8-2-MessageHandlerOnServer-java" class="headerlink" title="2.8.2 MessageHandlerOnServer.java"></a>2.8.2 MessageHandlerOnServer.java</h4><p>用于服务器处理接收到的数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageHandlerOnServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在服务器处理接收到的数据</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onMessageReceived</span><span class="params">(<span class="keyword">final</span> AirstrikeMessageToServer message, Supplier&lt;NetworkEvent.Context&gt; ctxSupplier)</span> </span>&#123;</span><br><span class="line">    NetworkEvent.Context ctx = ctxSupplier.get();</span><br><span class="line">    LogicalSide sideReceived = ctx.getDirection().getReceptionSide();</span><br><span class="line">    ctx.setPacketHandled(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sideReceived != LogicalSide.SERVER) &#123;</span><br><span class="line">      LOGGER.warn(<span class="string">&quot;AirstrikeMessageToServer received on wrong side:&quot;</span> + ctx.getDirection().getReceptionSide());</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!message.isMessageValid()) &#123;</span><br><span class="line">      LOGGER.warn(<span class="string">&quot;AirstrikeMessageToServer was invalid&quot;</span> + message.toString());</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这段代码只会在服务器运行</span></span><br><span class="line">    <span class="keyword">final</span> ServerPlayerEntity sendingPlayer = ctx.getSender();</span><br><span class="line">    <span class="keyword">if</span> (sendingPlayer == <span class="keyword">null</span>) &#123;</span><br><span class="line">      LOGGER.warn(<span class="string">&quot;EntityPlayerMP was null when AirstrikeMessageToServer was received&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创造一个任务,下一个tick执行任务</span></span><br><span class="line">    ctx.enqueueWork(() -&gt; processMessage(message, sendingPlayer));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在目标位置附近生成一些投掷物</span></span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">processMessage</span><span class="params">(AirstrikeMessageToServer message, ServerPlayerEntity sendingPlayer)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 给每个玩家都发送一个信息,然后生成一个任务,在下一个tick执行</span></span><br><span class="line">    <span class="comment">// 这一步只是为了让玩家生成一些特效而已,后面的实体生成和雷声都会自动传给玩家</span></span><br><span class="line">    <span class="comment">// 一些相似的任务:</span></span><br><span class="line">    <span class="comment">//    给一个玩家发送信息:</span></span><br><span class="line">    <span class="comment">//        simpleChannel.send(PacketDistributor.PLAYER.with(playerMP), new MyMessage());</span></span><br><span class="line">    <span class="comment">//    给一个区域的玩家发送信息:</span></span><br><span class="line">    <span class="comment">//        simpleChannel.send(PacketDistributor.TRACKING_CHUNK.with(chunk), new MyMessage());</span></span><br><span class="line">    <span class="comment">//    给所有玩家发送信息:</span></span><br><span class="line">    <span class="comment">//        simpleChannel.send(PacketDistributor.ALL.noArg(), new MyMessage());</span></span><br><span class="line">    <span class="comment">//    给一个维度中的所有玩家发送信息:</span></span><br><span class="line">    <span class="comment">//        simpleChannel.send(PacketDistributor.DIMENSION.with(() -&gt; playerDimension), msg);</span></span><br><span class="line">    TargetEffectMessageToClient msg = <span class="keyword">new</span> TargetEffectMessageToClient(message.getTargetCoordinates());</span><br><span class="line">    DimensionType playerDimension = sendingPlayer.dimension;</span><br><span class="line">    StartupCommon.simpleChannel.send(PacketDistributor.DIMENSION.with(() -&gt; playerDimension), msg);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 在服务器上生成这些投掷物</span></span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> MAX_NUMBER_OF_PROJECTILES = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> MIN_NUMBER_OF_PROJECTILES = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> numberOfProjectiles = MIN_NUMBER_OF_PROJECTILES + random.nextInt(MAX_NUMBER_OF_PROJECTILES - MIN_NUMBER_OF_PROJECTILES + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfProjectiles; ++i) &#123;</span><br><span class="line">      World world = sendingPlayer.world;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">double</span> MAX_HORIZONTAL_SPREAD = <span class="number">4.0</span>;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">double</span> MAX_VERTICAL_SPREAD = <span class="number">20.0</span>;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">double</span> RELEASE_HEIGHT_ABOVE_TARGET = <span class="number">40</span>;</span><br><span class="line">      <span class="keyword">double</span> xOffset = (random.nextDouble() * <span class="number">2</span> - <span class="number">1</span>) * MAX_HORIZONTAL_SPREAD;</span><br><span class="line">      <span class="keyword">double</span> zOffset = (random.nextDouble() * <span class="number">2</span> - <span class="number">1</span>) * MAX_HORIZONTAL_SPREAD;</span><br><span class="line">      <span class="keyword">double</span> yOffset = RELEASE_HEIGHT_ABOVE_TARGET + (random.nextDouble() * <span class="number">2</span> - <span class="number">1</span>) * MAX_VERTICAL_SPREAD;</span><br><span class="line">      Vec3d releasePoint = message.getTargetCoordinates().add(xOffset, yOffset, zOffset);</span><br><span class="line"></span><br><span class="line">      EntityType entityType = message.getProjectile().getEntityType();</span><br><span class="line"></span><br><span class="line">      CompoundNBT spawnNBT = <span class="keyword">null</span>;</span><br><span class="line">      ITextComponent customName = <span class="keyword">null</span>;</span><br><span class="line">      PlayerEntity spawningPlayer = <span class="keyword">null</span>;</span><br><span class="line">      BlockPos spawnLocation = <span class="keyword">new</span> BlockPos(releasePoint);</span><br><span class="line">      <span class="keyword">boolean</span> SPAWN_ON_TOP_OF_GIVEN_BLOCK_LOCATION = <span class="keyword">false</span>;  <span class="comment">// not 100% sure of what this does...(奇奇怪怪...)</span></span><br><span class="line">      <span class="keyword">boolean</span> SEARCH_DOWN_WHEN_PLACED_ON_TOP_OF_GIVEN_BLOCK_LOCATION = <span class="keyword">false</span>; <span class="comment">// not 100% sure of what this does...</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 根据以上属性生成实例对象</span></span><br><span class="line">      Entity spawnedEntity = entityType.spawn(world, spawnNBT, customName, spawningPlayer, spawnLocation,</span><br><span class="line">              SpawnReason.SPAWN_EGG,</span><br><span class="line">              SPAWN_ON_TOP_OF_GIVEN_BLOCK_LOCATION, SEARCH_DOWN_WHEN_PLACED_ON_TOP_OF_GIVEN_BLOCK_LOCATION);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// special cases handled by switch() - clumsy method for purposes of simplicity only...</span></span><br><span class="line">      <span class="keyword">switch</span> (message.getProjectile()) &#123;</span><br><span class="line">        <span class="keyword">case</span> FIREBALL: &#123;</span><br><span class="line">          FireballEntity fireballEntity = (FireballEntity)spawnedEntity;</span><br><span class="line">          <span class="keyword">final</span> <span class="keyword">double</span> Y_ACCELERATION = -<span class="number">0.5</span>;</span><br><span class="line">          fireballEntity.accelerationX = <span class="number">0.0</span>;</span><br><span class="line">          fireballEntity.accelerationY = Y_ACCELERATION;</span><br><span class="line">          fireballEntity.accelerationZ = <span class="number">0.0</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">default</span>: &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. 搞个雷声</span></span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">float</span> VOLUME = <span class="number">10000.0F</span>;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">float</span> PITCH = <span class="number">0.8F</span> + random.nextFloat() * <span class="number">0.2F</span>;</span><br><span class="line">      PlayerEntity playerCausingSound = <span class="keyword">null</span>;</span><br><span class="line">      world.playSound(playerCausingSound, releasePoint.x, releasePoint.y, releasePoint.z,</span><br><span class="line">                      SoundEvents.ENTITY_LIGHTNING_BOLT_THUNDER, SoundCategory.WEATHER, VOLUME, PITCH);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查协议版本</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isThisProtocolAcceptedByServer</span><span class="params">(String protocolVersion)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> StartupCommon.MESSAGE_PROTOCOL_VERSION.equals(protocolVersion);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LogManager.getLogger();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-8-3-TargetEffectMessageToClient-java"><a href="#2-8-3-TargetEffectMessageToClient-java" class="headerlink" title="2.8.3 TargetEffectMessageToClient.java"></a>2.8.3 TargetEffectMessageToClient.java</h4><p>服务器发送给客户端的消息类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TargetEffectMessageToClient</span></span>&#123;</span><br><span class="line">  <span class="comment">// 坐标信息与是否合法</span></span><br><span class="line">  <span class="keyword">private</span> Vec3d targetCoordinates;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> messageIsValid;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LogManager.getLogger();</span><br><span class="line">  <span class="comment">// 消息中需要存储一个粒子效果触发的位置</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TargetEffectMessageToClient</span><span class="params">(Vec3d i_targetCoordinates)</span></span>&#123;</span><br><span class="line">    targetCoordinates = i_targetCoordinates;</span><br><span class="line">    messageIsValid = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Vec3d <span class="title">getTargetCoordinates</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> targetCoordinates;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMessageValid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> messageIsValid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for use by the message handler only.</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">TargetEffectMessageToClient</span><span class="params">()</span></span>&#123;</span><br><span class="line">    messageIsValid = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从缓冲区中读取一个该信息</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> TargetEffectMessageToClient <span class="title">decode</span><span class="params">(PacketBuffer buf)</span></span>&#123;</span><br><span class="line">    TargetEffectMessageToClient retval = <span class="keyword">new</span> TargetEffectMessageToClient();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">double</span> x = buf.readDouble();</span><br><span class="line">      <span class="keyword">double</span> y = buf.readDouble();</span><br><span class="line">      <span class="keyword">double</span> z = buf.readDouble();</span><br><span class="line">      retval.targetCoordinates = <span class="keyword">new</span> Vec3d(x, y, z);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 这些注释是MBE项目中源码的注释,但是据考证,1.12之后的版本都没有这些工具了...</span></span><br><span class="line">      <span class="comment">// https://forge.yue.moe/javadoc/1.12.2/</span></span><br><span class="line">      <span class="comment">// https://forge.yue.moe/javadoc/1.16.4/</span></span><br><span class="line">      <span class="comment">// 一些读取其他对象的方法:</span></span><br><span class="line">      <span class="comment">//    Itemstacks: ByteBufUtils.readItemStack()</span></span><br><span class="line">      <span class="comment">//    NBT: ByteBufUtils.readTag()</span></span><br><span class="line">      <span class="comment">//    String: ByteBufUtils.readUTF8String()</span></span><br><span class="line">      <span class="comment">// 其中PacketBuffer是ByteBuf的子类</span></span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalArgumentException | IndexOutOfBoundsException e) &#123;</span><br><span class="line">      LOGGER.warn(<span class="string">&quot;Exception while reading TargetEffectMessageToClient: &quot;</span> + e);</span><br><span class="line">      <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    retval.messageIsValid = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> retval;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把一个信息对象写入缓冲区中</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">encode</span><span class="params">(PacketBuffer buf)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!messageIsValid) <span class="keyword">return</span>;</span><br><span class="line">    buf.writeDouble(targetCoordinates.x);</span><br><span class="line">    buf.writeDouble(targetCoordinates.y);</span><br><span class="line">    buf.writeDouble(targetCoordinates.z);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这些注释是MBE项目中源码的注释,但是据考证,1.12之后的版本都没有这些工具了...</span></span><br><span class="line">    <span class="comment">// https://forge.yue.moe/javadoc/1.12.2/</span></span><br><span class="line">    <span class="comment">// https://forge.yue.moe/javadoc/1.16.4/</span></span><br><span class="line">    <span class="comment">// 一些读取其他对象的方法:</span></span><br><span class="line">    <span class="comment">//    Itemstacks: ByteBufUtils.writeItemStack()</span></span><br><span class="line">    <span class="comment">//    NBT: ByteBufUtils.writeTag();</span></span><br><span class="line">    <span class="comment">//    String: ByteBufUtils.writeUTF8String();</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;TargetEffectMessageToClient[targetCoordinates=&quot;</span> + String.valueOf(targetCoordinates) + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-8-4-AirstrikeMessageToServer-java"><a href="#2-8-4-AirstrikeMessageToServer-java" class="headerlink" title="2.8.4 AirstrikeMessageToServer.java"></a>2.8.4 AirstrikeMessageToServer.java</h4><p>客户端发送给服务器的消息类型<br>与<code>TargetEffectMessageToClient.java</code>基本一致</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AirstrikeMessageToServer</span></span>&#123;</span><br><span class="line">  <span class="comment">// 目标坐标,生成物种类,是否有效</span></span><br><span class="line">  <span class="keyword">private</span> Vec3d targetCoordinates;</span><br><span class="line">  <span class="keyword">private</span> Projectile projectile;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">boolean</span> messageIsValid;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LogManager.getLogger();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AirstrikeMessageToServer</span><span class="params">(Projectile i_projectile, Vec3d i_targetCoordinates)</span></span>&#123;</span><br><span class="line">    projectile = i_projectile;</span><br><span class="line">    targetCoordinates = i_targetCoordinates;</span><br><span class="line">    messageIsValid = <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Vec3d <span class="title">getTargetCoordinates</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> targetCoordinates;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Projectile <span class="title">getProjectile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> projectile;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isMessageValid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> messageIsValid;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">AirstrikeMessageToServer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    messageIsValid = <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AirstrikeMessageToServer <span class="title">decode</span><span class="params">(PacketBuffer buf)</span></span>&#123;</span><br><span class="line">    AirstrikeMessageToServer retval = <span class="keyword">new</span> AirstrikeMessageToServer();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      retval.projectile = Projectile.fromPacketBuffer(buf);</span><br><span class="line">      <span class="keyword">double</span> x = buf.readDouble();</span><br><span class="line">      <span class="keyword">double</span> y = buf.readDouble();</span><br><span class="line">      <span class="keyword">double</span> z = buf.readDouble();</span><br><span class="line">      retval.targetCoordinates = <span class="keyword">new</span> Vec3d(x, y, z);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalArgumentException | IndexOutOfBoundsException e) &#123;</span><br><span class="line">      LOGGER.warn(<span class="string">&quot;Exception while reading AirStrikeMessageToServer: &quot;</span> + e);</span><br><span class="line">      <span class="keyword">return</span> retval;</span><br><span class="line">    &#125;</span><br><span class="line">    retval.messageIsValid = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">return</span> retval;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">encode</span><span class="params">(PacketBuffer buf)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!messageIsValid) <span class="keyword">return</span>;</span><br><span class="line">    projectile.toPacketBuffer(buf);</span><br><span class="line">    buf.writeDouble(targetCoordinates.x);</span><br><span class="line">    buf.writeDouble(targetCoordinates.y);</span><br><span class="line">    buf.writeDouble(targetCoordinates.z);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 内部枚举,可以被召唤的一些实体</span></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Projectile</span> </span>&#123;</span><br><span class="line">    PIG(<span class="number">1</span>, <span class="string">&quot;PIG&quot;</span>, EntityType.PIG),</span><br><span class="line">    SNOWBALL(<span class="number">2</span>, <span class="string">&quot;SNOWBALL&quot;</span>, EntityType.SNOWBALL),</span><br><span class="line">    TNT(<span class="number">3</span>, <span class="string">&quot;TNT&quot;</span>, EntityType.TNT),</span><br><span class="line">    SNOWMAN(<span class="number">4</span>, <span class="string">&quot;SNOWMAN&quot;</span>, EntityType.SNOW_GOLEM),</span><br><span class="line">    EGG(<span class="number">5</span>, <span class="string">&quot;EGG&quot;</span>, EntityType.EGG),</span><br><span class="line">    FIREBALL(<span class="number">6</span>, <span class="string">&quot;FIREBALL&quot;</span>, EntityType.FIREBALL);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">byte</span> projectileID;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EntityType entityType;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Projectile</span><span class="params">(<span class="keyword">int</span> i_projectileID, String i_name, EntityType i_entityType)</span> </span>&#123;</span><br><span class="line">      projectileID = (<span class="keyword">byte</span>)i_projectileID;</span><br><span class="line">      name = i_name;</span><br><span class="line">      entityType = i_entityType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toPacketBuffer</span><span class="params">(PacketBuffer buffer)</span> </span>&#123;</span><br><span class="line">      buffer.writeByte(projectileID);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EntityType <span class="title">getEntityType</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> entityType;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Projectile <span class="title">fromPacketBuffer</span><span class="params">(PacketBuffer buffer)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">      <span class="keyword">byte</span> ID = buffer.readByte();</span><br><span class="line">      <span class="keyword">for</span> (Projectile projectile : Projectile.values()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ID == projectile.projectileID) <span class="keyword">return</span> projectile;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Unrecognised Projectile ID:&quot;</span> + ID);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Projectile <span class="title">getRandom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Random random = <span class="keyword">new</span> Random();</span><br><span class="line">      AirstrikeMessageToServer.Projectile [] choices = AirstrikeMessageToServer.Projectile.values();</span><br><span class="line">      <span class="keyword">return</span> choices[random.nextInt(choices.length)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;AirstrikeMessageToServer[projectile=&quot;</span> + String.valueOf(projectile)</span><br><span class="line">                                                  + <span class="string">&quot;, targetCoordinates=&quot;</span> + String.valueOf(targetCoordinates) + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-8-5-ItemAirStrike-java"><a href="#2-8-5-ItemAirStrike-java" class="headerlink" title="2.8.5 ItemAirStrike.java"></a>2.8.5 ItemAirStrike.java</h4><p>一个法杖,使用后引发”空袭”,随机召唤一些东西</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemAirStrike</span> <span class="keyword">extends</span> <span class="title">Item</span></span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_NUMBER_OF_ITEMS = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ItemAirStrike</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="keyword">new</span> Item.Properties().maxStackSize(MAXIMUM_NUMBER_OF_ITEMS).group(ItemGroup.MISC));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ActionResultType <span class="title">onItemUse</span><span class="params">(ItemUseContext context)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 不应该在服务器运行(客户端运行后发送给服务器信息)</span></span><br><span class="line">    <span class="keyword">if</span> (!context.getWorld().isRemote) &#123;</span><br><span class="line">      <span class="keyword">return</span> ActionResultType.PASS;</span><br><span class="line">    &#125;</span><br><span class="line">    Vec3d targetLocation = context.getHitVec();</span><br><span class="line">    callAirstrikeOnTarget(targetLocation);</span><br><span class="line">    <span class="keyword">return</span> ActionResultType.SUCCESS;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ActionResult&lt;ItemStack&gt; <span class="title">onItemRightClick</span><span class="params">(World worldIn, PlayerEntity playerIn, Hand hand)</span></span>&#123;</span><br><span class="line">    ItemStack itemStackIn = playerIn.getHeldItem(hand);</span><br><span class="line">    <span class="comment">// 防止服务器运行</span></span><br><span class="line">    <span class="keyword">if</span> (!worldIn.isRemote) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ActionResult(ActionResultType.PASS, itemStackIn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 搞一个目标位置</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> PARTIAL_TICKS = <span class="number">1.0F</span>;</span><br><span class="line">    Vec3d playerLook = playerIn.getLookVec();</span><br><span class="line">    Vec3d playerFeetPosition = playerIn.getEyePosition(PARTIAL_TICKS).subtract(<span class="number">0</span>, playerIn.getEyeHeight(), <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">double</span> TARGET_DISTANCE = <span class="number">6.0</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">double</span> HEIGHT_ABOVE_FEET = <span class="number">0.1</span>;</span><br><span class="line">    Vec3d targetPosition = playerFeetPosition.add(playerLook.x * TARGET_DISTANCE, HEIGHT_ABOVE_FEET,</span><br><span class="line">                                                       playerLook.z * TARGET_DISTANCE);</span><br><span class="line"></span><br><span class="line">    callAirstrikeOnTarget(targetPosition);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ActionResult(ActionResultType.SUCCESS, itemStackIn);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行空袭召唤</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">callAirstrikeOnTarget</span><span class="params">(Vec3d targetPosition)</span></span>&#123;</span><br><span class="line">    <span class="comment">// 构造信息后发送给服务器</span></span><br><span class="line">    AirstrikeMessageToServer.Projectile projectile = AirstrikeMessageToServer.Projectile.getRandom();</span><br><span class="line"></span><br><span class="line">    AirstrikeMessageToServer airstrikeMessageToServer = <span class="keyword">new</span> AirstrikeMessageToServer(projectile, targetPosition);</span><br><span class="line">    StartupCommon.simpleChannel.sendToServer(airstrikeMessageToServer);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// BLOCK is a useful &#x27;do nothing&#x27; animation for this item</span></span><br><span class="line">  <span class="comment">// 啥也不做哈哈哈哈</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> UseAction <span class="title">getUseAction</span><span class="params">(ItemStack stack)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> UseAction.BLOCK;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加工具提示</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInformation</span><span class="params">(ItemStack stack, <span class="meta">@Nullable</span> World worldIn, List&lt;ITextComponent&gt; tooltip, ITooltipFlag flagIn)</span></span>&#123;</span><br><span class="line">    tooltip.add(<span class="keyword">new</span> StringTextComponent(<span class="string">&quot;Right click on target to call an air strike&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-8-6-StartUpCommon-java"><a href="#2-8-6-StartUpCommon-java" class="headerlink" title="2.8.6 StartUpCommon.java"></a>2.8.6 StartUpCommon.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartupCommon</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> ItemAirStrike itemAirStrike;</span><br><span class="line">  <span class="comment">// 一个通信通道</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> SimpleChannel simpleChannel;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用来排错用的信息ID,不要用0</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span> AIRSTRIKE_MESSAGE_ID = <span class="number">35</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">byte</span> TARGET_EFFECT_MESSAGE_ID = <span class="number">63</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// a version number for the protocol you&#x27;re using.  Can be used to maintain backward</span></span><br><span class="line">  <span class="comment">// compatibility.  But to be honest you&#x27;ll probably never need it for anything useful...</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MESSAGE_PROTOCOL_VERSION = <span class="string">&quot;1.0&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ResourceLocation simpleChannelRL = <span class="keyword">new</span> ResourceLocation(<span class="string">&quot;minecraftbyexample&quot;</span>, <span class="string">&quot;mbechannel&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onItemsRegistration</span><span class="params">(<span class="keyword">final</span> RegistryEvent.Register&lt;Item&gt; itemRegisterEvent)</span> </span>&#123;</span><br><span class="line">    itemAirStrike = <span class="keyword">new</span> ItemAirStrike();</span><br><span class="line">    itemAirStrike.setRegistryName(<span class="string">&quot;mbe60_item_airstrike_registry_name&quot;</span>);</span><br><span class="line">    itemRegisterEvent.getRegistry().register(itemAirStrike);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册一个通信通道,可以在一个通道中发送多种信息,通常一个MOD只用一个通道就够了</span></span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onCommonSetupEvent</span><span class="params">(FMLCommonSetupEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 生成通道及其处理函数</span></span><br><span class="line">    simpleChannel = NetworkRegistry.newSimpleChannel(simpleChannelRL, () -&gt; MESSAGE_PROTOCOL_VERSION,</span><br><span class="line">            MessageHandlerOnClient::isThisProtocolAcceptedByClient,</span><br><span class="line">            MessageHandlerOnServer::isThisProtocolAcceptedByServer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册通道中使用的两种信息</span></span><br><span class="line">    <span class="comment">// 尽可能把发送给服务器和发送给客户端的信息用不同的类实现,以避免不必要的麻烦...</span></span><br><span class="line">    simpleChannel.registerMessage(AIRSTRIKE_MESSAGE_ID, AirstrikeMessageToServer.class,</span><br><span class="line">            AirstrikeMessageToServer::encode, AirstrikeMessageToServer::decode,</span><br><span class="line">            MessageHandlerOnServer::onMessageReceived,</span><br><span class="line">            Optional.of(PLAY_TO_SERVER));</span><br><span class="line"></span><br><span class="line">    simpleChannel.registerMessage(TARGET_EFFECT_MESSAGE_ID, TargetEffectMessageToClient.class,</span><br><span class="line">            TargetEffectMessageToClient::encode, TargetEffectMessageToClient::decode,</span><br><span class="line">            MessageHandlerOnClient::onMessageReceived,</span><br><span class="line">            Optional.of(PLAY_TO_CLIENT));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-9-Capability-机制-TODO"><a href="#2-9-Capability-机制-TODO" class="headerlink" title="2.9 Capability 机制(TODO)"></a>2.9 Capability 机制(TODO)</h3><h3 id="2-10-测试"><a href="#2-10-测试" class="headerlink" title="2.10 测试"></a>2.10 测试</h3><p>MBE 中演示的游戏内测试框架一个两种:</p>
<ul>
<li>使用一个测试物品触发测试函数</li>
<li>使用命令触发测试函数</li>
</ul>
<p>其中还可以使用命令设置一些参数,使得使用命令触发测试的时候可以做到交互式测试</p>
<h4 id="2-10-1-使用测试物品测试"><a href="#2-10-1-使用测试物品测试" class="headerlink" title="2.10.1 使用测试物品测试"></a>2.10.1 使用测试物品测试</h4><p>使用物品测试就简单了</p>
<ul>
<li>首先做一个测试类,其中留有一些测试函数供其他类调用</li>
<li>然后注册一个测试物品,右键使用这个物品的时候调用测试函数,同时根据一些条件设置不同的参数</li>
</ul>
<h5 id="2-10-1-1-测试类"><a href="#2-10-1-1-测试类" class="headerlink" title="2.10.1.1 测试类"></a>2.10.1.1 测试类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRunner</span></span>&#123;</span><br><span class="line">  <span class="comment">// 服务器端调用测试</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">runServerSideTest</span><span class="params">(World worldIn, PlayerEntity playerIn, <span class="keyword">int</span> testNumber)</span></span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> success = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">switch</span> (testNumber) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">        success = test1(worldIn, playerIn);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">default</span>: &#123;</span><br><span class="line">        LOGGER.error(<span class="string">&quot;Test Number &quot;</span> + testNumber + <span class="string">&quot; does not exist on server side.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LOGGER.error(<span class="string">&quot;Test Number &quot;</span> + testNumber + <span class="string">&quot; called on server side:&quot;</span> + (success ? <span class="string">&quot;success&quot;</span> : <span class="string">&quot;failure&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> success;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在客户端不进行测试调用</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">runClientSideTest</span><span class="params">(World worldIn, PlayerEntity playerIn, <span class="keyword">int</span> testNumber)</span></span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> success = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (testNumber) &#123;</span><br><span class="line">      <span class="keyword">case</span> -<span class="number">1</span>: &#123;  <span class="comment">// dummy (do nothing) - can never be called, just to prevent unreachable code compiler error</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">default</span>: &#123;</span><br><span class="line">        LOGGER.error(<span class="string">&quot;Test Number &quot;</span> + testNumber + <span class="string">&quot; does not exist on client side.&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LOGGER.error(<span class="string">&quot;Test Number &quot;</span> + testNumber + <span class="string">&quot; called on client side:&quot;</span> + (success ? <span class="string">&quot;success&quot;</span> : <span class="string">&quot;failure&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> success;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 测试函数</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">test1</span><span class="params">(World worldIn, PlayerEntity playerIn)</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 辅助函数(传送命令示例)</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">teleportPlayerToTestRegion</span><span class="params">(PlayerEntity player, BlockPos location)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(player <span class="keyword">instanceof</span> ServerPlayerEntity)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">&quot;teleport not supported on client side; server side only&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    CommandSource commandSource = player.getCommandSource();</span><br><span class="line">    String tpCommand = <span class="string">&quot;/tp &quot;</span> + location.getX() + <span class="string">&quot; &quot;</span> + location.getY() + <span class="string">&quot; &quot;</span> + location.getZ();</span><br><span class="line">    <span class="keyword">int</span> success = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      success = player.getServer().getCommandManager().handleCommand(commandSource, tpCommand);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (success != <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LogManager.getLogger();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-10-1-2-测试物品"><a href="#2-10-1-2-测试物品" class="headerlink" title="2.10.1.2 测试物品"></a>2.10.1.2 测试物品</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemTestRunner</span> <span class="keyword">extends</span> <span class="title">Item</span></span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_TEST_NUMBER = <span class="number">64</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ItemTestRunner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(<span class="keyword">new</span> Item.Properties().maxStackSize(MAX_TEST_NUMBER).group(ItemGroup.MISC));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 添加帮助信息</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInformation</span><span class="params">(ItemStack stack, <span class="meta">@Nullable</span> World worldIn, List&lt;ITextComponent&gt; tooltip, ITooltipFlag flagIn)</span> </span>&#123;</span><br><span class="line">    tooltip.add(<span class="keyword">new</span> StringTextComponent(<span class="string">&quot;Right click: conduct test&quot;</span>));</span><br><span class="line">    tooltip.add(<span class="keyword">new</span> StringTextComponent(<span class="string">&quot;Stacksize: change test #&quot;</span>));</span><br><span class="line">    tooltip.add(<span class="keyword">new</span> StringTextComponent(<span class="string">&quot;  (64 = test all)&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// what animation to use when the player holds the &quot;use&quot; button</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> UseAction <span class="title">getUseAction</span><span class="params">(ItemStack stack)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> UseAction.BLOCK;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// how long the player needs to hold down the right button before the test runs again</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUseDuration</span><span class="params">(ItemStack stack)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 右键触发测试</span></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ActionResult&lt;ItemStack&gt; <span class="title">onItemRightClick</span><span class="params">(World worldIn, PlayerEntity playerIn, Hand hand)</span> </span>&#123;</span><br><span class="line">    ItemStack itemStackIn = playerIn.getHeldItem(hand);</span><br><span class="line">    <span class="keyword">if</span> (itemStackIn.isEmpty()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> ActionResult&lt;ItemStack&gt;(ActionResultType.FAIL, itemStackIn);  <span class="comment">// just in case.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> testNumber = itemStackIn.getCount(); <span class="comment">// getStackSize()</span></span><br><span class="line">    TestRunner testRunner = <span class="keyword">new</span> TestRunner();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (worldIn.isRemote) &#123;</span><br><span class="line">      testRunner.runClientSideTest(worldIn, playerIn, testNumber);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      testRunner.runServerSideTest(worldIn, playerIn, testNumber);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ActionResult&lt;ItemStack&gt;(ActionResultType.PASS, itemStackIn);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-10-2-使用命令测试"><a href="#2-10-2-使用命令测试" class="headerlink" title="2.10.2 使用命令测试"></a>2.10.2 使用命令测试</h4><p>使用命令一共分为四个部分:</p>
<ul>
<li>构建一个存储交互式设置的参数的类:DebugSetting</li>
<li>构建一个存有测试函数的类:TestRunner(和使用测试物品测试一样)</li>
<li>构建一个在命令设置完参数后触发测试函数的监听器:DebugTestWatcher</li>
<li>构建一个命令系统,用于设置参数和触发测试:MBEdebugCommand</li>
<li>完成必要的注册</li>
</ul>
<h5 id="2-10-2-1-交互式存储参数的类"><a href="#2-10-2-1-交互式存储参数的类" class="headerlink" title="2.10.2.1 交互式存储参数的类"></a>2.10.2.1 交互式存储参数的类</h5><p>简而言之,这个类提供了一系列的 setter 和 getter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DebugSettings</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 记录是否触发测试,以及测试的编号(供DebugTestWatcher使用)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NO_TEST_TRIGGERED = -<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> debugTest = NO_TEST_TRIGGERED;</span><br><span class="line">  <span class="comment">// 存储测试参数用的哈希表</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, Optional&lt;Double&gt;&gt; debugParameters = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setDebugParameter</span><span class="params">(String parameterName, <span class="keyword">double</span> value)</span> </span>&#123;</span><br><span class="line">    debugParameters.put(parameterName, Optional.of(value));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">clearDebugParameter</span><span class="params">(String parameterName)</span> </span>&#123;</span><br><span class="line">    debugParameters.put(parameterName, Optional.empty());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Gets the value of the given debug parameter; or empty if not previously set.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> parameterName</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Optional&lt;Double&gt; <span class="title">getDebugParameter</span><span class="params">(String parameterName)</span> </span>&#123;</span><br><span class="line">    Optional&lt;Double&gt; value = debugParameters.get(parameterName);</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">      debugParameters.put(parameterName, Optional.empty());</span><br><span class="line">      <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Set&lt;String&gt; <span class="title">listAllDebugParameters</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> debugParameters.keySet();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//-----------</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setDebugParameterVec3d</span><span class="params">(String parameterName, Vec3d value)</span> </span>&#123;</span><br><span class="line">    debugParameterVec3ds.put(parameterName, Optional.of(value));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">clearDebugParameterVec3d</span><span class="params">(String parameterName)</span> </span>&#123;</span><br><span class="line">    debugParameterVec3ds.put(parameterName, Optional.empty());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Gets the value of the given debug parameter; or 0 if not previously set</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> parameterName</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Optional&lt;Vec3d&gt; <span class="title">getDebugParameterVec3d</span><span class="params">(String parameterName)</span> </span>&#123;</span><br><span class="line">    Optional&lt;Vec3d&gt; value = debugParameterVec3ds.get(parameterName);</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="keyword">null</span>) &#123;</span><br><span class="line">      debugParameterVec3ds.put(parameterName, Optional.empty());</span><br><span class="line">      <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Set&lt;String&gt; <span class="title">listAllDebugParameterVec3ds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> debugParameterVec3ds.keySet();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, Optional&lt;Vec3d&gt;&gt; debugParameterVec3ds = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//-----------</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setDebugTrigger</span><span class="params">(String parameterName)</span> </span>&#123;</span><br><span class="line">    debugTriggers.put(parameterName, <span class="keyword">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns true if the trigger is set.  Resets to false.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> parameterName</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">boolean</span> <span class="title">getDebugTrigger</span><span class="params">(String parameterName)</span> </span>&#123;</span><br><span class="line">    Boolean value = debugTriggers.getOrDefault(parameterName, <span class="keyword">false</span>);</span><br><span class="line">    debugTriggers.put(parameterName, <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Set&lt;String&gt; <span class="title">listAllDebugTriggers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> debugTriggers.keySet();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> HashMap&lt;String, Boolean&gt; debugTriggers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//-----------------</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">setDebugTest</span><span class="params">(<span class="keyword">int</span> testnumber)</span> </span>&#123;</span><br><span class="line">    debugTest = testnumber;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Checks the specified range of test numbers and returns the currently triggered test number if it lies within the checked range.</span></span><br><span class="line"><span class="comment">   * If the currently triggered test lies within the checked range, it is reset</span></span><br><span class="line"><span class="comment">   * Beware - if you have multiple callers looking for debug tests in the same range using getDebugTest, only the first caller will ever find one.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * eg:</span></span><br><span class="line"><span class="comment">   * 1) caller calls setDebugTest(65)</span></span><br><span class="line"><span class="comment">   * 2a) getDebugTest(0, 10) returns NO_TEST_TRIGGERED</span></span><br><span class="line"><span class="comment">   * 2b) getDebugTest(60, 65) returns NO_TEST_TRIGGERED</span></span><br><span class="line"><span class="comment">   * 2c) getDebugTest(60, 66) returns 65</span></span><br><span class="line"><span class="comment">   * 2d) calling getDebugTest(60, 66) for a second time now returns NO_TEST_TRIGGERED</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> testNumberMin lowest test number to check</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span>  testNumberMaxPlusOne highest test number to check plus one</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> the test number to execute, or NO_TEST_TRIGGERED if none triggered</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">getDebugTest</span><span class="params">(<span class="keyword">int</span> testNumberMin, <span class="keyword">int</span> testNumberMaxPlusOne)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (debugTest &lt; testNumberMin || debugTest &gt;= testNumberMaxPlusOne) <span class="keyword">return</span> NO_TEST_TRIGGERED;</span><br><span class="line">    <span class="keyword">int</span> value = debugTest;</span><br><span class="line">    debugTest = NO_TEST_TRIGGERED;</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="2-10-2-2-触发测试的监听器"><a href="#2-10-2-2-触发测试的监听器" class="headerlink" title="2.10.2.2 触发测试的监听器"></a>2.10.2.2 触发测试的监听器</h5><p>监听器每个 tick 进行一次检查,在服务器上且玩家通过命令触发测试的时候调用测试函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DebugTestWatcher</span> </span>&#123;</span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onServerTick</span><span class="params">(TickEvent.PlayerTickEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (event.side != LogicalSide.SERVER) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取玩家设置的测试编号</span></span><br><span class="line">    <span class="keyword">int</span> testNumber = DebugSettings.getDebugTest(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">    <span class="keyword">if</span> (testNumber == DebugSettings.NO_TEST_TRIGGERED) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">// 在这一步可以读取一些玩家设置的参数,或者留到测试函数中进行这一步</span></span><br><span class="line">    testRunner.runServerSideTest(event.player.world, event.player, testNumber);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> TestRunner testRunner = <span class="keyword">new</span> TestRunner();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-10-2-3-命令系统"><a href="#2-10-2-3-命令系统" class="headerlink" title="2.10.2.3 命令系统"></a>2.10.2.3 命令系统</h5><p>略,见<code>2.6</code>章</p>
<h5 id="2-10-2-4-注册"><a href="#2-10-2-4-注册" class="headerlink" title="2.10.2.4 注册"></a>2.10.2.4 注册</h5><p>首先在<code>StartUpCommon.java</code>中进行注册 ServerLifecycleEvents 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onCommonSetupEvent</span><span class="params">(FMLCommonSetupEvent event)</span> </span>&#123;</span><br><span class="line">    MinecraftForge.EVENT_BUS.register(ServerLifecycleEvents.class);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 ServerLifecycleEvents 类中注册触发测试的监听器<br>同时把测试相关的命令给注册了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerLifecycleEvents</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onServerStartingEvent</span><span class="params">(FMLServerStartingEvent event)</span> </span>&#123;</span><br><span class="line">    CommandDispatcher&lt;CommandSource&gt; commandDispatcher = event.getCommandDispatcher();</span><br><span class="line">    MBEdebugCommand.register(commandDispatcher);</span><br><span class="line">    MinecraftForge.EVENT_BUS.register(DebugTestWatcher.class);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-11-模型渲染-TODO"><a href="#2-11-模型渲染-TODO" class="headerlink" title="2.11 模型渲染(TODO)"></a>2.11 模型渲染(TODO)</h3><h3 id="2-12-投掷物-TODO"><a href="#2-12-投掷物-TODO" class="headerlink" title="2.12 投掷物(TODO)"></a>2.12 投掷物(TODO)</h3><h2 id="3-实用工具-TODO"><a href="#3-实用工具-TODO" class="headerlink" title="3. 实用工具(TODO)"></a>3. 实用工具(TODO)</h2><h3 id="3-1-实用函数"><a href="#3-1-实用函数" class="headerlink" title="3.1 实用函数"></a>3.1 实用函数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UsefulFunctions</span></span>&#123;</span><br><span class="line">  <span class="comment">// 越界截断的线性插值</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">interpolate_with_clipping</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">double</span> x1, <span class="keyword">double</span> x2, <span class="keyword">double</span> y1, <span class="keyword">double</span> y2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x1 &gt; x2) &#123;</span><br><span class="line">      <span class="keyword">double</span> temp = x1; x1 = x2; x2 = temp;</span><br><span class="line">      temp = y1; y1 = y2; y2 = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (x &lt;= x1) <span class="keyword">return</span> y1;</span><br><span class="line">    <span class="keyword">if</span> (x &gt;= x2) <span class="keyword">return</span> y2;</span><br><span class="line">    <span class="keyword">double</span> xFraction = (x - x1) / (x2 - x1);</span><br><span class="line">    <span class="keyword">return</span> y1 + xFraction * (y2 - y1);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向量乘法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vec3d <span class="title">scalarMultiply</span><span class="params">(Vec3d source, <span class="keyword">double</span> multiplier)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Vec3d(source.x * multiplier, source.y * multiplier, source.z * multiplier);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向量转NBT</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ListNBT <span class="title">serializeVec3d</span><span class="params">(Vec3d vec3d)</span> </span>&#123;</span><br><span class="line">    ListNBT listnbt = <span class="keyword">new</span> ListNBT();</span><br><span class="line">    listnbt.add(DoubleNBT.valueOf(vec3d.x));</span><br><span class="line">    listnbt.add(DoubleNBT.valueOf(vec3d.y));</span><br><span class="line">    listnbt.add(DoubleNBT.valueOf(vec3d.z));</span><br><span class="line">    <span class="keyword">return</span> listnbt;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// NBT转向量</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vec3d <span class="title">deserializeVec3d</span><span class="params">(CompoundNBT nbt, String tagname)</span> </span>&#123;</span><br><span class="line">    ListNBT listnbt = nbt.getList(tagname, NBTtypesMBE.DOUBLE_NBT_ID);</span><br><span class="line">    Vec3d retval = <span class="keyword">new</span> Vec3d(listnbt.getDouble(<span class="number">0</span>), listnbt.getDouble(<span class="number">1</span>), listnbt.getDouble(<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">return</span> retval;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-BlockStateFlag-工具"><a href="#3-2-BlockStateFlag-工具" class="headerlink" title="3.2 BlockStateFlag 工具"></a>3.2 BlockStateFlag 工具</h3><p>在使用<code>SetBlockState</code>函数设置方块状态的时候,不同的数字意义不易读<br>可以使用这个枚举快速设置,多个状态可以用或连接</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">SetBlockStateFlag</span> </span>&#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Sets a block state into this world.Flags are as follows:</span></span><br><span class="line"><span class="comment">   * 1 will cause a block update.</span></span><br><span class="line"><span class="comment">   * 2 will send the change to clients.</span></span><br><span class="line"><span class="comment">   * 4 will prevent the block from being re-rendered.</span></span><br><span class="line"><span class="comment">   * 8 will force any re-renders to run on the main thread instead</span></span><br><span class="line"><span class="comment">   * 16 will prevent neighbor reactions (e.g. fences connecting, observers pulsing).</span></span><br><span class="line"><span class="comment">   * 32 will prevent neighbor reactions from spawning drops.</span></span><br><span class="line"><span class="comment">   * 64 will signify the block is being moved.</span></span><br><span class="line"><span class="comment">   * Flags can be OR-ed</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">  BLOCK_UPDATE(<span class="number">1</span>),</span><br><span class="line">  SEND_TO_CLIENTS(<span class="number">2</span>),</span><br><span class="line">  DO_NOT_RENDER(<span class="number">4</span>),</span><br><span class="line">  RUN_RENDER_ON_MAIN_THREAD(<span class="number">8</span>),</span><br><span class="line">  PREVENT_NEIGHBOUR_REACTIONS(<span class="number">16</span>),</span><br><span class="line">  NEIGHBOUR_REACTIONS_DONT_SPAWN_DROPS(<span class="number">32</span>),</span><br><span class="line">  BLOCK_IS_BEING_MOVED(<span class="number">64</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(SetBlockStateFlag... flags)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (SetBlockStateFlag flag : flags) &#123;</span><br><span class="line">      result |= flag.flagValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  SetBlockStateFlag(<span class="keyword">int</span> flagValue) &#123;<span class="keyword">this</span>.flagValue = flagValue;&#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> flagValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-阻止生物生成工具"><a href="#3-3-阻止生物生成工具" class="headerlink" title="3.3 阻止生物生成工具"></a>3.3 阻止生物生成工具</h3><p>如下监听器监听生物生成事件,同时根据设置的参数决定是否生成<br>与<code>/kill @e[type=!Player]</code>命令一同使用,可以在调试时阻止生物的干扰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DebugSpawnInhibitor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@SubscribeEvent</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">checkForSpawnDenial</span><span class="params">(LivingSpawnEvent.CheckSpawn event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (DebugSettings.getDebugParameter(<span class="string">&quot;preventspawning&quot;</span>).isPresent()) &#123;</span><br><span class="line">      ResourceLocation entityname = ForgeRegistries.ENTITIES.getKey(event.getEntity().getType());</span><br><span class="line">      <span class="keyword">if</span> (entityname.getNamespace().equals(<span class="string">&quot;minecraft&quot;</span>)) &#123;</span><br><span class="line">        event.setResult(Event.Result.DENY);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        event.setResult(Event.Result.DEFAULT);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      event.setResult(Event.Result.DEFAULT);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">遗世雨</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yishiyu.world/2021/03/14/Minecraft%20Mod%20%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">http://yishiyu.world/2021/03/14/Minecraft Mod 设计模式/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yishiyu.world" target="_blank">遗世の私语</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Minecraft/">Minecraft</a></div><div class="post_share"><div class="social-share" data-image="http://img.yishiyu.world/blogs/cover/post/20210224/008.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/07/27/设计模式/" title="设计模式"><img class="cover" src="http://img.yishiyu.world/blogs/cover/post/20210208/007.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-27</div><div class="title">设计模式</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Minecraft-Mod-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">Minecraft Mod 设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E6%A6%82%E8%BF%B0"><span class="toc-text">0. 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E9%A1%B9%E7%9B%AE%E6%A8%A1%E5%BC%8F"><span class="toc-text">1. 项目模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-mods-toml"><span class="toc-text">1.1 mods.toml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-build-gradle"><span class="toc-text">1.2 build.gradle</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E6%A8%A1%E5%BC%8F"><span class="toc-text">2. 代码模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Mod-%E4%B8%BB%E7%B1%BB"><span class="toc-text">2.1 Mod 主类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%96%B9%E5%9D%97"><span class="toc-text">2.2 方块</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E7%AE%80%E5%8D%95%E6%96%B9%E5%9D%97"><span class="toc-text">2.2.1 简单方块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-1-SimpleBlock-java"><span class="toc-text">2.2.1.1 SimpleBlock.java</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-2-StartUpClientOnly-java"><span class="toc-text">2.2.1.2 StartUpClientOnly.java</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-3-StartUpCommon-java"><span class="toc-text">2.2.1.3 StartUpCommon.java</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-4-%E5%9B%BD%E9%99%85%E5%8C%96%E4%B8%8E%E5%8C%BA%E5%9F%9F%E5%8C%96-%E4%BA%BA%E8%AF%9D-%E8%AE%BE%E7%BD%AE%E7%BF%BB%E8%AF%91%E6%96%87%E4%BB%B6"><span class="toc-text">2.2.1.4 国际化与区域化(人话:设置翻译文件)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-1-5-%E6%A8%A1%E5%9E%8B%E7%9B%B8%E5%85%B3%E7%9A%84%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-text">2.2.1.5 模型相关的文件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#simple-block-registry-json"><span class="toc-text">simple_block_registry.json</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#simple-block-model-json"><span class="toc-text">simple_block_model.json</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#simple-item-model-json"><span class="toc-text">simple_item_model.json</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#simple-block-loot-table-json"><span class="toc-text">simple_block_loot_table.json</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E9%9D%9E%E5%AE%8C%E6%95%B4%E6%96%B9%E5%9D%97"><span class="toc-text">2.2.2 非完整方块</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-2-1-BlockPartial-java"><span class="toc-text">2.2.2.1 BlockPartial.java</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-2-2-partial-block-model-json"><span class="toc-text">2.2.2.2 partial_block_model.json</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-%E6%96%B9%E5%9D%97%E5%8F%98%E4%BD%93"><span class="toc-text">2.2.3 方块变体</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-1-%E5%A4%9A%E6%A8%A1%E5%9E%8B%E6%96%B9%E6%B3%95"><span class="toc-text">2.2.3.1 多模型方法</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#2-2-3-1-1-%E4%B8%8D%E5%90%8C%E7%9A%84%E9%A2%9C%E8%89%B2"><span class="toc-text">2.2.3.1.1 不同的颜色</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-2-3-1-2-%E4%B8%8D%E5%90%8C%E7%9A%84%E6%A8%A1%E5%9E%8B"><span class="toc-text">2.2.3.1.2 不同的模型</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-3-2-%E6%A0%B8%E5%BF%83-%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95"><span class="toc-text">2.2.3.2 核心-扩展方法</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E6%96%B9%E5%9D%97%E5%8A%A8%E6%80%81%E6%A8%A1%E5%9E%8B-%E4%B8%8D%E5%B8%B8%E7%94%A8"><span class="toc-text">2.2.4 方块动态模型(不常用)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-5-%E5%A4%9A%E5%B1%82%E6%A8%A1%E5%9E%8B-%E4%B8%8D%E5%B8%B8%E7%94%A8"><span class="toc-text">2.2.5 多层模型(不常用)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-6-%E7%BA%A2%E7%9F%B3%E7%9B%B8%E5%85%B3-%E9%9D%9E%E5%B8%B8%E4%B8%8D%E5%B8%B8%E7%94%A8"><span class="toc-text">2.2.6 红石相关(非常不常用)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-7-%E5%88%9B%E9%80%A0%E6%A8%A1%E5%BC%8F%E6%A0%87%E7%AD%BE%E9%A1%B5"><span class="toc-text">2.2.7 创造模式标签页</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-7-1-%E6%9E%84%E9%80%A0%E6%A0%87%E7%AD%BE%E9%A1%B5"><span class="toc-text">2.2.7.1 构造标签页</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-7-2-%E6%8A%8A%E7%89%A9%E5%93%81%E6%B7%BB%E5%8A%A0%E5%88%B0%E6%A0%87%E7%AD%BE%E9%A1%B5"><span class="toc-text">2.2.7.2 把物品添加到标签页</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E7%89%A9%E5%93%81"><span class="toc-text">2.3 物品</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E7%AE%80%E5%8D%95%E7%89%A9%E5%93%81"><span class="toc-text">2.3.1 简单物品</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E7%89%A9%E5%93%81%E5%8F%98%E4%BD%93"><span class="toc-text">2.3.2 物品变体</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-1-%E9%A2%9C%E8%89%B2%E7%B1%BB"><span class="toc-text">2.3.2.1 颜色类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-2-%E7%89%A9%E5%93%81%E6%A8%A1%E5%9E%8B"><span class="toc-text">2.3.2.2 物品模型</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-3-%E7%89%A9%E5%93%81%E7%B1%BB"><span class="toc-text">2.3.2.3 物品类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-2-4-%E6%B3%A8%E5%86%8C"><span class="toc-text">2.3.2.4 注册</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-NBT-%E5%8A%A8%E7%94%BB"><span class="toc-text">2.3.3 NBT 动画</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-1-%E6%A8%A1%E5%9E%8B%E6%96%87%E4%BB%B6"><span class="toc-text">2.3.3.1 模型文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-3-3-2-ItemNBTanimationTimer-java"><span class="toc-text">2.3.3.2 ItemNBTanimationTimer.java</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-4-%E7%89%A9%E5%93%81%E8%A7%86%E8%A7%92%E8%AE%BE%E7%BD%AE-%E4%B8%8D%E5%B8%B8%E7%94%A8"><span class="toc-text">2.3.4 物品视角设置(不常用)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-5-%E5%8A%A8%E6%80%81%E7%89%A9%E5%93%81%E6%A8%A1%E5%9E%8B-%E4%B8%8D%E5%B8%B8%E7%94%A8"><span class="toc-text">2.3.5 动态物品模型(不常用)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-TileEntity"><span class="toc-text">2.4 TileEntity</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%E4%B8%8E%E8%A7%A6%E5%8F%91%E5%8A%A8%E4%BD%9C"><span class="toc-text">2.4.1 存储数据与触发动作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-1-1-%E6%96%B9%E5%9D%97%E4%B8%BB%E7%B1%BB"><span class="toc-text">2.4.1.1 方块主类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-1-2-TileEntity-%E7%B1%BB"><span class="toc-text">2.4.1.2 TileEntity 类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-4-1-3-%E6%B3%A8%E5%86%8C"><span class="toc-text">2.4.1.3 注册</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E6%B8%B2%E6%9F%93-TODO"><span class="toc-text">2.4.2 渲染(TODO)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%AD%98%E5%82%A8%E6%96%B9%E5%9D%97-inventory-TODO"><span class="toc-text">2.5 存储方块(inventory)(TODO)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-4-%E5%90%88%E6%88%90%E8%A1%A8"><span class="toc-text">2.5.4 合成表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E5%91%BD%E4%BB%A4-TODO"><span class="toc-text">2.6 命令(TODO)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-1-%E6%B3%A8%E5%86%8C%E5%91%BD%E4%BB%A4"><span class="toc-text">2.6.1 注册命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-2-%E6%9E%84%E9%80%A0%E5%91%BD%E4%BB%A4"><span class="toc-text">2.6.2 构造命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E7%B2%92%E5%AD%90%E6%95%88%E6%9E%9C-TODO"><span class="toc-text">2.7 粒子效果(TODO)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1"><span class="toc-text">2.8 网络通信</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-1-MessageHandlerOnClient-java"><span class="toc-text">2.8.1 MessageHandlerOnClient.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-2-MessageHandlerOnServer-java"><span class="toc-text">2.8.2 MessageHandlerOnServer.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-3-TargetEffectMessageToClient-java"><span class="toc-text">2.8.3 TargetEffectMessageToClient.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-4-AirstrikeMessageToServer-java"><span class="toc-text">2.8.4 AirstrikeMessageToServer.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-5-ItemAirStrike-java"><span class="toc-text">2.8.5 ItemAirStrike.java</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-8-6-StartUpCommon-java"><span class="toc-text">2.8.6 StartUpCommon.java</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-Capability-%E6%9C%BA%E5%88%B6-TODO"><span class="toc-text">2.9 Capability 机制(TODO)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-%E6%B5%8B%E8%AF%95"><span class="toc-text">2.10 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-10-1-%E4%BD%BF%E7%94%A8%E6%B5%8B%E8%AF%95%E7%89%A9%E5%93%81%E6%B5%8B%E8%AF%95"><span class="toc-text">2.10.1 使用测试物品测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-10-1-1-%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-text">2.10.1.1 测试类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-10-1-2-%E6%B5%8B%E8%AF%95%E7%89%A9%E5%93%81"><span class="toc-text">2.10.1.2 测试物品</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-10-2-%E4%BD%BF%E7%94%A8%E5%91%BD%E4%BB%A4%E6%B5%8B%E8%AF%95"><span class="toc-text">2.10.2 使用命令测试</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-10-2-1-%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%AD%98%E5%82%A8%E5%8F%82%E6%95%B0%E7%9A%84%E7%B1%BB"><span class="toc-text">2.10.2.1 交互式存储参数的类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-10-2-2-%E8%A7%A6%E5%8F%91%E6%B5%8B%E8%AF%95%E7%9A%84%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-text">2.10.2.2 触发测试的监听器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-10-2-3-%E5%91%BD%E4%BB%A4%E7%B3%BB%E7%BB%9F"><span class="toc-text">2.10.2.3 命令系统</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-10-2-4-%E6%B3%A8%E5%86%8C"><span class="toc-text">2.10.2.4 注册</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-%E6%A8%A1%E5%9E%8B%E6%B8%B2%E6%9F%93-TODO"><span class="toc-text">2.11 模型渲染(TODO)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-12-%E6%8A%95%E6%8E%B7%E7%89%A9-TODO"><span class="toc-text">2.12 投掷物(TODO)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7-TODO"><span class="toc-text">3. 实用工具(TODO)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%AE%9E%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-text">3.1 实用函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-BlockStateFlag-%E5%B7%A5%E5%85%B7"><span class="toc-text">3.2 BlockStateFlag 工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E9%98%BB%E6%AD%A2%E7%94%9F%E7%89%A9%E7%94%9F%E6%88%90%E5%B7%A5%E5%85%B7"><span class="toc-text">3.3 阻止生物生成工具</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 遗世雨</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/"><img class="icp-icon" src="https://pic3.zhimg.com/80/v2-d0289dc0a46fc5b15b3363ffa78cf6c7.png"><span>陕ICP备20012321号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>