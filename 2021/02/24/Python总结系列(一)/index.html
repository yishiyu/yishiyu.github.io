<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Python总结系列(一) | 遗世の私语</title><meta name="keywords" content="python,科研学习"><meta name="author" content="遗世雨"><meta name="copyright" content="遗世雨"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Python 标准库(科学计算相关)0. 概述主要参考资料: Python 3 Module of the Week | pymotwpython 文档 | python菜鸟教程 | runoob 重点看和科学计算相关的库,网络之类的库回头用到了再看 1. 文本格式化1.1 基本方法最基本的方法是使用 print 函数的格式化写法 1print (&quot;my name is %s,%d ye">
<meta property="og:type" content="article">
<meta property="og:title" content="Python总结系列(一)">
<meta property="og:url" content="http://yishiyu.github.io/2021/02/24/Python%E6%80%BB%E7%BB%93%E7%B3%BB%E5%88%97(%E4%B8%80)/index.html">
<meta property="og:site_name" content="遗世の私语">
<meta property="og:description" content="Python 标准库(科学计算相关)0. 概述主要参考资料: Python 3 Module of the Week | pymotwpython 文档 | python菜鸟教程 | runoob 重点看和科学计算相关的库,网络之类的库回头用到了再看 1. 文本格式化1.1 基本方法最基本的方法是使用 print 函数的格式化写法 1print (&quot;my name is %s,%d ye">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://img.yishiyu.world/blogs/cover/post/20210224/005.jpg">
<meta property="article:published_time" content="2021-02-24T10:26:37.000Z">
<meta property="article:modified_time" content="2021-03-03T11:06:11.601Z">
<meta property="article:author" content="遗世雨">
<meta property="article:tag" content="python">
<meta property="article:tag" content="科研学习">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://img.yishiyu.world/blogs/cover/post/20210224/005.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yishiyu.github.io/2021/02/24/Python%E6%80%BB%E7%BB%93%E7%B3%BB%E5%88%97(%E4%B8%80)/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 遗世雨","link":"链接: ","source":"来源: 遗世の私语","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2021-03-03 19:06:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/Hiki.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">35</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('http://img.yishiyu.world/blogs/cover/post/20210224/005.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">遗世の私语</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Python总结系列(一)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-02-24T10:26:37.000Z" title="发表于 2021-02-24 18:26:37">2021-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-03T11:06:11.601Z" title="更新于 2021-03-03 19:06:11">2021-03-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Python-标准库-科学计算相关"><a href="#Python-标准库-科学计算相关" class="headerlink" title="Python 标准库(科学计算相关)"></a>Python 标准库(科学计算相关)</h1><h2 id="0-概述"><a href="#0-概述" class="headerlink" title="0. 概述"></a>0. 概述</h2><p>主要参考资料:</p>
<p><a target="_blank" rel="noopener" href="https://pymotw.com/3/index.html">Python 3 Module of the Week | pymotw</a><br><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3.9/">python 文档 | python</a><br><a target="_blank" rel="noopener" href="https://www.runoob.com/python3/python3-tutorial.html">菜鸟教程 | runoob</a></p>
<p>重点看和科学计算相关的库,网络之类的库回头用到了再看</p>
<h2 id="1-文本格式化"><a href="#1-文本格式化" class="headerlink" title="1. 文本格式化"></a>1. 文本格式化</h2><h3 id="1-1-基本方法"><a href="#1-1-基本方法" class="headerlink" title="1.1 基本方法"></a>1.1 基本方法</h3><p>最基本的方法是使用 print 函数的格式化写法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> (<span class="string">&quot;my name is %s,%d years old&quot;</span> % (<span class="string">&#x27;yishiyu&#x27;</span>, <span class="number">10</span>))</span><br></pre></td></tr></table></figure>
<p>其中占位符的含义为(参考自: <a target="_blank" rel="noopener" href="https://www.runoob.com/python3/python3-string.html">菜鸟教程</a>):</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">占位符</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">%c</td>
<td style="text-align:left">字符及其 ascii 码</td>
</tr>
<tr>
<td style="text-align:center">%s</td>
<td style="text-align:left">字符串</td>
</tr>
<tr>
<td style="text-align:center">%d</td>
<td style="text-align:left">整数</td>
</tr>
<tr>
<td style="text-align:center">%u</td>
<td style="text-align:left">无符号整数</td>
</tr>
<tr>
<td style="text-align:center">%o</td>
<td style="text-align:left">无符号八进制数</td>
</tr>
<tr>
<td style="text-align:center">%x</td>
<td style="text-align:left">无符号十六进制小写</td>
</tr>
<tr>
<td style="text-align:center">%X</td>
<td style="text-align:left">无符号十六进制大写</td>
</tr>
<tr>
<td style="text-align:center">%f</td>
<td style="text-align:left">浮点数</td>
</tr>
<tr>
<td style="text-align:center">%e</td>
<td style="text-align:left">科学计数法浮点数</td>
</tr>
<tr>
<td style="text-align:center">%p</td>
<td style="text-align:left">十六进制变量地址</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">辅助指令</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:left">左对齐</td>
</tr>
<tr>
<td style="text-align:center">+</td>
<td style="text-align:left">正数前显示加号</td>
</tr>
<tr>
<td style="text-align:center">#</td>
<td style="text-align:left">特殊进制前显示标志</td>
</tr>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:left">默认填充 0 而非空格</td>
</tr>
<tr>
<td style="text-align:center">%%</td>
<td style="text-align:left">转义输出%</td>
</tr>
<tr>
<td style="text-align:center">(var)</td>
<td style="text-align:left">映射字典中的变量</td>
</tr>
<tr>
<td style="text-align:center">m.n</td>
<td style="text-align:left">最小位宽,小数精度</td>
</tr>
</tbody>
</table>
</div>
<h3 id="1-2-format-函数"><a href="#1-2-format-函数" class="headerlink" title="1.2 format 函数"></a>1.2 format 函数</h3><p>format 函数是 str 类的内置函数</p>
<p>首先可以使用带下标的占位符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">&quot;&#123;&#125; &#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">s2 = <span class="string">&quot;&#123;1&#125; &#123;0&#125; &#123;1&#125;&quot;</span>.<span class="built_in">format</span>(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>然后可以设置复杂的参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&quot;网站名：&#123;name&#125;, 地址 &#123;url&#125;&quot;</span>.<span class="built_in">format</span>(name=<span class="string">&quot;菜鸟教程&quot;</span>, url=<span class="string">&quot;www.runoob.com&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过字典设置参数</span></span><br><span class="line">site = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;菜鸟教程&quot;</span>, <span class="string">&quot;url&quot;</span>: <span class="string">&quot;www.runoob.com&quot;</span>&#125;</span><br><span class="line">print(<span class="string">&quot;网站名：&#123;name&#125;, 地址 &#123;url&#125;&quot;</span>.<span class="built_in">format</span>(**site))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过列表索引设置参数</span></span><br><span class="line">my_list = [<span class="string">&#x27;菜鸟教程&#x27;</span>, <span class="string">&#x27;www.runoob.com&#x27;</span>]</span><br><span class="line">print(<span class="string">&quot;网站名：&#123;0[0]&#125;, 地址 &#123;0[1]&#125;&quot;</span>.<span class="built_in">format</span>(my_list))  <span class="comment"># &quot;0&quot; 是必须的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过对象属性设置参数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AssignValue</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line">my_value = AssignValue(<span class="number">6</span>)</span><br><span class="line">print(<span class="string">&#x27;value 为: &#123;0.value&#125;&#x27;</span>.<span class="built_in">format</span>(my_value))  <span class="comment"># &quot;0&quot; 是可选的</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># format函数基本格式</span></span><br><span class="line">print(<span class="string">&quot;&#123;:.2f&#125;&quot;</span>.<span class="built_in">format</span>(<span class="number">3.1415926</span>))</span><br></pre></td></tr></table></figure>
<p>新增格式指令(基本格式与 1.1.1 中的一样):</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">指令格式</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:left">居中对齐</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:left">左对齐</td>
</tr>
<tr>
<td style="text-align:center">&gt;</td>
<td style="text-align:left">右对齐</td>
</tr>
<tr>
<td style="text-align:center">-</td>
<td style="text-align:left">显示正负号</td>
</tr>
<tr>
<td style="text-align:center">空格</td>
<td style="text-align:left">正数前填充空格</td>
</tr>
<tr>
<td style="text-align:center"><code>&#123;&#123;&#125;&#125;</code></td>
<td style="text-align:left">转义大括号</td>
</tr>
<tr>
<td style="text-align:center">数字</td>
<td style="text-align:left">位宽</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">格式化指令</th>
<th style="text-align:left">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">{:.2f}</td>
<td style="text-align:left">保留小数点后两位</td>
</tr>
<tr>
<td style="text-align:center">{:+.2f}</td>
<td style="text-align:left">带符号保留小数点后两位</td>
</tr>
<tr>
<td style="text-align:center">{:+.2f}</td>
<td style="text-align:left">带符号保留小数点后两位</td>
</tr>
<tr>
<td style="text-align:center">{:.0f}</td>
<td style="text-align:left">不带小数</td>
</tr>
<tr>
<td style="text-align:center">{:0&gt;2d}</td>
<td style="text-align:left">数字补零 (填充左边, 宽度为 2)</td>
</tr>
<tr>
<td style="text-align:center">{:x&lt;4d}</td>
<td style="text-align:left">数字补 x (填充右边, 宽度为 4)</td>
</tr>
<tr>
<td style="text-align:center">{:x&lt;4d}</td>
<td style="text-align:left">数字补 x (填充右边, 宽度为 4)</td>
</tr>
<tr>
<td style="text-align:center">{:,}</td>
<td style="text-align:left">以逗号分隔的数字格式</td>
</tr>
<tr>
<td style="text-align:center">{:.2%}</td>
<td style="text-align:left">百分比格式</td>
</tr>
<tr>
<td style="text-align:center">{:.2e}</td>
<td style="text-align:left">指数记法</td>
</tr>
<tr>
<td style="text-align:center">{:&gt;10d}</td>
<td style="text-align:left">右对齐 (默认, 宽度为 10)</td>
</tr>
<tr>
<td style="text-align:center">{:&lt;10d}</td>
<td style="text-align:left">左对齐 (宽度为 10)</td>
</tr>
<tr>
<td style="text-align:center">{:^10d}</td>
<td style="text-align:left">中间对齐 (宽度为 10)</td>
</tr>
</tbody>
</table>
</div>
<h3 id="1-3-pprint-包"><a href="#1-3-pprint-包" class="headerlink" title="1.3 pprint 包"></a>1.3 pprint 包</h3><p>可以使用 pprint 包美观地打印数据结构</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">pprint.pprint</td>
<td style="text-align:center">美观地打印数据结构</td>
</tr>
<tr>
<td style="text-align:center">pprint.pformat</td>
<td style="text-align:center">获取美观打印的字符串(可以用于写入日志)</td>
</tr>
</tbody>
</table>
</div>
<p>两个函数的完整函数声明:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pprint.pprint(<span class="built_in">object</span>, stream=<span class="literal">None</span>, indent=<span class="number">1</span>, width=<span class="number">80</span>, depth=<span class="literal">None</span>, *, compact=<span class="literal">False</span>, sort_dicts=<span class="literal">True</span>)</span><br><span class="line">pprint.pformat(<span class="built_in">object</span>, indent=<span class="number">1</span>, width=<span class="number">80</span>, depth=<span class="literal">None</span>, *, compact=<span class="literal">False</span>, sort_dicts=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">object</td>
<td style="text-align:center">被打印的对象</td>
</tr>
<tr>
<td style="text-align:center">stream</td>
<td style="text-align:center">打印的流,默认为 sys.stdout</td>
</tr>
<tr>
<td style="text-align:center">width</td>
<td style="text-align:center">打印宽度</td>
</tr>
<tr>
<td style="text-align:center">depth</td>
<td style="text-align:center">打印深度</td>
</tr>
<tr>
<td style="text-align:center">compact</td>
<td style="text-align:center">压缩模式</td>
</tr>
</tbody>
</table>
</div>
<h2 id="2-数据结构"><a href="#2-数据结构" class="headerlink" title="2. 数据结构"></a>2. 数据结构</h2><p><code>list</code>,<code>tuple</code>,<code>set</code>,<code>dict</code>四种数据结构略过</p>
<h3 id="2-1-Enum-枚举类型"><a href="#2-1-Enum-枚举类型" class="headerlink" title="2.1 Enum:枚举类型"></a>2.1 Enum:枚举类型</h3><h4 id="2-1-1-普通枚举类型"><a href="#2-1-1-普通枚举类型" class="headerlink" title="2.1.1 普通枚举类型"></a>2.1.1 普通枚举类型</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> enum</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Status</span>(<span class="params">enum.Enum</span>):</span></span><br><span class="line">    s1 = <span class="number">1</span></span><br><span class="line">    s2 = <span class="number">2</span></span><br><span class="line">    s3 = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<p>枚举在迭代的时候会按照声明的顺序生成,而不是值或名字<br>然后枚举值是无序的,不能比较大小,只能通过<code>==</code>和<code>is</code>运算符比较</p>
<h4 id="2-1-2-整数枚举类型"><a href="#2-1-2-整数枚举类型" class="headerlink" title="2.1.2 整数枚举类型"></a>2.1.2 整数枚举类型</h4><p>通过继承<code>IntEnum</code>,可以使得枚举可以比较大小</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> enum</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Status</span>(<span class="params">enum.IntEnum</span>):</span></span><br><span class="line">    s1 = <span class="number">1</span></span><br><span class="line">    s2 = <span class="number">2</span></span><br><span class="line">    s3 = <span class="number">3</span></span><br></pre></td></tr></table></figure>
<h4 id="2-1-3-唯一枚举"><a href="#2-1-3-唯一枚举" class="headerlink" title="2.1.3 唯一枚举"></a>2.1.3 唯一枚举</h4><p>普通枚举的每个值可以对应多个枚举,可以通过装饰器实现唯一枚举</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> enum</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Status_1</span>(<span class="params">enum.Enum</span>):</span></span><br><span class="line">    s1 = <span class="number">1</span></span><br><span class="line">    s2 = <span class="number">2</span></span><br><span class="line">    s3 = <span class="number">3</span></span><br><span class="line">    sone = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@enum.unique</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Status_1</span>(<span class="params">enum.Enum</span>):</span></span><br><span class="line">    s1 = <span class="number">1</span></span><br><span class="line">    s2 = <span class="number">2</span></span><br><span class="line">    s3 = <span class="number">3</span></span><br><span class="line">    <span class="comment"># 此时这个枚举值会引发错误</span></span><br><span class="line">    sone = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-ChainMap-连锁字典"><a href="#2-2-ChainMap-连锁字典" class="headerlink" title="2.2 ChainMap:连锁字典"></a>2.2 ChainMap:连锁字典</h3><p>连锁字典是一个扩展的字典,可以把多个字典串联起来</p>
<ul>
<li>连锁字典不会创建组成其字典的拷贝,而是直接引用(更改会作用到原字典上)</li>
<li>连锁字典在搜索的时候会从第一个字典开始依次搜索所有字典,直到找到一个值</li>
<li>连锁字典的更改只会作用到第一个字典上(无论是修改还是增加)</li>
<li>可以根据原有的连锁字典创建新层或删除旧层</li>
</ul>
<p><strong>_总之,ChainMap 可以把字典像栈一样组织起来_</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> ChainMap</span><br><span class="line"></span><br><span class="line">dict_a = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;C&#x27;</span>&#125;</span><br><span class="line">dict_b = &#123;<span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;D&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个连锁字典</span></span><br><span class="line">m = ChainMap(dict_a, dict_b)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 搜索字典 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;key=value&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> m.items():</span><br><span class="line">    print(<span class="string">&#x27;&#123;:^3&#125;=&#123;:^3&#125;&#x27;</span>.<span class="built_in">format</span>(k, v))</span><br><span class="line"></span><br><span class="line"><span class="comment"># key=value</span></span><br><span class="line"><span class="comment">#  b = B</span></span><br><span class="line"><span class="comment">#  c = C</span></span><br><span class="line"><span class="comment">#  a = A</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 修改字典 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">m[<span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;AAA&#x27;</span></span><br><span class="line">m[<span class="string">&#x27;e&#x27;</span>] = <span class="string">&#x27;EEE&#x27;</span></span><br><span class="line">print(dict_a)</span><br><span class="line"></span><br><span class="line"><span class="comment"># &#123;&#x27;a&#x27;: &#x27;AAA&#x27;, &#x27;c&#x27;: &#x27;C&#x27;, &#x27;e&#x27;: &#x27;EEE&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 创建新层 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">dict_c = &#123;<span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;FFF&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加一个新层</span></span><br><span class="line">child_m_1 = m.new_child()</span><br><span class="line"><span class="comment"># 添加一个已有层</span></span><br><span class="line">child_m_2 = m.new_child(dict_c)</span><br><span class="line"></span><br><span class="line">print(child_m_1)</span><br><span class="line">print(child_m_2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ChainMap(&#123;&#125;, &#123;&#x27;a&#x27;: &#x27;AAA&#x27;, &#x27;c&#x27;: &#x27;C&#x27;, &#x27;e&#x27;: &#x27;EEE&#x27;&#125;, &#123;&#x27;b&#x27;: &#x27;B&#x27;, &#x27;c&#x27;: &#x27;D&#x27;&#125;)</span></span><br><span class="line"><span class="comment"># ChainMap(&#123;&#x27;f&#x27;: &#x27;FFF&#x27;&#125;, &#123;&#x27;a&#x27;: &#x27;AAA&#x27;, &#x27;c&#x27;: &#x27;C&#x27;, &#x27;e&#x27;: &#x27;EEE&#x27;&#125;, &#123;&#x27;b&#x27;: &#x27;B&#x27;, &#x27;c&#x27;: &#x27;D&#x27;&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 删除旧层 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">parent_m = m.parents</span><br><span class="line">print(m)</span><br><span class="line">print(parent_m)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ChainMap(&#123;&#x27;a&#x27;: &#x27;AAA&#x27;, &#x27;c&#x27;: &#x27;C&#x27;, &#x27;e&#x27;: &#x27;EEE&#x27;&#125;, &#123;&#x27;b&#x27;: &#x27;B&#x27;, &#x27;c&#x27;: &#x27;D&#x27;&#125;)</span></span><br><span class="line"><span class="comment"># ChainMap(&#123;&#x27;b&#x27;: &#x27;B&#x27;, &#x27;c&#x27;: &#x27;D&#x27;&#125;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-3-Counter-计数器"><a href="#2-3-Counter-计数器" class="headerlink" title="2.3 Counter:计数器"></a>2.3 Counter:计数器</h3><p>Counter 是一个对可迭代对象的元素进行计数的类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 初始化 ---------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># c = Counter()</span></span><br><span class="line"><span class="comment"># c = Counter(&#x27;gallahad&#x27;)</span></span><br><span class="line"><span class="comment"># c = Counter(&#123;&#x27;red&#x27;: 4, &#x27;blue&#x27;: 2&#125;)</span></span><br><span class="line"><span class="comment"># c = Counter(cats=4, dogs=8)</span></span><br><span class="line">c = Counter(<span class="string">&#x27;abbccc&#x27;</span>)</span><br><span class="line">print(c)</span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;c&#x27;: 3, &#x27;b&#x27;: 2, &#x27;a&#x27;: 1&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 更新值 ---------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">c.update(<span class="string">&#x27;deefff&#x27;</span>)</span><br><span class="line">print(c)</span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;c&#x27;: 3, &#x27;f&#x27;: 3, &#x27;b&#x27;: 2, &#x27;e&#x27;: 2, &#x27;a&#x27;: 1, &#x27;d&#x27;: 1&#125;)</span></span><br><span class="line"></span><br><span class="line">c.update(<span class="string">&#x27;aab&#x27;</span>)</span><br><span class="line">print(c)</span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;a&#x27;: 3, &#x27;b&#x27;: 3, &#x27;c&#x27;: 3, &#x27;f&#x27;: 3, &#x27;e&#x27;: 2, &#x27;d&#x27;: 1&#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 访问值 ---------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">print(c[<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> c.elements():</span><br><span class="line">    print(<span class="string">&#x27;&#123;&#125;=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(k, c[k]))</span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># a=3</span></span><br><span class="line"><span class="comment"># a=3</span></span><br><span class="line"><span class="comment"># a=3</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 复杂操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">c_1 = Counter(<span class="string">&#x27;aaabbc&#x27;</span>)</span><br><span class="line">c_2 = Counter(<span class="string">&#x27;bccddd&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(c_1+c_2)</span><br><span class="line">print(c_1-c_2)</span><br><span class="line">print(c_1 &amp; c_2)</span><br><span class="line">print(c_1 | c_2)</span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;a&#x27;: 3, &#x27;b&#x27;: 3, &#x27;c&#x27;: 3, &#x27;d&#x27;: 3&#125;)</span></span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;a&#x27;: 3, &#x27;b&#x27;: 1&#125;)</span></span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;b&#x27;: 1, &#x27;c&#x27;: 1&#125;)</span></span><br><span class="line"><span class="comment"># Counter(&#123;&#x27;a&#x27;: 3, &#x27;d&#x27;: 3, &#x27;b&#x27;: 2, &#x27;c&#x27;: 2&#125;)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="2-4-defaultdict-缺省值字典"><a href="#2-4-defaultdict-缺省值字典" class="headerlink" title="2.4 defaultdict:缺省值字典"></a>2.4 defaultdict:缺省值字典</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 示例 1 ---------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">s = [(<span class="string">&#x27;yellow&#x27;</span>, <span class="number">1</span>), (<span class="string">&#x27;blue&#x27;</span>, <span class="number">2</span>), (<span class="string">&#x27;yellow&#x27;</span>, <span class="number">3</span>), (<span class="string">&#x27;blue&#x27;</span>, <span class="number">4</span>), (<span class="string">&#x27;red&#x27;</span>, <span class="number">1</span>)]</span><br><span class="line">d = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> s:</span><br><span class="line">    d[k].append(v)</span><br><span class="line"></span><br><span class="line">print(d.items())</span><br><span class="line"><span class="comment"># dict_items([(&#x27;yellow&#x27;, [1, 3]), (&#x27;blue&#x27;, [2, 4]), (&#x27;red&#x27;, [1])])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 示例 2 ---------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">constant_factory</span>(<span class="params">value</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">lambda</span>: value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = defaultdict(constant_factory(<span class="string">&#x27;&lt;missing&gt;&#x27;</span>))</span><br><span class="line">d.update(name=<span class="string">&#x27;John&#x27;</span>, action=<span class="string">&#x27;ran&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;%(name)s %(action)s to %(object)s&#x27;</span> % d)</span><br><span class="line">print(<span class="string">&#x27;&#123;name&#125; &#123;action&#125; to &#123;object&#125;&#x27;</span>.<span class="built_in">format</span>(**d))</span><br><span class="line"><span class="comment"># John ran to &lt;missing&gt;</span></span><br><span class="line"><span class="comment"># John ran to &lt;missing&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-5-deque-双向队列"><a href="#2-5-deque-双向队列" class="headerlink" title="2.5 deque:双向队列"></a>2.5 deque:双向队列</h3><p>即是可以双向操作的队列(其实也可以进行随机操作)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以指定最大长度</span></span><br><span class="line">d = deque(<span class="string">&#x27;aaabbc&#x27;</span>,maxlen=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 两端操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">d.extend(<span class="string">&#x27;r1&#x27;</span>)</span><br><span class="line">d.append(<span class="string">&#x27;r2&#x27;</span>)</span><br><span class="line">d.extendleft(<span class="string">&#x27;l1&#x27;</span>)</span><br><span class="line">d.appendleft(<span class="string">&#x27;l2&#x27;</span>)</span><br><span class="line">print(d)</span><br><span class="line"><span class="comment"># deque([&#x27;l2&#x27;, &#x27;1&#x27;, &#x27;l&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;r&#x27;, &#x27;1&#x27;, &#x27;r2&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 随机操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">print(d[<span class="number">3</span>])</span><br><span class="line">d.insert(<span class="number">3</span>,<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">print(d[<span class="number">3</span>])</span><br><span class="line">d.remove(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">print(d[<span class="number">3</span>])</span><br><span class="line"><span class="comment"># a</span></span><br><span class="line"><span class="comment"># x</span></span><br><span class="line"><span class="comment"># a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 消费操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># 这些操作是线程安全的</span></span><br><span class="line"></span><br><span class="line">t = <span class="literal">None</span></span><br><span class="line">print(t,d)</span><br><span class="line">t = d.pop()</span><br><span class="line">print(t,d)</span><br><span class="line">t = d.popleft()</span><br><span class="line">print(t,d)</span><br><span class="line"><span class="comment"># None deque([&#x27;l2&#x27;, &#x27;1&#x27;, &#x27;l&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;r&#x27;, &#x27;1&#x27;, &#x27;r2&#x27;])</span></span><br><span class="line"><span class="comment"># r2   deque([&#x27;l2&#x27;, &#x27;1&#x27;, &#x27;l&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;r&#x27;, &#x27;1&#x27;])</span></span><br><span class="line"><span class="comment"># l2   deque([&#x27;1&#x27;, &#x27;l&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;r&#x27;, &#x27;1&#x27;])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 旋转操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">print(d)</span><br><span class="line">d.rotate(<span class="number">2</span>)</span><br><span class="line">print(d)</span><br><span class="line">d.rotate(-<span class="number">2</span>)</span><br><span class="line">print(d)</span><br><span class="line"><span class="comment"># deque([&#x27;1&#x27;, &#x27;l&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;r&#x27;, &#x27;1&#x27;])</span></span><br><span class="line"><span class="comment"># deque([&#x27;r&#x27;, &#x27;1&#x27;, &#x27;1&#x27;, &#x27;l&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;])</span></span><br><span class="line"><span class="comment"># deque([&#x27;1&#x27;, &#x27;l&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;r&#x27;, &#x27;1&#x27;])</span></span><br></pre></td></tr></table></figure>
<h3 id="2-6-namedtuple-具名元组"><a href="#2-6-namedtuple-具名元组" class="headerlink" title="2.6 namedtuple:具名元组"></a>2.6 namedtuple:具名元组</h3><p>简而言之,namedtuple 可以用作快速定义简单的结构体</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="comment"># Person = namedtuple(&#x27;Person&#x27;,&#x27;name age&#x27;)</span></span><br><span class="line">Person = namedtuple(<span class="string">&#x27;Person&#x27;</span>, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bob = Person(<span class="string">&#x27;Bob&#x27;</span>, <span class="number">30</span>)</span><br><span class="line">jane = Person(<span class="string">&#x27;Jane&#x27;</span>, age=<span class="number">29</span>)</span><br><span class="line">print(bob.name)</span><br><span class="line"><span class="comment"># Bob</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> name, age <span class="keyword">in</span> [bob, jane]:</span><br><span class="line">    print(<span class="string">&#x27;&#123;&#125; is &#123;&#125; years old&#x27;</span>.<span class="built_in">format</span>(name, age))</span><br><span class="line"><span class="comment"># Bob is 30 years old</span></span><br><span class="line"><span class="comment"># Jane is 29 years old</span></span><br></pre></td></tr></table></figure>
<h3 id="2-7-OrderedDict-有序字典"><a href="#2-7-OrderedDict-有序字典" class="headerlink" title="2.7 OrderedDict:有序字典"></a>2.7 OrderedDict:有序字典</h3><ul>
<li>首先 OrderedDict 会记住键值对插入的顺序(更新键值对不会改变顺序)</li>
<li>然后再进行相等性比较的时候,OrderedDict 会额外对比插入顺序(在键值对相等的基础上)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">d = OrderedDict()</span><br><span class="line">d[<span class="string">&#x27;a&#x27;</span>] = <span class="string">&#x27;A&#x27;</span></span><br><span class="line">d[<span class="string">&#x27;b&#x27;</span>] = <span class="string">&#x27;B&#x27;</span></span><br><span class="line">d[<span class="string">&#x27;c&#x27;</span>] = <span class="string">&#x27;C&#x27;</span></span><br><span class="line">d[<span class="string">&#x27;d&#x27;</span>] = <span class="string">&#x27;D&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> d.items():</span><br><span class="line">    print(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(k,v))</span><br><span class="line"><span class="comment"># a:A</span></span><br><span class="line"><span class="comment"># b:B</span></span><br><span class="line"><span class="comment"># c:C</span></span><br><span class="line"><span class="comment"># d:D</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 更新键值对 ------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">d[<span class="string">&#x27;c&#x27;</span>] = <span class="string">&#x27;T&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> d.items():</span><br><span class="line">    print(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(k,v))</span><br><span class="line"><span class="comment"># a:A</span></span><br><span class="line"><span class="comment"># b:B</span></span><br><span class="line"><span class="comment"># c:T</span></span><br><span class="line"><span class="comment"># d:D</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 重排操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line">d.move_to_end(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> d.items():</span><br><span class="line">    print(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(k,v))</span><br><span class="line"><span class="comment"># a:A</span></span><br><span class="line"><span class="comment"># b:B</span></span><br><span class="line"><span class="comment"># d:D</span></span><br><span class="line"><span class="comment"># c:T</span></span><br></pre></td></tr></table></figure>
<h3 id="2-8-array-数组"><a href="#2-8-array-数组" class="headerlink" title="2.8 array:数组"></a>2.8 array:数组</h3><p>可以把 array 看作只能存储一种数据类型的 list</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">代码</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">最低大小</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">b</td>
<td style="text-align:center">int</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">B</td>
<td style="text-align:center">int</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">h</td>
<td style="text-align:center">signed short</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">H</td>
<td style="text-align:center">unsigned short</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">i</td>
<td style="text-align:center">signed int</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">I</td>
<td style="text-align:center">unsigned int</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">l</td>
<td style="text-align:center">signed long</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">L</td>
<td style="text-align:center">unsigned long</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">q</td>
<td style="text-align:center">signed long long</td>
<td style="text-align:center">8</td>
</tr>
<tr>
<td style="text-align:center">Q</td>
<td style="text-align:center">unsigned long long</td>
<td style="text-align:center">8</td>
</tr>
<tr>
<td style="text-align:center">f</td>
<td style="text-align:center">float</td>
<td style="text-align:center">4</td>
</tr>
<tr>
<td style="text-align:center">d</td>
<td style="text-align:center">double</td>
<td style="text-align:center">8</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">from</span> array <span class="keyword">import</span> array</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 基本用法 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">s = <span class="string">b&#x27;this is the array&#x27;</span></span><br><span class="line">a = array(<span class="string">&#x27;b&#x27;</span>, s)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&#x27;as byte string:&#x27;</span>, s)</span><br><span class="line">print(<span class="string">&#x27;as array      :&#x27;</span>, a)</span><br><span class="line">print(<span class="string">&#x27;as hex        :&#x27;</span>, binascii.hexlify(a))</span><br><span class="line"><span class="comment"># as byte string: b&#x27;this is the array&#x27;</span></span><br><span class="line"><span class="comment"># as array      : array(&#x27;b&#x27;, [116, 104, 105, 115, 32, 105, 115, 32, 116, 104, 101, 32, 97, 114, 114, 97, 121])</span></span><br><span class="line"><span class="comment"># as hex        : b&#x27;7468697320697320746865206172726179&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 修改方法 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">a = array(<span class="string">&#x27;i&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">a.append(<span class="number">6</span>)</span><br><span class="line">a.extend([<span class="number">777</span>, <span class="number">888</span>])</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># array(&#x27;i&#x27;, [1, 2, 3])</span></span><br><span class="line"><span class="comment"># array(&#x27;i&#x27;, [1, 2, 3, 6, 777, 888])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 文件操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">a = array(<span class="string">&#x27;i&#x27;</span>, <span class="built_in">range</span>(<span class="number">7</span>))</span><br><span class="line">output = tempfile.NamedTemporaryFile()</span><br><span class="line">print(a)</span><br><span class="line"><span class="comment"># array(&#x27;i&#x27;, [0, 1, 2, 3, 4, 5, 6])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入文件</span></span><br><span class="line">a.tofile(output.file)</span><br><span class="line">output.flush()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(output.name, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> <span class="built_in">input</span>:</span><br><span class="line">    raw_data = <span class="built_in">input</span>.read()</span><br><span class="line">    print(binascii.hexlify(raw_data))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">input</span>.seek(<span class="number">0</span>)</span><br><span class="line">    b = array(<span class="string">&#x27;i&#x27;</span>)</span><br><span class="line">    b.fromfile(<span class="built_in">input</span>, <span class="built_in">len</span>(a))</span><br><span class="line">    print(b)</span><br><span class="line"><span class="comment"># array(&#x27;i&#x27;, [0, 1, 2, 3, 4, 5, 6])</span></span><br></pre></td></tr></table></figure>
<h3 id="2-9-heapq-堆排序算法"><a href="#2-9-heapq-堆排序算法" class="headerlink" title="2.9 heapq:堆排序算法"></a>2.9 heapq:堆排序算法</h3><p>heapq 实现了一个最小堆</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_tree</span>(<span class="params">tree, total_width=<span class="number">36</span>, fill=<span class="string">&#x27; &#x27;</span></span>):</span></span><br><span class="line">    output = StringIO()</span><br><span class="line">    last_row = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i, n <span class="keyword">in</span> <span class="built_in">enumerate</span>(tree):</span><br><span class="line">        <span class="keyword">if</span> i:</span><br><span class="line">            <span class="comment"># 堆是完全二叉树,根据节点下标计算层数</span></span><br><span class="line">            row = <span class="built_in">int</span>(math.floor(math.log(i+<span class="number">1</span>, <span class="number">2</span>)))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            row = <span class="number">0</span></span><br><span class="line">        <span class="comment"># 进入下一行</span></span><br><span class="line">        <span class="keyword">if</span> row != last_row:</span><br><span class="line">            output.write(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="comment"># 计算当前行节点数和单个节点宽度</span></span><br><span class="line">        collumns = <span class="number">2</span>**row</span><br><span class="line">        col_width = <span class="built_in">int</span>(math.floor(total_width / collumns))</span><br><span class="line">        <span class="comment"># 居中显示</span></span><br><span class="line">        output.write(<span class="built_in">str</span>(n).center(col_width, fill))</span><br><span class="line">        last_row = row</span><br><span class="line">    print(output.getvalue())</span><br><span class="line">    print(<span class="string">&#x27;-&#x27;</span> * total_width)</span><br><span class="line">    print()</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 堆插入操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = [<span class="number">19</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">11</span>]</span><br><span class="line">heap = []</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> data:</span><br><span class="line">    print(<span class="string">&#x27;add &#123;:&gt;3&#125;:&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">    <span class="comment"># 每次插入一个值,都会触发小顶堆重新排序</span></span><br><span class="line">    heapq.heappush(heap, n)</span><br><span class="line">    show_tree(heap)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 堆重排操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把整个无序的堆排序</span></span><br><span class="line">heapq.heapify(data)</span><br><span class="line">show_tree(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 堆访问操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回最小值</span></span><br><span class="line">top = heapq.heappop(data)</span><br><span class="line">print(top)</span><br><span class="line">show_tree(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 堆修改操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回最小值,并插入一个值</span></span><br><span class="line">top = heapq.heapreplace(data, <span class="number">99</span>)</span><br><span class="line">print(top)</span><br><span class="line">show_tree(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 堆查询操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">print(heapq.nlargest(<span class="number">2</span>, data))</span><br><span class="line">print(heapq.nsmallest(<span class="number">2</span>, data))</span><br><span class="line"><span class="comment"># [99, 19]</span></span><br><span class="line"><span class="comment"># [10, 11]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 堆合并操作 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># 把几个已经有序的堆合并成一个堆</span></span><br><span class="line"></span><br><span class="line">data = [</span><br><span class="line">    [<span class="number">33</span>, <span class="number">55</span>, <span class="number">77</span>, <span class="number">99</span>, <span class="number">44</span>],</span><br><span class="line">    [<span class="number">66</span>, <span class="number">45</span>, <span class="number">78</span>, <span class="number">24</span>, <span class="number">68</span>],</span><br><span class="line">    [<span class="number">95</span>, <span class="number">47</span>, <span class="number">85</span>, <span class="number">31</span>, <span class="number">41</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> data:</span><br><span class="line">    heapq.heapify(l)</span><br><span class="line"></span><br><span class="line">print(data)</span><br><span class="line"><span class="comment"># [[33, 44, 77, 99, 55],</span></span><br><span class="line"><span class="comment">#  [24, 45, 78, 66, 68],</span></span><br><span class="line"><span class="comment">#  [31, 41, 85, 47, 95]]</span></span><br><span class="line"></span><br><span class="line">heap = heapq.merge(*data)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> heap:</span><br><span class="line">    print(i, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="comment"># 24 31 33 41 44 45 77 78 66 68 85 47 95 99 55</span></span><br></pre></td></tr></table></figure>
<h3 id="2-10-bisect-有序列表算法"><a href="#2-10-bisect-有序列表算法" class="headerlink" title="2.10 bisect:有序列表算法"></a>2.10 bisect:有序列表算法</h3><p>bisect 提供了基于二分法的有序列表查找和插入<br>其分别提供了两个方法来进行查找插入位置和插入(默认升序):</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">biset_left</td>
<td style="text-align:center">查找最左的适合插入的位置</td>
</tr>
<tr>
<td style="text-align:center">biset_right</td>
<td style="text-align:center">查找最右的适合插入的位置</td>
</tr>
<tr>
<td style="text-align:center">biset</td>
<td style="text-align:center">同 biset_right</td>
</tr>
<tr>
<td style="text-align:center">insort_left</td>
<td style="text-align:center">在最左合适位置插入</td>
</tr>
<tr>
<td style="text-align:center">insort_right</td>
<td style="text-align:center">在最右合适位置插入</td>
</tr>
<tr>
<td style="text-align:center">insort</td>
<td style="text-align:center">同 insort_right</td>
</tr>
</tbody>
</table>
</div>
<p>可以用这几个方法组合出一些自定义的工具</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bisect <span class="keyword">import</span> bisect_left, bisect_right</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">a, x</span>):</span></span><br><span class="line">    <span class="string">&#x27;Locate the leftmost value exactly equal to x&#x27;</span></span><br><span class="line">    i = bisect_left(a, x)</span><br><span class="line">    <span class="keyword">if</span> i != <span class="built_in">len</span>(a) <span class="keyword">and</span> a[i] == x:</span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_lt</span>(<span class="params">a, x</span>):</span></span><br><span class="line">    <span class="string">&#x27;Find rightmost value less than x&#x27;</span></span><br><span class="line">    i = bisect_left(a, x)</span><br><span class="line">    <span class="keyword">if</span> i:</span><br><span class="line">        <span class="keyword">return</span> a[i-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_le</span>(<span class="params">a, x</span>):</span></span><br><span class="line">    <span class="string">&#x27;Find rightmost value less than or equal to x&#x27;</span></span><br><span class="line">    i = bisect_right(a, x)</span><br><span class="line">    <span class="keyword">if</span> i:</span><br><span class="line">        <span class="keyword">return</span> a[i-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_gt</span>(<span class="params">a, x</span>):</span></span><br><span class="line">    <span class="string">&#x27;Find leftmost value greater than x&#x27;</span></span><br><span class="line">    i = bisect_right(a, x)</span><br><span class="line">    <span class="keyword">if</span> i != <span class="built_in">len</span>(a):</span><br><span class="line">        <span class="keyword">return</span> a[i]</span><br><span class="line">    <span class="keyword">raise</span> ValueError</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_ge</span>(<span class="params">a, x</span>):</span></span><br><span class="line">    <span class="string">&#x27;Find leftmost item greater than or equal to x&#x27;</span></span><br><span class="line">    i = bisect_left(a, x)</span><br><span class="line">    <span class="keyword">if</span> i != <span class="built_in">len</span>(a):</span><br><span class="line">        <span class="keyword">return</span> a[i]</span><br><span class="line">    <span class="keyword">raise</span> ValueErrors</span><br></pre></td></tr></table></figure>
<h3 id="2-11-queue-线程安全队列"><a href="#2-11-queue-线程安全队列" class="headerlink" title="2.11 queue:线程安全队列"></a>2.11 queue:线程安全队列</h3><p>queue 一共提供了三个队列:</p>
<ul>
<li>Queue:普通的 FIFO 队列</li>
<li>LifoQueue:FILO 队列(栈,略)</li>
<li>PriorityQueue:优先队列</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 普通队列 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以设置最大值,设置为0则为无限</span></span><br><span class="line">q = queue.Queue(maxsize=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    <span class="comment"># 如果达到上限,则会阻塞,直到有线程消耗了一个对象</span></span><br><span class="line">    q.put(i,block=<span class="literal">False</span>,timeout=<span class="literal">None</span>)</span><br><span class="line">    <span class="comment"># q.put_nowait(i)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">    <span class="comment"># 如果为空,则会阻塞,直到有线程插入一个对象</span></span><br><span class="line">    print(q.get(block=<span class="literal">False</span>,timeout=<span class="literal">None</span>),end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="comment"># q.get_nowait()</span></span><br><span class="line"><span class="comment"># 0 1 2 3 4</span></span><br><span class="line"></span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 任务队列 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">q = queue.Queue()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        item = q.get()</span><br><span class="line">        print(<span class="string">f&#x27;Working on <span class="subst">&#123;item&#125;</span>&#x27;</span>)</span><br><span class="line">        print(<span class="string">f&#x27;Finished <span class="subst">&#123;item&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="comment"># 减少一个任务计数</span></span><br><span class="line">        q.task_done()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 worker 线程</span></span><br><span class="line">threading.Thread(target=worker, daemon=<span class="literal">True</span>).start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    <span class="comment"># 增加一个任务计数</span></span><br><span class="line">    q.put(item)</span><br><span class="line">print(<span class="string">&#x27;All task requests sent\n&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 阻塞直到所有任务完成</span></span><br><span class="line">q.join()</span><br><span class="line">print(<span class="string">&#x27;All work completed&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 优先队列 1 ------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass, field</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Any</span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass(<span class="params">order=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrioritizedItem</span>:</span></span><br><span class="line">    priority: <span class="built_in">int</span></span><br><span class="line">    item: Any=field(compare=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">pri = [<span class="number">5</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>]</span><br><span class="line">data = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">q = queue.PriorityQueue()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p,d <span class="keyword">in</span> <span class="built_in">zip</span>(pri,data):</span><br><span class="line">    q.put(PrioritizedItem(p,d))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">    t = q.get()</span><br><span class="line">    print(t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># PrioritizedItem(priority=2, item=5)</span></span><br><span class="line"><span class="comment"># PrioritizedItem(priority=4, item=3)</span></span><br><span class="line"><span class="comment"># PrioritizedItem(priority=5, item=1)</span></span><br><span class="line"><span class="comment"># PrioritizedItem(priority=6, item=4)</span></span><br><span class="line"><span class="comment"># PrioritizedItem(priority=8, item=2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 优先队列 2 ------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="meta">@functools.total_ordering</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrioritizedClass</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,priority,item</span>):</span></span><br><span class="line">        self.priority = priority</span><br><span class="line">        self.item = item</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&#x27;PrioritizedClass(priority=&#123;&#125;, item=&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(self.priority,self.item))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self,other</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span>  self.priority == other.priority</span><br><span class="line">        <span class="keyword">except</span> AttributeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self,other</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span>  self.priority &lt; other.priority</span><br><span class="line">        <span class="keyword">except</span> AttributeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line"></span><br><span class="line">pri = [<span class="number">5</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">2</span>]</span><br><span class="line">data = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">q = queue.PriorityQueue()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p,d <span class="keyword">in</span> <span class="built_in">zip</span>(pri,data):</span><br><span class="line">    q.put(PrioritizedClass(p,d))</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">    t = q.get()</span><br><span class="line">    t.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># PrioritizedClass(priority=2, item=5)</span></span><br><span class="line"><span class="comment"># PrioritizedClass(priority=4, item=3)</span></span><br><span class="line"><span class="comment"># PrioritizedClass(priority=5, item=1)</span></span><br><span class="line"><span class="comment"># PrioritizedClass(priority=6, item=4)</span></span><br><span class="line"><span class="comment"># PrioritizedClass(priority=8, item=2)</span></span><br></pre></td></tr></table></figure>
<h3 id="2-12-copy-复制"><a href="#2-12-copy-复制" class="headerlink" title="2.12 copy:复制"></a>2.12 copy:复制</h3><h4 id="2-12-1-copy-copy-浅复制"><a href="#2-12-1-copy-copy-浅复制" class="headerlink" title="2.12.1 copy.copy:浅复制"></a>2.12.1 copy.copy:浅复制</h4><p>浅复制会创建一个浅副本(shallow copy)<br>浅副本可以看成是一个指向原对象的引用<br>如果建立 list 对象的浅副本,则会创建一个新的 list,其中的元素为原 list 中元素的引用</p>
<h4 id="2-12-2-copy-deepcopy-深复制"><a href="#2-12-2-copy-deepcopy-深复制" class="headerlink" title="2.12.2 copy.deepcopy():深复制"></a>2.12.2 copy.deepcopy():深复制</h4><p>深复制会完全复制一份对象,对于 list,则会把其中的每个对象都复制一份<br>可以通过自定义一个类的<code>__copy__</code>和<code>__deepcopy__</code>方法自定义类的复制行为</p>
<h2 id="3-语言工具"><a href="#3-语言工具" class="headerlink" title="3. 语言工具"></a>3. 语言工具</h2><h3 id="3-1-functools"><a href="#3-1-functools" class="headerlink" title="3.1 functools"></a>3.1 functools</h3><h4 id="3-1-1-functools-partial"><a href="#3-1-1-functools-partial" class="headerlink" title="3.1.1 functools.partial"></a>3.1.1 functools.partial</h4><p>partial 是一个用来固定函数参数的工具</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">a, b, c=<span class="number">4</span></span>):</span></span><br><span class="line">    print(<span class="string">&#x27;called with (&#123;&#125;,&#123;&#125;,&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(a, b, c))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">func(<span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 固定参数 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">func_p = functools.partial(func, <span class="number">9</span>, c=<span class="number">7</span>)</span><br><span class="line">func_p(<span class="number">8</span>)</span><br><span class="line">func_p(<span class="string">&#x27;b&#x27;</span>, c=<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="comment"># called with (9,8,7)</span></span><br><span class="line"><span class="comment"># called with (9,b,c)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># func_p(&#x27;b&#x27;, c=&#x27;c&#x27;,a=&#x27;a&#x27;)</span></span><br><span class="line"><span class="comment"># 重复定义位置参数会引发错误</span></span><br><span class="line"><span class="comment"># TypeError: func() got multiple values for argument &#x27;a&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-2-functools-tool-ordering"><a href="#3-1-2-functools-tool-ordering" class="headerlink" title="3.1.2 functools.tool_ordering"></a>3.1.2 functools.tool_ordering</h4><p>为了使得一个类支持比较,需要实现<code>__lt__(),__le__(),__eq__(),__gt__(),__ge__()</code>方法,tool_ordering 工具提供了一个简略方法,只需要实现<code>__eq__()</code>和另一个比较方法,tool_ordering 会自动生成其他方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@functools.total_ordering</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, lastname, firstname</span>):</span></span><br><span class="line">        self.lastname = lastname</span><br><span class="line">        self.firstname = firstname</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_is_valid_operand</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">hasattr</span>(other, <span class="string">&quot;lastname&quot;</span>) <span class="keyword">and</span></span><br><span class="line">                <span class="built_in">hasattr</span>(other, <span class="string">&quot;firstname&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._is_valid_operand(other):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">        <span class="keyword">return</span> ((self.lastname.lower(), self.firstname.lower()) ==</span><br><span class="line">                (other.lastname.lower(), other.firstname.lower()))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__lt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._is_valid_operand(other):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NotImplemented</span></span><br><span class="line">        <span class="keyword">return</span> ((self.lastname.lower(), self.firstname.lower()) &lt;</span><br><span class="line">                (other.lastname.lower(), other.firstname.lower()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">john = Student(<span class="string">&#x27;john&#x27;</span>, <span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">bob = Student(<span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(john == bob)</span><br><span class="line">print(john &gt; bob)</span><br><span class="line"><span class="comment"># False</span></span><br><span class="line"><span class="comment"># True</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-3-functools-lru-cache"><a href="#3-1-3-functools-lru-cache" class="headerlink" title="3.1.3 functools.lru_cache"></a>3.1.3 functools.lru_cache</h4><p>lru 即 Last Recent Used(最近使用)<br>以装饰器的方式为一个函数添加缓存功能,条件为参数必须可以散列</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认最大缓存为128,不同类型参数放一块儿缓冲</span></span><br><span class="line"><span class="comment"># 要求参数必须可以散列,否则产生一个TypeError</span></span><br><span class="line"><span class="meta">@functools.lru_cache(<span class="params">maxsize=<span class="number">128</span>,<span class="built_in">type</span>=<span class="literal">False</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">expensive</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;expensive(&#123;&#125;,&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(a, b))</span><br><span class="line">    <span class="keyword">return</span> a*b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MAX = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 第一次调用 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(MAX):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(MAX):</span><br><span class="line">        expensive(i, j)</span><br><span class="line">print(expensive.cache_info())</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># expensive(2,0)</span></span><br><span class="line"><span class="comment"># expensive(2,1)</span></span><br><span class="line"><span class="comment"># expensive(2,2)</span></span><br><span class="line"><span class="comment"># CacheInfo(hits=0, misses=9, maxsize=128, currsize=9)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 第二次调用 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(MAX):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(MAX):</span><br><span class="line">        expensive(i, j)</span><br><span class="line">print(expensive.cache_info())</span><br><span class="line"><span class="comment"># CacheInfo(hits=9, misses=9, maxsize=128, currsize=9)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 清空缓存 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">expensive.cache_clear()</span><br><span class="line">print(expensive.cache_info())</span><br><span class="line"><span class="comment"># CacheInfo(hits=0, misses=0, maxsize=128, currsize=0)</span></span><br></pre></td></tr></table></figure>
<h4 id="3-1-4-functools-reduce"><a href="#3-1-4-functools-reduce" class="headerlink" title="3.1.4 functools.reduce"></a>3.1.4 functools.reduce</h4><p>reduce 可以依次处理可迭代对象中的每个元素<br>如果既没有初始值,可迭代对象也为空,则会引发 TypeError</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_reduce</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    print(<span class="string">&#x27;do_reduce(&#123;&#125;,&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(a,b))</span><br><span class="line">    <span class="keyword">return</span> a+b</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">range</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># ------------------- 无初始值调用 ------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">result = functools.reduce(do_reduce,data)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># do_reduce(0,1)</span></span><br><span class="line"><span class="comment"># do_reduce(1,2)</span></span><br><span class="line"><span class="comment"># do_reduce(3,3)</span></span><br><span class="line"><span class="comment"># do_reduce(6,4)</span></span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># ------------------- 有初始值调用 ------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line">result = functools.reduce(do_reduce,data,<span class="number">10</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># do_reduce(10,0)</span></span><br><span class="line"><span class="comment"># do_reduce(10,1)</span></span><br><span class="line"><span class="comment"># do_reduce(11,2)</span></span><br><span class="line"><span class="comment"># do_reduce(13,3)</span></span><br><span class="line"><span class="comment"># do_reduce(16,4)</span></span><br><span class="line"><span class="comment"># 20</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-itertools"><a href="#3-2-itertools" class="headerlink" title="3.2 itertools"></a>3.2 itertools</h3><h4 id="3-2-1-合并迭代器"><a href="#3-2-1-合并迭代器" class="headerlink" title="3.2.1 合并迭代器"></a>3.2.1 合并迭代器</h4><h5 id="3-2-1-1-串行合并"><a href="#3-2-1-1-串行合并" class="headerlink" title="3.2.1.1 串行合并"></a>3.2.1.1 串行合并</h5><p>itertools.chain 能把多个可迭代对象串行连接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">a=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">b=[<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">temp = [a,b]</span><br><span class="line"></span><br><span class="line">c=itertools.chain(a,b)</span><br><span class="line">print(<span class="built_in">list</span>(c))</span><br><span class="line">c=itertools.chain(*temp)</span><br><span class="line">print(<span class="built_in">list</span>(c))</span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5, 6]</span></span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>
<h5 id="3-2-1-2-并行合并"><a href="#3-2-1-2-并行合并" class="headerlink" title="3.2.1.2 并行合并"></a>3.2.1.2 并行合并</h5><p>内置的 zip 函数可以把多个可迭代对象并行连接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">zip</span>(a, b)</span><br><span class="line">print(<span class="built_in">list</span>(c))</span><br><span class="line">c = itertools.zip_longest(a, b)</span><br><span class="line">print(<span class="built_in">list</span>(c))</span><br><span class="line"><span class="comment"># [(1, 4), (2, 5), (3, 6)]</span></span><br><span class="line"><span class="comment"># [(1, 4), (2, 5), (3, 6), (None, 7)]</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-2-转换输入"><a href="#3-2-2-转换输入" class="headerlink" title="3.2.2 转换输入"></a>3.2.2 转换输入</h4><p>map 可以完成一个从多个集合到一个集合的映射</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">range</span>(<span class="number">5</span>)</span><br><span class="line">b = <span class="built_in">range</span>(<span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">c = <span class="built_in">range</span>(<span class="number">10</span>, <span class="number">15</span>)</span><br><span class="line">d = <span class="built_in">range</span>(<span class="number">15</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a, b, c, d</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (a, b, c, d, a+b+c+d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">map</span>(add, a, b, c, d):</span><br><span class="line">    print(<span class="string">&#x27;&#123;&#125;+&#123;&#125;+&#123;&#125;+&#123;&#125;=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(*i))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0+5+10+15=30</span></span><br><span class="line"><span class="comment"># 1+6+11+16=34</span></span><br><span class="line"><span class="comment"># 2+7+12+17=38</span></span><br><span class="line"><span class="comment"># 3+8+13+18=42</span></span><br><span class="line"><span class="comment"># 4+9+14+19=46</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-3-循环重复"><a href="#3-2-3-循环重复" class="headerlink" title="3.2.3 循环重复"></a>3.2.3 循环重复</h4><p>itertools.cycle 可以不断循环一个迭代器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">a = <span class="built_in">range</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">list</span>(<span class="built_in">zip</span>(<span class="built_in">range</span>(<span class="number">13</span>),</span><br><span class="line">               itertools.cycle(a))))</span><br><span class="line"><span class="comment"># [(0, 0), (1, 1), (2, 2), (3, 3), (4, 4), (5, 0), (6, 1), (7, 2), (8, 3), (9, 4), (10, 0), (11, 1), (12, 2)]</span></span><br></pre></td></tr></table></figure>
<p>itertools.repeat 可以不断重复一个值(略)<br>等同于 cycle([p])</p>
<h4 id="3-2-4-过滤"><a href="#3-2-4-过滤" class="headerlink" title="3.2.4 过滤"></a>3.2.4 过滤</h4><p>itertools.takewhile 返回<strong>不满足条件之前</strong>的所有内容<br>itertools.dropwhile 返回<strong>不满足条件元素之后(包括本身)</strong>的所有内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">list</span>(</span><br><span class="line">    itertools.takewhile(</span><br><span class="line">        <span class="keyword">lambda</span> x: x &lt; <span class="number">3</span>,</span><br><span class="line">        a</span><br><span class="line">    )</span><br><span class="line">))</span><br><span class="line">print(<span class="built_in">list</span>(</span><br><span class="line">    itertools.dropwhile(</span><br><span class="line">        <span class="keyword">lambda</span> x: x &lt; <span class="number">3</span>,</span><br><span class="line">        a</span><br><span class="line">    )</span><br><span class="line">))</span><br><span class="line"><span class="comment"># [1, 2]</span></span><br><span class="line"><span class="comment"># [3, 4, 3, 2, 1]</span></span><br></pre></td></tr></table></figure>
<p>filter 返回所有满足条件的内容<br>itertools.filterfalse 返回所有不满足条件的内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">list</span>(</span><br><span class="line">    <span class="built_in">filter</span>(</span><br><span class="line">        <span class="keyword">lambda</span> x: x &lt; <span class="number">3</span>,</span><br><span class="line">        a</span><br><span class="line">    )</span><br><span class="line">))</span><br><span class="line">print(<span class="built_in">list</span>(</span><br><span class="line">    itertools.filterfalse(</span><br><span class="line">        <span class="keyword">lambda</span> x: x &lt; <span class="number">3</span>,</span><br><span class="line">        a</span><br><span class="line">    )</span><br><span class="line">))</span><br><span class="line"><span class="comment"># [1, 2, 2, 1]</span></span><br><span class="line"><span class="comment"># [3, 4, 3]</span></span><br></pre></td></tr></table></figure>
<p>itertools.compress 根据选择器中的元素决定是否过滤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line">data = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">selectors = itertools.cycle([<span class="literal">True</span>, <span class="literal">False</span>])</span><br><span class="line"></span><br><span class="line">print(<span class="built_in">list</span>(</span><br><span class="line">    itertools.compress(</span><br><span class="line">        data,</span><br><span class="line">        selectors</span><br><span class="line">    )</span><br><span class="line">))</span><br><span class="line"><span class="comment"># [1, 3, 3, 1]</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-5-分组"><a href="#3-2-5-分组" class="headerlink" title="3.2.5 分组"></a>3.2.5 分组</h4><p>itertools.groupby 可以对一个可迭代对象根据一定条件分组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> operator</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@functools.total_ordering</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x, y</span>):</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.y = y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;(&#123;&#125;, &#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(self.x, self.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__eq__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (self.x, self.y) == (other.x, other.y)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__gt__</span>(<span class="params">self, other</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (self.x, self.y) &gt; (other.x, other.y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = <span class="built_in">list</span>(<span class="built_in">map</span>(Point,</span><br><span class="line">                cycle([<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]),</span><br><span class="line">                <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">7</span>))))</span><br><span class="line">print(<span class="string">&#x27;Data:&#x27;</span>)</span><br><span class="line">pprint.pprint(data, width=<span class="number">35</span>)</span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给不排序的数据分组</span></span><br><span class="line">print(<span class="string">&#x27;Grouped, unsorted:&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> k, g <span class="keyword">in</span> groupby(data, operator.attrgetter(<span class="string">&#x27;x&#x27;</span>)):</span><br><span class="line">    print(k, <span class="built_in">list</span>(g))</span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line">data.sort()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 给分组后的数据分组</span></span><br><span class="line">print(<span class="string">&#x27;Grouped, sorted:&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> k, g <span class="keyword">in</span> groupby(data, operator.attrgetter(<span class="string">&#x27;x&#x27;</span>)):</span><br><span class="line">    print(k, <span class="built_in">list</span>(g))</span><br><span class="line">print()</span><br><span class="line"><span class="comment"># Data:</span></span><br><span class="line"><span class="comment"># [(0, 0),</span></span><br><span class="line"><span class="comment">#  (1, 1),</span></span><br><span class="line"><span class="comment">#  (2, 2),</span></span><br><span class="line"><span class="comment">#  (0, 3),</span></span><br><span class="line"><span class="comment">#  (1, 4),</span></span><br><span class="line"><span class="comment">#  (2, 5),</span></span><br><span class="line"><span class="comment">#  (0, 6)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Grouped, unsorted:</span></span><br><span class="line"><span class="comment"># 0 [(0, 0)]</span></span><br><span class="line"><span class="comment"># 1 [(1, 1)]</span></span><br><span class="line"><span class="comment"># 2 [(2, 2)]</span></span><br><span class="line"><span class="comment"># 0 [(0, 3)]</span></span><br><span class="line"><span class="comment"># 1 [(1, 4)]</span></span><br><span class="line"><span class="comment"># 2 [(2, 5)]</span></span><br><span class="line"><span class="comment"># 0 [(0, 6)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Grouped, sorted:</span></span><br><span class="line"><span class="comment"># 0 [(0, 0), (0, 3), (0, 6)]</span></span><br><span class="line"><span class="comment"># 1 [(1, 1), (1, 4)]</span></span><br><span class="line"><span class="comment"># 2 [(2, 2), (2, 5)]</span></span><br></pre></td></tr></table></figure>
<h4 id="3-2-6-组合输入"><a href="#3-2-6-组合输入" class="headerlink" title="3.2.6 组合输入"></a>3.2.6 组合输入</h4><p>itertools.product 可以把获取多个可迭代对象的笛卡尔积</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">SUITS = &#123;<span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;S&#x27;</span>&#125;</span><br><span class="line">FACE = &#123;<span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;A&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">result = itertools.product(SUITS,FACE)</span><br><span class="line">pprint.pprint(<span class="built_in">list</span>(result),width=<span class="number">20</span>)</span><br><span class="line"><span class="comment"># [(&#x27;D&#x27;, &#x27;K&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;D&#x27;, &#x27;Q&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;D&#x27;, &#x27;J&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;D&#x27;, &#x27;A&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;S&#x27;, &#x27;K&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;S&#x27;, &#x27;Q&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;S&#x27;, &#x27;J&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;S&#x27;, &#x27;A&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;C&#x27;, &#x27;K&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;C&#x27;, &#x27;Q&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;C&#x27;, &#x27;J&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;C&#x27;, &#x27;A&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;H&#x27;, &#x27;K&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;H&#x27;, &#x27;Q&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;H&#x27;, &#x27;J&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;H&#x27;, &#x27;A&#x27;)]</span></span><br></pre></td></tr></table></figure>
<p>itertools.permutations 可以把一个可迭代对象中的元素的所有排列</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;abcd&#x27;</span></span><br><span class="line">pprint.pprint(<span class="built_in">list</span>(itertools.permutations(data,<span class="number">3</span>)),</span><br><span class="line">              width=<span class="number">40</span>)</span><br><span class="line"><span class="comment"># [(&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;d&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;a&#x27;, &#x27;c&#x27;, &#x27;b&#x27;),</span></span><br><span class="line"><span class="comment">#  ...</span></span><br><span class="line"><span class="comment">#  (&#x27;d&#x27;, &#x27;b&#x27;, &#x27;c&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;d&#x27;, &#x27;c&#x27;, &#x27;a&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;d&#x27;, &#x27;c&#x27;, &#x27;b&#x27;)]</span></span><br></pre></td></tr></table></figure>
<p>itertools.combinations 可以把一个可迭代对象中的元素的所有组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;abcd&#x27;</span></span><br><span class="line">pprint.pprint(<span class="built_in">list</span>(itertools.combinations(data,<span class="number">3</span>)),</span><br><span class="line">              width=<span class="number">40</span>)</span><br><span class="line"><span class="comment"># [(&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;d&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;a&#x27;, &#x27;c&#x27;, &#x27;d&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;)]</span></span><br></pre></td></tr></table></figure>
<p>itertools.combinations_with_replacement 增加了自己与自己配对</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;abcd&#x27;</span></span><br><span class="line">pprint.pprint(<span class="built_in">list</span>(</span><br><span class="line">    itertools.combinations_with_replacement(data, <span class="number">2</span>)</span><br><span class="line">), width=<span class="number">40</span>)</span><br><span class="line"><span class="comment"># [(&#x27;a&#x27;, &#x27;a&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;a&#x27;, &#x27;b&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;a&#x27;, &#x27;c&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;a&#x27;, &#x27;d&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;b&#x27;, &#x27;b&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;b&#x27;, &#x27;c&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;b&#x27;, &#x27;d&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;c&#x27;, &#x27;c&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;c&#x27;, &#x27;d&#x27;),</span></span><br><span class="line"><span class="comment">#  (&#x27;d&#x27;, &#x27;d&#x27;)]</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-contextlib"><a href="#3-3-contextlib" class="headerlink" title="3.3 contextlib"></a>3.3 contextlib</h3><h4 id="3-3-1-上下文管理器"><a href="#3-3-1-上下文管理器" class="headerlink" title="3.3.1 上下文管理器"></a>3.3.1 上下文管理器</h4><p>上下文管理器即通过 with 关键字进行一些关键资源的自动管理</p>
<p>基本的管理可以通过如下方式定义上下文类完成<br>其中<code>__exit__</code>可以接受一个异常,如果可以处理这个异常,则返回<code>False</code>以阻止异常继续传播,否则返回<code>True</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;__enter__&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self,exc_type,exc_val,exc_tb</span>):</span></span><br><span class="line">        print(<span class="string">&quot;exit&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Context():</span><br><span class="line">    print(<span class="string">&quot;do something&quot;</span>)</span><br><span class="line"><span class="comment"># __init__</span></span><br><span class="line"><span class="comment"># __enter__</span></span><br><span class="line"><span class="comment"># do something</span></span><br><span class="line"><span class="comment"># exit</span></span><br></pre></td></tr></table></figure>
<p>然后可以通过在上下文开启的时候获取一个资源对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Resource</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, descript</span>):</span></span><br><span class="line">        self.descript = descript</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(self.descript)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;__init__&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;__enter__&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> Resource(<span class="string">&quot;a Resource&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        print(<span class="string">&quot;exit&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Context() <span class="keyword">as</span> resource:</span><br><span class="line">    print(<span class="string">&quot;do something&quot;</span>)</span><br><span class="line">    resource.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># __init__</span></span><br><span class="line"><span class="comment"># __enter__</span></span><br><span class="line"><span class="comment"># do something</span></span><br><span class="line"><span class="comment"># a Resource</span></span><br><span class="line"><span class="comment"># exit</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-2-contextlib-ContextDecorator"><a href="#3-3-2-contextlib-ContextDecorator" class="headerlink" title="3.3.2 contextlib.ContextDecorator"></a>3.3.2 contextlib.ContextDecorator</h4><p>接下来是 contextlib 的使用方法和优点<br>首先可以继承其中的装饰器类,用来装饰函数(有点像 Spring 中的面向切片编程 AOP)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>(<span class="params">contextlib.ContextDecorator</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, desc</span>):</span></span><br><span class="line">        print(<span class="string">&quot;context init&quot;</span>)</span><br><span class="line">        self.desc = desc</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;context enter with &#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.desc))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span></span><br><span class="line">        print(<span class="string">&quot;context exit&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Context(<span class="params"><span class="string">&quot;the desc&quot;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    print(<span class="string">&quot;in function&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">func()</span><br><span class="line"><span class="comment"># context init</span></span><br><span class="line"><span class="comment"># context enter with the desc</span></span><br><span class="line"><span class="comment"># in function</span></span><br><span class="line"><span class="comment"># context exit</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-3-contextlib"><a href="#3-3-3-contextlib" class="headerlink" title="3.3.3 contextlib"></a>3.3.3 contextlib</h4><p>然后是使用其中的管理器装饰器对象装饰一个函数<br>简化构造上下文管理器的过程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@contextlib.contextmanager</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_context</span>():</span></span><br><span class="line">    print(<span class="string">&quot;    entering&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">except</span> RuntimeError <span class="keyword">as</span> err:</span><br><span class="line">        print(<span class="string">&quot;    error:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(err))</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        print(<span class="string">&quot;    exiting&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;Nomal:&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> make_context() <span class="keyword">as</span> value:</span><br><span class="line">    print(<span class="string">&quot;    inside with statement:&quot;</span>, value)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;\nhandled error:&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> make_context() <span class="keyword">as</span> value:</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;runtime error example&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;\nunhandled error:&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> make_context() <span class="keyword">as</span> value:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;value error example&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nomal:</span></span><br><span class="line"><span class="comment">#     entering</span></span><br><span class="line"><span class="comment">#     inside with statement: &#123;&#125;</span></span><br><span class="line"><span class="comment">#     exiting</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># handled error:</span></span><br><span class="line"><span class="comment">#     entering</span></span><br><span class="line"><span class="comment">#     error:runtime error example</span></span><br><span class="line"><span class="comment">#     exiting</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># unhandled error:</span></span><br><span class="line"><span class="comment">#     entering</span></span><br><span class="line"><span class="comment">#     exiting</span></span><br><span class="line"><span class="comment"># Traceback (most recent call last):</span></span><br><span class="line"><span class="comment">#   ...</span></span><br><span class="line"><span class="comment">#     raise ValueError(&quot;value error example&quot;)</span></span><br><span class="line"><span class="comment"># ValueError: value error example</span></span><br></pre></td></tr></table></figure>
<h4 id="3-3-4-conntextlib-API"><a href="#3-3-4-conntextlib-API" class="headerlink" title="3.3.4 conntextlib API"></a>3.3.4 conntextlib API</h4><p>有的系统资源关闭的方式比较统一,比如资源关闭 API 很多都是<code>close()</code>方法<br>contextlib 提供了一些 API 来对类似资源进行管理(当然这些资源本身有本身的资源管理器可以用)<br>无论 with 代码块内部是否发生异常,资源都会被安全关闭</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> contextlib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Door</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;open Door&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span>(<span class="params">self</span>):</span></span><br><span class="line">        print(<span class="string">&quot;close door&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> contextlib.closing(Door()) <span class="keyword">as</span> door:</span><br><span class="line">    print(<span class="string">&quot;some code&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="4-日期和时间"><a href="#4-日期和时间" class="headerlink" title="4. 日期和时间"></a>4. 日期和时间</h2><p>python 提供了三个时间相关的模块:</p>
<ul>
<li>time:时间相关</li>
<li>datetime:日期时间相关</li>
<li>calendar:日期的计算与格式化</li>
</ul>
<h3 id="4-1-time"><a href="#4-1-time" class="headerlink" title="4.1 time"></a>4.1 time</h3><h4 id="4-1-1-核心函数"><a href="#4-1-1-核心函数" class="headerlink" title="4.1.1 核心函数"></a>4.1.1 核心函数</h4><p>核心的时间函数有:</p>
<ul>
<li>time():返回以浮点数表示的时间(从 19700101 算起)</li>
<li>ctime():返回时间的格式化表示</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">print(time.time())</span><br><span class="line">print(time.ctime())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 时间运算</span></span><br><span class="line">print(time.ctime(</span><br><span class="line">    time.time() + <span class="number">15</span></span><br><span class="line">))</span><br><span class="line"><span class="comment"># 1613917707.6227214</span></span><br><span class="line"><span class="comment"># Sun Feb 21 22:28:27 2021</span></span><br><span class="line"><span class="comment"># Sun Feb 21 22:28:42 2021</span></span><br></pre></td></tr></table></figure>
<h4 id="4-1-2-其他函数"><a href="#4-1-2-其他函数" class="headerlink" title="4.1.2 其他函数"></a>4.1.2 其他函数</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">time.monotonic</td>
<td style="text-align:center">单调时钟</td>
</tr>
<tr>
<td style="text-align:left">time.clock</td>
<td style="text-align:center">处理器时钟</td>
</tr>
<tr>
<td style="text-align:left">time.gmtime</td>
<td style="text-align:center">以 UTC 格式返回时间结构体</td>
</tr>
<tr>
<td style="text-align:left">time.localtime</td>
<td style="text-align:center">返回当前时间时间结构体</td>
</tr>
<tr>
<td style="text-align:left">time.mktime</td>
<td style="text-align:center">把结构体转换成浮点数表示</td>
</tr>
<tr>
<td style="text-align:left">time.strptime</td>
<td style="text-align:center">把时间字符串解析成时间结构体</td>
</tr>
<tr>
<td style="text-align:left">time.strftime</td>
<td style="text-align:center">把时间结构体表示成字符串</td>
</tr>
</tbody>
</table>
</div>
<h3 id="4-2-datetime"><a href="#4-2-datetime" class="headerlink" title="4.2 datetime"></a>4.2 datetime</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">类</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">datetime.time</td>
<td style="text-align:center">时间类(一天以内)</td>
</tr>
<tr>
<td style="text-align:left">datetime.date</td>
<td style="text-align:center">日期类</td>
</tr>
<tr>
<td style="text-align:left">datetime.timedelta</td>
<td style="text-align:center">时间差类</td>
</tr>
<tr>
<td style="text-align:left">datetime.datetime</td>
<td style="text-align:center">时间日期类</td>
</tr>
</tbody>
</table>
</div>
<h2 id="5-数学运算"><a href="#5-数学运算" class="headerlink" title="5. 数学运算"></a>5. 数学运算</h2><p>数学运算多用其他模块提供的工具(如 numpy 和 scipy),只看一些最基本的函数</p>
<h3 id="5-1-随机数"><a href="#5-1-随机数" class="headerlink" title="5.1 随机数"></a>5.1 随机数</h3><p>random 模块提供了一系列随机数生成工具</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">random.random</td>
<td style="text-align:center">[0,1)随机数生成</td>
</tr>
<tr>
<td style="text-align:left">random.uniform</td>
<td style="text-align:center">生成范围内随机浮点数</td>
</tr>
<tr>
<td style="text-align:left">random.seed</td>
<td style="text-align:center">指定种子</td>
</tr>
<tr>
<td style="text-align:left">random.getstate</td>
<td style="text-align:center">获取伪随机数生成器状态</td>
</tr>
<tr>
<td style="text-align:left">random.setstate</td>
<td style="text-align:center">设置伪随机数生成器状态</td>
</tr>
<tr>
<td style="text-align:left">random.randint</td>
<td style="text-align:center">生成范围内随机整数</td>
</tr>
<tr>
<td style="text-align:left">random.range</td>
<td style="text-align:center">生成间隔区间随机数</td>
</tr>
<tr>
<td style="text-align:left">random.choice</td>
<td style="text-align:center">随机选择序列内元素</td>
</tr>
<tr>
<td style="text-align:left">random.choices</td>
<td style="text-align:center">按照预设概率随机选择序列内元素</td>
</tr>
<tr>
<td style="text-align:left">random.shuffle</td>
<td style="text-align:center">打乱一个序列</td>
</tr>
<tr>
<td style="text-align:left">random.sample</td>
<td style="text-align:center">无随机不修改原序列采样</td>
</tr>
<tr>
<td style="text-align:left">random.normalvariate</td>
<td style="text-align:center">生成正态分布随机数</td>
</tr>
<tr>
<td style="text-align:left">random.gauss</td>
<td style="text-align:center">生成高斯分布随机数</td>
</tr>
</tbody>
</table>
</div>
<p>另外<br>然后可以生成多个 random.Random 类的实例作为随机数生成器,使其互不干扰</p>
<h3 id="5-2-数学工具"><a href="#5-2-数学工具" class="headerlink" title="5.2 数学工具"></a>5.2 数学工具</h3><p>math 包提供了一些常量值,以及一些工具函数,如舍入函数,截断函数等</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">math.trunc</td>
<td style="text-align:center">截断小数部分</td>
</tr>
<tr>
<td style="text-align:left">math.floor</td>
<td style="text-align:center">不大于其的最大整数</td>
</tr>
<tr>
<td style="text-align:left">math.ceil</td>
<td style="text-align:center">不小于其的最大整数</td>
</tr>
</tbody>
</table>
</div>
<h2 id="6-文件系统"><a href="#6-文件系统" class="headerlink" title="6. 文件系统"></a>6. 文件系统</h2><p><a target="_blank" rel="noopener" href="https://www.runoob.com/python/file-methods.html">关于文件的一些原生操作</a></p>
<h3 id="6-1-os-path-平台独立的文件名管理"><a href="#6-1-os-path-平台独立的文件名管理" class="headerlink" title="6.1 os.path:平台独立的文件名管理"></a>6.1 os.path:平台独立的文件名管理</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">path.split</td>
<td style="text-align:center">把路径分为文件夹路径和文件名</td>
</tr>
<tr>
<td style="text-align:left">path.dirname</td>
<td style="text-align:center">提取路径的文件夹路径</td>
</tr>
<tr>
<td style="text-align:left">path.basename</td>
<td style="text-align:center">提取路径的文件名</td>
</tr>
<tr>
<td style="text-align:left">path.splitext</td>
<td style="text-align:center">把路径分割为文件名路径和扩展名部分</td>
</tr>
<tr>
<td style="text-align:left">path.commonprefix</td>
<td style="text-align:center">提取多个路径的公共前缀</td>
</tr>
<tr>
<td style="text-align:left">path.commonpath</td>
<td style="text-align:center">提取多个路径的公共路径部分</td>
</tr>
<tr>
<td style="text-align:left">path.join</td>
<td style="text-align:center">使用路径分隔符连接多个路径片段</td>
</tr>
<tr>
<td style="text-align:left">path.normpath</td>
<td style="text-align:center">规范化路径</td>
</tr>
<tr>
<td style="text-align:left">path.abspath</td>
<td style="text-align:center">相对路径转绝对路径</td>
</tr>
<tr>
<td style="text-align:left">path.getatime</td>
<td style="text-align:center">获取最后访问时间</td>
</tr>
<tr>
<td style="text-align:left">path.getmtime</td>
<td style="text-align:center">获取最后修改时间</td>
</tr>
<tr>
<td style="text-align:left">path.getctime</td>
<td style="text-align:center">获取创建时间</td>
</tr>
<tr>
<td style="text-align:left">path.isabs</td>
<td style="text-align:center">是否为绝对路径</td>
</tr>
<tr>
<td style="text-align:left">path.isfile</td>
<td style="text-align:center">是否为文件</td>
</tr>
<tr>
<td style="text-align:left">path.isdir</td>
<td style="text-align:center">是否为文件夹</td>
</tr>
<tr>
<td style="text-align:left">path.islink</td>
<td style="text-align:center">是否为链接</td>
</tr>
<tr>
<td style="text-align:left">path.ismount</td>
<td style="text-align:center">是否为挂载点(linux)</td>
</tr>
<tr>
<td style="text-align:left">path.exists</td>
<td style="text-align:center">是否存在</td>
</tr>
<tr>
<td style="text-align:left">path.lexists</td>
<td style="text-align:center">链接指向文件是否存在</td>
</tr>
</tbody>
</table>
</div>
<p><strong>_os.path 对于文件夹路径和文件名的分割基于最后一个路径分隔符_</strong></p>
<h3 id="6-2-pathlib-把路径作为对象"><a href="#6-2-pathlib-把路径作为对象" class="headerlink" title="6.2 pathlib:把路径作为对象"></a>6.2 pathlib:把路径作为对象</h3><img src="http://img.yishiyu.world/blogs/images/Python总结系列(一)/pathlib-inheritance.png">
<p>一般最常用的就是 Path 类</p>
<h4 id="6-2-1-连接操作符"><a href="#6-2-1-连接操作符" class="headerlink" title="6.2.1 连接操作符"></a>6.2.1 连接操作符</h4><p><code>/</code>操作符可以用来连接把多个 pathlib 对象或者对象与字符串</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"></span><br><span class="line">home_root = pathlib.Path(<span class="string">&quot;/home&quot;</span>)</span><br><span class="line">print(home_root / <span class="string">&quot;yishiyu&quot;</span>)</span><br><span class="line">print(home_root / pathlib.Path(<span class="string">&quot;yishiyu&quot;</span>))</span><br><span class="line"><span class="comment"># \home\yishiyu</span></span><br><span class="line"><span class="comment"># \home\yishiyu</span></span><br></pre></td></tr></table></figure>
<h4 id="6-2-2-工具函数"><a href="#6-2-2-工具函数" class="headerlink" title="6.2.2 工具函数"></a>6.2.2 工具函数</h4><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">pathlib.Path.resolve</td>
<td style="text-align:center">规范化(包括解析链接路径)</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.joinpath</td>
<td style="text-align:center">连接多个路径片段</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.with_name</td>
<td style="text-align:center">替换文件名部分</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.with_suffix</td>
<td style="text-align:center">替换扩展名部分</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.parts</td>
<td style="text-align:center">分解路径成片段</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.iterdir</td>
<td style="text-align:center">目录迭代器</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.glob</td>
<td style="text-align:center">正则匹配内容的目录迭代器</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.write_bytes</td>
<td style="text-align:center">写入字节序列</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.write_text</td>
<td style="text-align:center">写入文本</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.read_bytes</td>
<td style="text-align:center">读取字节序列</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.read_text</td>
<td style="text-align:center">读取文本</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.open</td>
<td style="text-align:center">打开文件并保存句柄</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.mkdir</td>
<td style="text-align:center">创建目录</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.touch</td>
<td style="text-align:center">创建文件</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.rmdir</td>
<td style="text-align:center">删除空目录</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.unlink</td>
<td style="text-align:center">删除其他文件相关内容</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.is_xxx</td>
<td style="text-align:center">测试函数系列</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.stat</td>
<td style="text-align:center">获取文件信息(stat_result)</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">属性</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">pathlib.Path.parents</td>
<td style="text-align:center">上级文件夹列表(直到根目录)</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.name</td>
<td style="text-align:center">文件名</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.suffix</td>
<td style="text-align:center">扩展名</td>
</tr>
<tr>
<td style="text-align:left">pathlib.Path.stm</td>
<td style="text-align:center">不带扩展名的文件名</td>
</tr>
<tr>
<td style="text-align:left">os.stat_result.st_ctime</td>
<td style="text-align:center">最后创建时间</td>
</tr>
<tr>
<td style="text-align:left">os.stat_result.st_mtime</td>
<td style="text-align:center">最后修改时间</td>
</tr>
<tr>
<td style="text-align:left">os.stat_result.st_atime</td>
<td style="text-align:center">最后访问时间</td>
</tr>
</tbody>
</table>
</div>
<h3 id="6-3-tempfile-临时文件系统对象"><a href="#6-3-tempfile-临时文件系统对象" class="headerlink" title="6.3 tempfile:临时文件系统对象"></a>6.3 tempfile:临时文件系统对象</h3><ul>
<li>tempfile.TemporaryFile:创建一个无名临时文件,临时文件在被关闭的时候会直接被删除(close 或者上下文管理器关闭)</li>
<li>tempfile.NamedTemporaryFile:创建一个具名临时文件,在句柄关闭后被删除</li>
<li>tempfile.TemporaryDirectory:创建一个临时文件夹,在退出 with 语句块后删除</li>
<li>tempfile.gettmpdir:获取临时文件夹所在位置</li>
<li>tempfile.gettempprefix:获取临时文件夹前缀</li>
</ul>
<h3 id="6-4-shutil-高层文件操作"><a href="#6-4-shutil-高层文件操作" class="headerlink" title="6.4 shutil:高层文件操作"></a>6.4 shutil:高层文件操作</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">shutil.copyfile</td>
<td style="text-align:center">拷贝文件内容</td>
</tr>
<tr>
<td style="text-align:left">shutil.copy</td>
<td style="text-align:center">拷贝文件</td>
</tr>
<tr>
<td style="text-align:left">shutil.copy2</td>
<td style="text-align:center">带元信息拷贝文件</td>
</tr>
<tr>
<td style="text-align:left">shutil.copymode</td>
<td style="text-align:center">拷贝操作权限</td>
</tr>
<tr>
<td style="text-align:left">shutil.copystat</td>
<td style="text-align:center">拷贝元信息</td>
</tr>
<tr>
<td style="text-align:left">shutil.copytree</td>
<td style="text-align:center">递归拷贝目录</td>
</tr>
<tr>
<td style="text-align:left">shutil.rmtree</td>
<td style="text-align:center">递归删除一个目录</td>
</tr>
<tr>
<td style="text-align:left">shutil.move</td>
<td style="text-align:center">移动一个文件或者目录</td>
</tr>
</tbody>
</table>
</div>
<h2 id="7-数据持久化存储与交换"><a href="#7-数据持久化存储与交换" class="headerlink" title="7. 数据持久化存储与交换"></a>7. 数据持久化存储与交换</h2><h3 id="7-1-pickle-对象串行化"><a href="#7-1-pickle-对象串行化" class="headerlink" title="7.1 pickle:对象串行化"></a>7.1 pickle:对象串行化</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">函数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">pickle.dump</td>
<td style="text-align:center">序列化并写入文件</td>
</tr>
<tr>
<td style="text-align:left">pickle.dumps</td>
<td style="text-align:center">序列化为字节序列</td>
</tr>
<tr>
<td style="text-align:left">pickle.load</td>
<td style="text-align:center">读取文件并反序列化</td>
</tr>
<tr>
<td style="text-align:left">pickle.loads</td>
<td style="text-align:center">反序列化字节序列</td>
</tr>
</tbody>
</table>
</div>
<p>同时一些对象是不适合进行序列化的,比如随机数生成器对象,如果目标对象有类似<code>getstate</code>和<code>setstate</code>的函数,可以直接序列化保存其状态</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">data_1 = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,[<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>]]</span><br><span class="line"></span><br><span class="line">data_string = pickle.dumps(data_1)</span><br><span class="line">data_2 = pickle.loads(data_string)</span><br><span class="line"></span><br><span class="line">print(data_1)</span><br><span class="line">print(data_string)</span><br><span class="line">print(data_2)</span><br><span class="line">print(<span class="string">&quot;data_1 == data_2 ? :&#123;&#125;&quot;</span>.<span class="built_in">format</span>(data_1==data_2))</span><br><span class="line"><span class="comment"># [&#x27;a&#x27;, &#x27;b&#x27;, [&#x27;c&#x27;, &#x27;d&#x27;]]</span></span><br><span class="line"><span class="comment"># b&#x27;\x80\x04\x95\x19\x00\x00\x00\x00\x00\x00\x00]\x94(\x8c\x01a\x94\x8c\x01b\x94]\x94(\x8c\x01c\x94\x8c\x01d\x94ee.&#x27;</span></span><br><span class="line"><span class="comment"># [&#x27;a&#x27;, &#x27;b&#x27;, [&#x27;c&#x27;, &#x27;d&#x27;]]</span></span><br><span class="line"><span class="comment"># data_1 == data_2 ? :True</span></span><br></pre></td></tr></table></figure>
<h3 id="7-2-shelve-对象的持久化存储"><a href="#7-2-shelve-对象的持久化存储" class="headerlink" title="7.2 shelve:对象的持久化存储"></a>7.2 shelve:对象的持久化存储</h3><p>在不使用关系型数据库的时候,可以使用 shelve 存储数据<br>shelve 使用 dbm 非关系型数据库来存储数据<br>shelve 不支持并发写入,但是支持并发读取(在打开时指定’flag=r’)<br>同时 shelve 不支持可变子元素的修改.其存储的元素,如果任何一个子元素发生改变,则需要重新存储整个元素<br>可以通过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shelve</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> shelve.<span class="built_in">open</span>(<span class="string">&#x27;test_shelf.db&#x27;</span>) <span class="keyword">as</span> s:</span><br><span class="line">    s[<span class="string">&#x27;key&#x27;</span>] = &#123;</span><br><span class="line">        <span class="string">&#x27;int&#x27;</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="string">&#x27;float&#x27;</span>: <span class="number">9.5</span>,</span><br><span class="line">        <span class="string">&#x27;string&#x27;</span>: <span class="string">&#x27;a string&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> shelve.<span class="built_in">open</span>(<span class="string">&#x27;test_shelf.db&#x27;</span>) <span class="keyword">as</span> s:</span><br><span class="line">    print(s[<span class="string">&#x27;key&#x27;</span>])</span><br><span class="line">    <span class="comment"># &#123;&#x27;int&#x27;: 10, &#x27;float&#x27;: 9.5, &#x27;string&#x27;: &#x27;a string&#x27;&#125;</span></span><br><span class="line">    <span class="comment"># 这一步会不会修改数据库</span></span><br><span class="line">    s[<span class="string">&#x27;key&#x27;</span>][<span class="string">&#x27;int&#x27;</span>] = <span class="number">99</span></span><br><span class="line">    print(s[<span class="string">&#x27;key&#x27;</span>][<span class="string">&#x27;int&#x27;</span>])</span><br><span class="line">    temp = s[<span class="string">&#x27;key&#x27;</span>]</span><br><span class="line">    temp[<span class="string">&#x27;int&#x27;</span>] = <span class="number">99</span></span><br><span class="line">    s[<span class="string">&#x27;key&#x27;</span>] = temp</span><br><span class="line">    print(s[<span class="string">&#x27;key&#x27;</span>][<span class="string">&#x27;int&#x27;</span>])</span><br><span class="line">    <span class="comment"># 10</span></span><br><span class="line">    <span class="comment"># 99</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启自动写回</span></span><br><span class="line"><span class="keyword">with</span> shelve.<span class="built_in">open</span>(<span class="string">&#x27;test_shelf.db&#x27;</span>, writeback=<span class="literal">True</span>) <span class="keyword">as</span> s:</span><br><span class="line">    <span class="comment"># 开启自动写回后这一步会修改数据库</span></span><br><span class="line">    s[<span class="string">&#x27;key&#x27;</span>][<span class="string">&#x27;int&#x27;</span>] = <span class="number">999</span></span><br><span class="line">    print(s[<span class="string">&#x27;key&#x27;</span>][<span class="string">&#x27;int&#x27;</span>])</span><br><span class="line">    <span class="comment"># 999</span></span><br></pre></td></tr></table></figure>
<h3 id="7-3-sqlite3-嵌入式关系数据库"><a href="#7-3-sqlite3-嵌入式关系数据库" class="headerlink" title="7.3 sqlite3:嵌入式关系数据库"></a>7.3 sqlite3:嵌入式关系数据库</h3><p>sqlite 是一个无服务器的轻量级服务器<br>本体只有一个文件用来存储数据,通常用来存储一些软件内部的数据</p>
<p>除了下列列出的方法,还可以自定义一些非 sqlite 原生的数据类型,比如日期,序列化对象之类的,还有一些其他内容内容可以参考其他资料</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">db_filename = <span class="string">&#x27;test.db&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果目标文件不存在,则会自动创建</span></span><br><span class="line"><span class="comment"># 如果提供的名字为 `:memory:` 则会创建一个内存文件</span></span><br><span class="line"><span class="keyword">with</span> sqlite3.connect(db_filename) <span class="keyword">as</span> conn:</span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># -------------------- 执行命令 --------------------</span></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    conn.executescript(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        被执行的命令</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># -------------------- 查询数据 --------------------</span></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    cursor.execute(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        查询命令</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span>)</span><br><span class="line">    <span class="comment"># 获取单个结果</span></span><br><span class="line">    task_id, priority, details, status = cursor.fetchone()</span><br><span class="line">    <span class="comment"># 获取多个结果</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchmany(<span class="number">5</span>):</span><br><span class="line">        task_id, priority, details, status = row</span><br><span class="line">    <span class="comment"># 获取所有结果</span></span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">        task_id, priority, details, status = row</span><br><span class="line">    <span class="comment"># 获取查询到数据的元信息</span></span><br><span class="line">    <span class="keyword">for</span> colinfo <span class="keyword">in</span> cursor.description:</span><br><span class="line">        print(colinfo)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># -------------------- 命令变量 --------------------</span></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># 位置参数</span></span><br><span class="line">    project_name = <span class="string">&quot;my_project&quot;</span></span><br><span class="line">    query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        select id, priority, details, status form task_id</span></span><br><span class="line"><span class="string">        where project = ?</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cursor.execute(query,(project_name))</span><br><span class="line">    <span class="comment"># 具名参数</span></span><br><span class="line">    project_name = <span class="string">&quot;my_project&quot;</span></span><br><span class="line">    query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        select id, priority, details, status form task_id</span></span><br><span class="line"><span class="string">        where project = :PROJECT_NAME</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cursor.execute(query,&#123;<span class="string">&#x27;PROJECT_NAME&#x27;</span>:project_name&#125;)</span><br><span class="line">    <span class="comment"># 批量带命令执行</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;data_file&quot;</span>) <span class="keyword">as</span> csv_file:</span><br><span class="line">        csv_reader = csv.DictReader(csv_file)</span><br><span class="line">        cursor = conn.cursor()</span><br><span class="line">        cursor.executemany(query,csv_reader)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># --------------------- 事务 ----------------------</span></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># 事务管理通常与try execpt共同使用</span></span><br><span class="line">    <span class="comment"># 提交事务</span></span><br><span class="line">    conn.commit()</span><br><span class="line">    <span class="comment"># 回滚事务</span></span><br><span class="line">    conn.rollback()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># -------------------- 隔离级别 --------------------</span></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># 略 可以参考python3 标准库</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># -------------------- 内容导出 --------------------</span></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># 导出一些列命令用来重建数据库状态</span></span><br><span class="line">    <span class="comment"># 以迭代器的形式导出</span></span><br><span class="line">    conn.iterdump()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="comment"># ------------------ 使用python函数 ----------------</span></span><br><span class="line">    <span class="comment"># =================================================</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">data</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;after encrypt:&quot;</span> + data</span><br><span class="line">    conn.create_function(<span class="string">&quot;encrypt&quot;</span>,encrypt)</span><br><span class="line">    query = <span class="string">&quot;update task sset details = encrypt(details)&quot;</span></span><br><span class="line">    cursor.execute(query)</span><br></pre></td></tr></table></figure>
<h3 id="7-4-常用文件格式解析"><a href="#7-4-常用文件格式解析" class="headerlink" title="7.4 常用文件格式解析"></a>7.4 常用文件格式解析</h3><p>python 有众多文件格式解析的库,永远不要自己拿正则匹配啥的手动搞</p>
<ul>
<li>html:<a target="_blank" rel="noopener" href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/">BeautifulSoup4</a></li>
<li>csv:<a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/csv.html">原生 csv 包</a></li>
<li>json:<a target="_blank" rel="noopener" href="https://www.runoob.com/python3/python3-json.html">原生 json 包</a></li>
</ul>
<h2 id="8-并发"><a href="#8-并发" class="headerlink" title="8. 并发"></a>8. 并发</h2><p>python 提供的并发的包有:</p>
<ul>
<li>subprocess:创建子进程并与之通信</li>
<li>signal:unix 信号机制</li>
<li>threading:面先对象的高层 API</li>
<li>multiprocessing:threading 的进程版,每个进程都是真正的系统进程</li>
<li>asyncio:基于类的协议系统或写成,为并发和异步 IO 管理提供了框架</li>
<li>concurrent.futures:类似进程池的线程池</li>
</ul>
<p>主要学习 <code>threading</code>,<code>multiprocessing</code>和<code>concurrent.futures</code></p>
<h3 id="8-1-threading"><a href="#8-1-threading" class="headerlink" title="8.1 threading"></a>8.1 threading</h3><h4 id="8-1-1-通用使用方法"><a href="#8-1-1-通用使用方法" class="headerlink" title="8.1.1 通用使用方法"></a>8.1.1 通用使用方法</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># ------------------ 指定启动函数 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用日志模块记录各个线程中的信息</span></span><br><span class="line"><span class="comment"># 同时把各种信息嵌入到日志中</span></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.DEBUG,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;[%(levelname)s] (%(threadName)-10s) %(message)s&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span>():</span></span><br><span class="line">    logging.debug(<span class="string">&quot;starting&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;&#123;&#125; is working&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">        threading.current_thread().getName()</span><br><span class="line">    ))</span><br><span class="line">    logging.debug(<span class="string">&quot;exiting&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 除非明确不需要,主线程最好保证自己有子线程的引用</span></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    t = threading.Thread(</span><br><span class="line">        name=<span class="string">&#x27;thread_&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i),</span><br><span class="line">        target=worker)</span><br><span class="line">    threads.append(t)</span><br><span class="line">    t.start()</span><br><span class="line"><span class="comment"># [DEBUG] (thread_0  ) starting</span></span><br><span class="line"><span class="comment"># thread_0 is working</span></span><br><span class="line"><span class="comment"># [DEBUG] (thread_1  ) starting</span></span><br><span class="line"><span class="comment"># thread_1 is working</span></span><br><span class="line"><span class="comment"># [DEBUG] (thread_0  ) exiting</span></span><br><span class="line"><span class="comment"># [DEBUG] (thread_2  ) starting</span></span><br><span class="line"><span class="comment"># thread_2 is working</span></span><br><span class="line"><span class="comment"># [DEBUG] (thread_1  ) exiting</span></span><br><span class="line"><span class="comment"># [DEBUG] (thread_2  ) exiting</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 派生线程 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span>(<span class="params">threading.Thread</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        logging.debug(<span class="string">&#x27;running&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = MyThread(name=<span class="string">&quot;thread_4&quot;</span>)</span><br><span class="line">t.start()</span><br><span class="line"><span class="comment"># [DEBUG] (thread_4  ) running</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 延时线程 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delay</span>():</span></span><br><span class="line">    logging.debug(<span class="string">&quot;i am late&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 延时任务</span></span><br><span class="line">t = threading.Timer(<span class="number">1</span>, delay)</span><br><span class="line">t.start()</span><br><span class="line"><span class="comment"># [DEBUG] (Thread-1  ) i am late</span></span><br></pre></td></tr></table></figure>
<h4 id="8-1-2-守护线程"><a href="#8-1-2-守护线程" class="headerlink" title="8.1.2 守护线程"></a>8.1.2 守护线程</h4><p>如上,主程序在所有线程退出后退出<br>但是有的进程可能不会主动退出,如一些软件自带的垃圾清理线程,可以把这些进程设置为守护进程,使得主线程无需等待这些进程就可以直接退出<br>当然也可以显式声明等待守护进程结束</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 声明守护进程</span></span><br><span class="line">t = threading.Thread(</span><br><span class="line">    target=worker,</span><br><span class="line">    daemon=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">t.start()</span><br><span class="line"><span class="comment"># 显式声明等待守护进程</span></span><br><span class="line">t.join()</span><br><span class="line"><span class="comment"># 设置等待守护进程时间上限(秒)</span></span><br><span class="line"><span class="comment"># t.join(3)</span></span><br></pre></td></tr></table></figure>
<h4 id="8-1-3-进程同步"><a href="#8-1-3-进程同步" class="headerlink" title="8.1.3 进程同步"></a>8.1.3 进程同步</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用日志模块记录各个线程中的信息</span></span><br><span class="line"><span class="comment"># 同时把各种信息嵌入到日志中</span></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.DEBUG,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;[%(levelname)s] (%(threadName)-10s) %(message)s&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 事件通信 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">demo</span>(<span class="params">e1, e2</span>):</span></span><br><span class="line">    logging.debug(<span class="string">&quot;start&quot;</span>)</span><br><span class="line">    e1.wait()</span><br><span class="line">    logging.debug(<span class="string">&quot;e1 is set&quot;</span>)</span><br><span class="line">    e2.wait(<span class="number">3</span>)</span><br><span class="line">    logging.debug(<span class="string">&quot;e2 ignored&quot;</span>)</span><br><span class="line">    logging.debug(<span class="string">&quot;exiting&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e1 = threading.Event()</span><br><span class="line">e2 = threading.Event()</span><br><span class="line">t = threading.Thread(</span><br><span class="line">    name=<span class="string">&quot;demo thread&quot;</span>,</span><br><span class="line">    target=demo,</span><br><span class="line">    args=(e1, e2)</span><br><span class="line">)</span><br><span class="line">t.start()</span><br><span class="line">logging.debug(<span class="string">&quot;ready!&quot;</span>)</span><br><span class="line"></span><br><span class="line">e1.<span class="built_in">set</span>()</span><br><span class="line"><span class="comment"># [DEBUG] (demo thread) start</span></span><br><span class="line"><span class="comment"># [DEBUG] (MainThread) ready!</span></span><br><span class="line"><span class="comment"># [DEBUG] (demo thread) e1 is set</span></span><br><span class="line"><span class="comment"># [DEBUG] (demo thread) e2 ignored</span></span><br><span class="line"><span class="comment"># [DEBUG] (demo thread) exiting</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># ------------------- 线程锁同步 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># 普通不可重入锁</span></span><br><span class="line"><span class="comment"># lock = threading.Lock()</span></span><br><span class="line"><span class="comment"># 请求锁,得到后立即上锁</span></span><br><span class="line"><span class="comment"># lock.acquire()</span></span><br><span class="line"><span class="comment"># lock.acquire(超时值)</span></span><br><span class="line"><span class="comment"># 询问锁,如果已上锁则返回True,否则为False</span></span><br><span class="line"><span class="comment"># lock.locked()</span></span><br><span class="line"><span class="comment"># 释放锁</span></span><br><span class="line"><span class="comment"># lock.release()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可重入锁</span></span><br><span class="line"><span class="comment"># 同一个线程可以重复获取,但是需要释放同样次数</span></span><br><span class="line"><span class="comment"># lock = threading.RLock()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># ------------------- 线程锁技巧 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># 可以使用with语句管理上下文,以下两种方法等效</span></span><br><span class="line"><span class="comment"># with lock:</span></span><br><span class="line"><span class="comment">#     logging.debug(&quot;something&quot;)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># lock.acquire()</span></span><br><span class="line"><span class="comment"># try:</span></span><br><span class="line"><span class="comment">#     logging.debug(&quot;something&quot;)</span></span><br><span class="line"><span class="comment"># finally:</span></span><br><span class="line"><span class="comment">#     lock.release()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># ------------------- 同步线程 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># condition 在wait的时候就会释放上下文中请求的锁</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">consumer</span>(<span class="params">cond</span>):</span></span><br><span class="line">    <span class="keyword">with</span> cond:</span><br><span class="line">        cond.wait()</span><br><span class="line">        logging.debug(<span class="string">&quot;resource is available to sonsumer&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">producer</span>(<span class="params">cond</span>):</span></span><br><span class="line">    <span class="keyword">with</span> cond:</span><br><span class="line">        logging.debug(<span class="string">&quot;make resource available&quot;</span>)</span><br><span class="line">        cond.notifyAll()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">condition = threading.Condition()</span><br><span class="line">c1 = threading.Thread(name=<span class="string">&quot;c1&quot;</span>, target=consumer, args=(condition,))</span><br><span class="line">c2 = threading.Thread(name=<span class="string">&quot;c2&quot;</span>, target=consumer, args=(condition,))</span><br><span class="line">p = threading.Thread(name=<span class="string">&quot;p&quot;</span>, target=producer, args=(condition,))</span><br><span class="line"></span><br><span class="line">c1.start()</span><br><span class="line">c2.start()</span><br><span class="line">p.start()</span><br><span class="line"><span class="comment"># [DEBUG] (p         ) make resource available</span></span><br><span class="line"><span class="comment"># [DEBUG] (c1        ) resource is available to sonsumer</span></span><br><span class="line"><span class="comment"># [DEBUG] (c2        ) resource is available to sonsumer</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># ------------------- 信号量机制 --------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># 信号量机制多用于连接池类似的东西</span></span><br><span class="line">maxconnections = <span class="number">5</span></span><br><span class="line">pool_sema = threading.Semaphore(value=maxconnections)</span><br><span class="line"><span class="keyword">with</span> pool_sema:</span><br><span class="line">    <span class="comment"># conn = connectdb()</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ... use connection ...</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># conn.close()</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="8-2-multiprocessing"><a href="#8-2-multiprocessing" class="headerlink" title="8.2 multiprocessing"></a>8.2 multiprocessing</h3><p>multiprocessing 可以规避掉全局解释器锁(GIL)带来的瓶颈</p>
<h4 id="8-2-1-通用使用方法"><a href="#8-2-1-通用使用方法" class="headerlink" title="8.2.1 通用使用方法"></a>8.2.1 通用使用方法</h4><p>指定目标函数,构造派生,守护进程的使用方法都与线程类似,略过</p>
<p>同时由于与线程不同,进程试可以单独存在的,所有必要的时候需要将其杀死</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(</span><br><span class="line">    level=logging.DEBUG,</span><br><span class="line">    <span class="built_in">format</span>=<span class="string">&#x27;[%(levelname)s] %(message)s&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        logging.debug(<span class="string">&quot;&#123;&#125; is working&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">            multiprocessing.current_process().__name__))</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    multiprocessing.log_to_stderr(logging.DEBUG)</span><br><span class="line">    p = multiprocessing.Process()</span><br><span class="line"></span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 分别是 SIGTERM 信号和 SIGKILL 信号</span></span><br><span class="line">    <span class="comment"># SIGINT: 用户ctrl-c终止进程</span></span><br><span class="line">    <span class="comment"># SIGTERM: 系统终止进程信号</span></span><br><span class="line">    <span class="comment"># SIGKILL: 系统强制终止进程信号</span></span><br><span class="line">    p.terminate()</span><br><span class="line">    <span class="comment"># p.kill()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 等待目标进程终止</span></span><br><span class="line">    p.join()</span><br><span class="line"><span class="comment"># [INFO/Process-1] child process calling self.run()</span></span><br><span class="line"><span class="comment"># [INFO/Process-1] process shutting down</span></span><br><span class="line"><span class="comment"># [DEBUG/Process-1] running all &quot;atexit&quot; finalizers with priority &gt;= 0</span></span><br><span class="line"><span class="comment"># [DEBUG/Process-1] running the remaining &quot;atexit&quot; finalizers</span></span><br><span class="line"><span class="comment"># [INFO/Process-1] process exiting with exitcode 0</span></span><br><span class="line"><span class="comment"># [INFO/MainProcess] process shutting down</span></span><br><span class="line"><span class="comment"># [DEBUG/MainProcess] running all &quot;atexit&quot; finalizers with priority &gt;= 0</span></span><br><span class="line"><span class="comment"># [DEBUG/MainProcess] running the remaining &quot;atexit&quot; finalizers</span></span><br></pre></td></tr></table></figure>
<h4 id="8-2-2-进程间通信"><a href="#8-2-2-进程间通信" class="headerlink" title="8.2.2 进程间通信"></a>8.2.2 进程间通信</h4><p>进程事件,锁机制,Condition,Semaphore 和线程事件类似,略过<br>进程间可以通过<code>multiprocessing.Manager</code>创建的特殊容器交换数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span>(<span class="params">d, key, value</span>):</span></span><br><span class="line">    d[key] = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    manager = multiprocessing.Manager()</span><br><span class="line">    <span class="comment"># 创建共享数据结构</span></span><br><span class="line">    d = manager.<span class="built_in">dict</span>()</span><br><span class="line">    jobs = [</span><br><span class="line">        multiprocessing.Process(</span><br><span class="line">            target=worker,</span><br><span class="line">            args=(d, i, i*<span class="number">2</span>)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 多个进程共用的数据结构</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> jobs:</span><br><span class="line">        j.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> jobs:</span><br><span class="line">        j.join()</span><br><span class="line"></span><br><span class="line">    print(d)</span><br><span class="line">    <span class="comment"># &#123;1: 2, 0: 0, 3: 6, 4: 8, 2: 4&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="8-2-3-进程池"><a href="#8-2-3-进程池" class="headerlink" title="8.2.3 进程池"></a>8.2.3 进程池</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_calculation</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">return</span> data*<span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_process</span>():</span></span><br><span class="line">    print(<span class="string">&quot;Starting&quot;</span>, multiprocessing.current_process().name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    inputs = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line">    pool_size = multiprocessing.cpu_count() * <span class="number">2</span></span><br><span class="line">    pool = multiprocessing.Pool(</span><br><span class="line">        <span class="comment"># 每个进程最多完成的任务数,执行完后重启,避免耗费太多资源</span></span><br><span class="line">        maxtasksperchild=<span class="number">2</span>,</span><br><span class="line">        processes=pool_size,</span><br><span class="line">        initializer=start_process</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用多个进程执行计算</span></span><br><span class="line">    outputs = pool.<span class="built_in">map</span>(do_calculation, inputs)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line"></span><br><span class="line">    print(outputs)</span><br><span class="line">    <span class="comment"># Starting SpawnPoolWorker-1</span></span><br><span class="line">    <span class="comment"># Starting SpawnPoolWorker-2</span></span><br><span class="line">    <span class="comment"># Starting SpawnPoolWorker-4</span></span><br><span class="line">    <span class="comment"># Starting SpawnPoolWorker-6</span></span><br><span class="line">    <span class="comment"># Starting SpawnPoolWorker-3</span></span><br><span class="line">    <span class="comment"># Starting SpawnPoolWorker-5</span></span><br><span class="line">    <span class="comment"># Starting SpawnPoolWorker-8</span></span><br><span class="line">    <span class="comment"># Starting SpawnPoolWorker-7</span></span><br><span class="line">    <span class="comment"># [0, 2, 4, 6, 8, 10, 12, 14, 16, 18]</span></span><br></pre></td></tr></table></figure>
<h3 id="8-3-concurrent-futures"><a href="#8-3-concurrent-futures" class="headerlink" title="8.3 concurrent.futures"></a>8.3 concurrent.futures</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent <span class="keyword">import</span> futures</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">n</span>):</span></span><br><span class="line">    print(<span class="string">&quot;&#123;&#125; is working&quot;</span>.<span class="built_in">format</span>(threading.current_thread().name))</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    print(<span class="string">&quot;&#123;&#125; finished&quot;</span>.<span class="built_in">format</span>(threading.current_thread().name))</span><br><span class="line">    <span class="keyword">return</span> n/<span class="number">10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造线程池</span></span><br><span class="line">ex = futures.ThreadPoolExecutor(max_workers=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 大量调度 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用线程执行计算</span></span><br><span class="line">results = ex.<span class="built_in">map</span>(task, <span class="built_in">range</span>(<span class="number">5</span>, <span class="number">10</span>))</span><br><span class="line">print(<span class="string">&quot;waiting for the result&quot;</span>)</span><br><span class="line">real_results = <span class="built_in">list</span>(results)</span><br><span class="line">print(real_results)</span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_0 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_1 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_2 is working</span></span><br><span class="line"><span class="comment"># waiting for the result</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_0 finished</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_0 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_1 finished</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_1 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_2 finished</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_0 finished</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_1 finished</span></span><br><span class="line"><span class="comment"># [0.5, 0.6, 0.7, 0.8, 0.9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 单个调度 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 提交单个任务</span></span><br><span class="line">f = ex.submit(task, <span class="number">10</span>)</span><br><span class="line">print(f.result())</span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_2 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_2 finished</span></span><br><span class="line"><span class="comment"># 1.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 自动处理结果 -----------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line">wait_for = [</span><br><span class="line">    ex.submit(task, i)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>, <span class="number">8</span>)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 完成任务后自动处理</span></span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> futures.as_completed(wait_for):</span><br><span class="line">    print(<span class="string">&quot;the result is &#123;&#125;&quot;</span>.<span class="built_in">format</span>(f.result()))</span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_2 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_0 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_1 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_0 finished</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_1 finished</span></span><br><span class="line"><span class="comment"># the result is 0.6</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_2 finished</span></span><br><span class="line"><span class="comment"># the result is 0.7</span></span><br><span class="line"><span class="comment"># the result is 0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># -------------------- 指定回调函数 -----------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">done</span>(<span class="params">fn: futures.Future</span>):</span></span><br><span class="line">    <span class="keyword">if</span> fn.cancelled():</span><br><span class="line">        print(<span class="string">&quot;&#123;&#125;:cancelled&quot;</span>.<span class="built_in">format</span>(fn.arg))</span><br><span class="line">    <span class="keyword">elif</span> fn.done():</span><br><span class="line">        error = fn.exception()</span><br><span class="line">        <span class="keyword">if</span> error:</span><br><span class="line">            print(<span class="string">&quot;&#123;&#125;: error returned&quot;</span>.<span class="built_in">format</span>(fn.arg))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = fn.result()</span><br><span class="line">            print(<span class="string">&quot;&#123;&#125;:value(&#123;&#125;) returned&quot;</span>.<span class="built_in">format</span>(fn.arg, result))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f = ex.submit(task, <span class="number">5</span>)</span><br><span class="line">f.arg = <span class="number">5</span></span><br><span class="line">f.add_done_callback(done)</span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_0 is working</span></span><br><span class="line"><span class="comment"># ThreadPoolExecutor-0_0 finished</span></span><br><span class="line"><span class="comment"># 5:value(0.5) returned</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 撤销任务 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># Future对象支持撤销执行</span></span><br><span class="line"><span class="comment"># cancel函数返回一个布尔值,表示是否撤销成功</span></span><br><span class="line"><span class="comment"># f.cancel()</span></span><br><span class="line"><span class="comment"># cancelled() 查询任务是否被撤销</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 错误处理 -------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task_with_error</span>(<span class="params">n</span>):</span></span><br><span class="line">    print(<span class="string">&quot;&#123;&#125;:starting&quot;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;value error&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f = ex.submit(task_with_error, <span class="number">5</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = f.result()</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&quot;main:&#123;&#125; when assesing result&quot;</span>.<span class="built_in">format</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="comment"># main:value error when assesing result</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 上下文管理 ------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># 线程池可以结合上下文管理关键字:with</span></span><br><span class="line"><span class="comment"># with futures.ThreadPoolExecutor(max_workers=2) as ex:</span></span><br><span class="line"><span class="comment">#     ex.submit(task,1)</span></span><br><span class="line"><span class="comment">#     ex.submit(task,3)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># --------------------- 进程池调度 ------------------</span></span><br><span class="line"><span class="comment"># =================================================</span></span><br><span class="line"><span class="comment"># concurrent.futures是支持进程池调度的</span></span><br><span class="line"><span class="comment"># ex = futures.ProcessPoolExecutor(max_workers=2)</span></span><br><span class="line"><span class="comment"># 同时支持对进程的调度</span></span><br><span class="line"><span class="comment"># pid1 = os.getpid()</span></span><br><span class="line"><span class="comment"># os.kill(pid1,signal.SIGHUP)</span></span><br><span class="line"><span class="comment"># 如果进程被杀死或者意外退出</span></span><br><span class="line"><span class="comment"># ProcessPoolExecutor可以看成是意外中断,无法执行再调度任务</span></span><br><span class="line"><span class="comment"># 会触发 futures.process.BrokenProcessPool 异常</span></span><br><span class="line"><span class="comment"># try:</span></span><br><span class="line"><span class="comment">#     result = f.result()</span></span><br><span class="line"><span class="comment"># except futures.process.BrokenProcessPool as e:</span></span><br><span class="line"><span class="comment">#     print(e)</span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">遗世雨</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yishiyu.github.io/2021/02/24/Python%E6%80%BB%E7%BB%93%E7%B3%BB%E5%88%97(%E4%B8%80)/">http://yishiyu.github.io/2021/02/24/Python总结系列(一)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yishiyu.github.io" target="_blank">遗世の私语</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a><a class="post-meta__tags" href="/tags/%E7%A7%91%E7%A0%94%E5%AD%A6%E4%B9%A0/">科研学习</a></div><div class="post_share"><div class="social-share" data-image="http://img.yishiyu.world/blogs/cover/post/20210224/005.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/03/03/Python总结系列(二)/" title="Python总结系列(二).md"><img class="cover" src="http://img.yishiyu.world/blogs/cover/post/20210224/005.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-03</div><div class="title">Python总结系列(二).md</div></div></a></div><div><a href="/2021/02/23/Flask基础/" title="Flask基础"><img class="cover" src="http://img.yishiyu.world/blogs/cover/post/20210224/002.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-23</div><div class="title">Flask基础</div></div></a></div><div><a href="/2020/02/12/在MC中3D打印/" title="在MC中3D打印"><img class="cover" src="http://img.yishiyu.world/blogs/cover/post/20210208/009.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-02-12</div><div class="title">在MC中3D打印</div></div></a></div><div><a href="/2019/09/23/排名计算/" title="排名计算"><img class="cover" src="http://img.yishiyu.world/blogs/cover/post/20210208/006.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-09-23</div><div class="title">排名计算</div></div></a></div><div><a href="/2019/12/25/简易mips汇编器/" title="简易mips汇编器"><img class="cover" src="http://img.yishiyu.world/blogs/cover/post/20210208/005.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-12-25</div><div class="title">简易mips汇编器</div></div></a></div><div><a href="/2019/11/22/PC示波器/" title="PC示波器"><img class="cover" src="http://img.yishiyu.world/blogs/cover/post/20210208/015.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2019-11-22</div><div class="title">PC示波器</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Python-%E6%A0%87%E5%87%86%E5%BA%93-%E7%A7%91%E5%AD%A6%E8%AE%A1%E7%AE%97%E7%9B%B8%E5%85%B3"><span class="toc-text">Python 标准库(科学计算相关)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0-%E6%A6%82%E8%BF%B0"><span class="toc-text">0. 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%96%87%E6%9C%AC%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-text">1. 文本格式化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95"><span class="toc-text">1.1 基本方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-format-%E5%87%BD%E6%95%B0"><span class="toc-text">1.2 format 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-pprint-%E5%8C%85"><span class="toc-text">1.3 pprint 包</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-text">2. 数据结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Enum-%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.1 Enum:枚举类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E6%99%AE%E9%80%9A%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.1.1 普通枚举类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E6%95%B4%E6%95%B0%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-text">2.1.2 整数枚举类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E5%94%AF%E4%B8%80%E6%9E%9A%E4%B8%BE"><span class="toc-text">2.1.3 唯一枚举</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-ChainMap-%E8%BF%9E%E9%94%81%E5%AD%97%E5%85%B8"><span class="toc-text">2.2 ChainMap:连锁字典</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Counter-%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-text">2.3 Counter:计数器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-defaultdict-%E7%BC%BA%E7%9C%81%E5%80%BC%E5%AD%97%E5%85%B8"><span class="toc-text">2.4 defaultdict:缺省值字典</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-deque-%E5%8F%8C%E5%90%91%E9%98%9F%E5%88%97"><span class="toc-text">2.5 deque:双向队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-namedtuple-%E5%85%B7%E5%90%8D%E5%85%83%E7%BB%84"><span class="toc-text">2.6 namedtuple:具名元组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-OrderedDict-%E6%9C%89%E5%BA%8F%E5%AD%97%E5%85%B8"><span class="toc-text">2.7 OrderedDict:有序字典</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-array-%E6%95%B0%E7%BB%84"><span class="toc-text">2.8 array:数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-heapq-%E5%A0%86%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95"><span class="toc-text">2.9 heapq:堆排序算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-bisect-%E6%9C%89%E5%BA%8F%E5%88%97%E8%A1%A8%E7%AE%97%E6%B3%95"><span class="toc-text">2.10 bisect:有序列表算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-queue-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E9%98%9F%E5%88%97"><span class="toc-text">2.11 queue:线程安全队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-12-copy-%E5%A4%8D%E5%88%B6"><span class="toc-text">2.12 copy:复制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-12-1-copy-copy-%E6%B5%85%E5%A4%8D%E5%88%B6"><span class="toc-text">2.12.1 copy.copy:浅复制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-12-2-copy-deepcopy-%E6%B7%B1%E5%A4%8D%E5%88%B6"><span class="toc-text">2.12.2 copy.deepcopy():深复制</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%AF%AD%E8%A8%80%E5%B7%A5%E5%85%B7"><span class="toc-text">3. 语言工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-functools"><span class="toc-text">3.1 functools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-functools-partial"><span class="toc-text">3.1.1 functools.partial</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-functools-tool-ordering"><span class="toc-text">3.1.2 functools.tool_ordering</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-functools-lru-cache"><span class="toc-text">3.1.3 functools.lru_cache</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-functools-reduce"><span class="toc-text">3.1.4 functools.reduce</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-itertools"><span class="toc-text">3.2 itertools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%90%88%E5%B9%B6%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-text">3.2.1 合并迭代器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-1-%E4%B8%B2%E8%A1%8C%E5%90%88%E5%B9%B6"><span class="toc-text">3.2.1.1 串行合并</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-2-1-2-%E5%B9%B6%E8%A1%8C%E5%90%88%E5%B9%B6"><span class="toc-text">3.2.1.2 并行合并</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E8%BD%AC%E6%8D%A2%E8%BE%93%E5%85%A5"><span class="toc-text">3.2.2 转换输入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E5%BE%AA%E7%8E%AF%E9%87%8D%E5%A4%8D"><span class="toc-text">3.2.3 循环重复</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-%E8%BF%87%E6%BB%A4"><span class="toc-text">3.2.4 过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-%E5%88%86%E7%BB%84"><span class="toc-text">3.2.5 分组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-6-%E7%BB%84%E5%90%88%E8%BE%93%E5%85%A5"><span class="toc-text">3.2.6 组合输入</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-contextlib"><span class="toc-text">3.3 contextlib</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-text">3.3.1 上下文管理器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-contextlib-ContextDecorator"><span class="toc-text">3.3.2 contextlib.ContextDecorator</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-contextlib"><span class="toc-text">3.3.3 contextlib</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-conntextlib-API"><span class="toc-text">3.3.4 conntextlib API</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4"><span class="toc-text">4. 日期和时间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-time"><span class="toc-text">4.1 time</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E6%A0%B8%E5%BF%83%E5%87%BD%E6%95%B0"><span class="toc-text">4.1.1 核心函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-text">4.1.2 其他函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-datetime"><span class="toc-text">4.2 datetime</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-text">5. 数学运算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-text">5.1 随机数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E6%95%B0%E5%AD%A6%E5%B7%A5%E5%85%B7"><span class="toc-text">5.2 数学工具</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-text">6. 文件系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-os-path-%E5%B9%B3%E5%8F%B0%E7%8B%AC%E7%AB%8B%E7%9A%84%E6%96%87%E4%BB%B6%E5%90%8D%E7%AE%A1%E7%90%86"><span class="toc-text">6.1 os.path:平台独立的文件名管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-pathlib-%E6%8A%8A%E8%B7%AF%E5%BE%84%E4%BD%9C%E4%B8%BA%E5%AF%B9%E8%B1%A1"><span class="toc-text">6.2 pathlib:把路径作为对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-%E8%BF%9E%E6%8E%A5%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">6.2.1 连接操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0"><span class="toc-text">6.2.2 工具函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-tempfile-%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AF%B9%E8%B1%A1"><span class="toc-text">6.3 tempfile:临时文件系统对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-shutil-%E9%AB%98%E5%B1%82%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C"><span class="toc-text">6.4 shutil:高层文件操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E4%B8%8E%E4%BA%A4%E6%8D%A2"><span class="toc-text">7. 数据持久化存储与交换</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-pickle-%E5%AF%B9%E8%B1%A1%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-text">7.1 pickle:对象串行化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-shelve-%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="toc-text">7.2 shelve:对象的持久化存储</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-sqlite3-%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%85%B3%E7%B3%BB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">7.3 sqlite3:嵌入式关系数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E5%B8%B8%E7%94%A8%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%A7%A3%E6%9E%90"><span class="toc-text">7.4 常用文件格式解析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%B9%B6%E5%8F%91"><span class="toc-text">8. 并发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-threading"><span class="toc-text">8.1 threading</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-%E9%80%9A%E7%94%A8%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">8.1.1 通用使用方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-%E5%AE%88%E6%8A%A4%E7%BA%BF%E7%A8%8B"><span class="toc-text">8.1.2 守护线程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-%E8%BF%9B%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="toc-text">8.1.3 进程同步</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-multiprocessing"><span class="toc-text">8.2 multiprocessing</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-%E9%80%9A%E7%94%A8%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">8.2.1 通用使用方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-text">8.2.2 进程间通信</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-3-%E8%BF%9B%E7%A8%8B%E6%B1%A0"><span class="toc-text">8.2.3 进程池</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-concurrent-futures"><span class="toc-text">8.3 concurrent.futures</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By 遗世雨</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/"><img class="icp-icon" src="https://pic3.zhimg.com/80/v2-d0289dc0a46fc5b15b3363ffa78cf6c7.png"><span>陕ICP备20012321号</span></a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>